/*!
 * Tiny Comments plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 3.3.2-104
 */

!function(){"use strict";const e=Object.getPrototypeOf,t=(e,t,n)=>{var o;return!!n(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},n=e=>n=>(e=>{const n=typeof e;return null===e?"null":"object"===n&&Array.isArray(e)?"array":"object"===n&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":n})(n)===e,o=e=>t=>typeof t===e,r=n("string"),s=n("object"),a=n=>((n,o)=>s(n)&&t(n,o,((t,n)=>e(t)===n)))(n,Object),i=n("array"),c=o("boolean"),l=(void 0,e=>undefined===e);const u=e=>null==e,d=e=>!u(e),m=o("function"),g=o("number"),p=()=>{},h=(e,t)=>(...n)=>e(t.apply(null,n)),v=e=>()=>e,f=e=>e,b=(e,t)=>e===t;function y(e,...t){return(...n)=>{const o=t.concat(n);return e.apply(null,o)}}const _=e=>()=>{throw new Error(e)},x=e=>e(),w=v(!1),O=v(!0),S=v("dismiss.popups"),C=v("reposition.popups");class E{constructor(e,t){this.tag=e,this.value=t}static some(e){return new E(!0,e)}static none(){return E.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?E.some(e(this.value)):E.none()}bind(e){return this.tag?e(this.value):E.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:E.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return d(e)?E.some(e):E.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}E.singletonNone=new E(!1);const k=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},T=(e,t)=>{const n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return k(n.childNodes[0])},A=(e,t)=>{const n=(t||document).createElement(e);return k(n)},M=(e,t)=>{const n=(t||document).createTextNode(e);return k(n)},R=k;var N=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t},F=function(e){return{eq:e}},B=F((function(e,t){return e===t})),D=function(e){return F((function(t,n){if(t.length!==n.length)return!1;for(var o=t.length,r=0;r<o;r++)if(!e.eq(t[r],n[r]))return!1;return!0}))},H=F((function(e,t){if(e===t)return!0;var n,o=N(e);return o===N(t)&&(function(e){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(e)}(o)?e===t:"array"===o?D(H).eq(e,t):"object"===o&&(n=H,F((function(e,t){var o=Object.keys(e),r=Object.keys(t);if(!function(e,t){return function(e,t){return F((function(n,o){return e.eq(t(n),t(o))}))}(D(e),(function(e){return function(e,t){return Array.prototype.slice.call(e).sort(t)}(e,t)}))}(B).eq(o,r))return!1;for(var s=o.length,a=0;a<s;a++){var i=o[a];if(!n.eq(e[i],t[i]))return!1}return!0}))).eq(e,t))}));const P=Array.prototype.slice,I=Array.prototype.indexOf,V=Array.prototype.push,W=(e,t)=>((e,t)=>I.call(e,t))(e,t)>-1,L=(e,t)=>{for(let n=0,o=e.length;n<o;n++)if(t(e[n],n))return!0;return!1},U=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},j=(e,t)=>{for(let n=0,o=e.length;n<o;n++)t(e[n],n)},z=(e,t)=>{const n=[];for(let o=0,r=e.length;o<r;o++){const r=e[o];t(r,o)&&n.push(r)}return n},$=(e,t,n)=>(((e,t)=>{for(let n=e.length-1;n>=0;n--)t(e[n],n)})(e,((e,o)=>{n=t(n,e,o)})),n),q=(e,t,n)=>(j(e,((e,o)=>{n=t(n,e,o)})),n),G=(e,t)=>((e,t,n)=>{for(let o=0,r=e.length;o<r;o++){const r=e[o];if(t(r,o))return E.some(r);if(n(r,o))break}return E.none()})(e,t,w),K=(e,t)=>{for(let n=0,o=e.length;n<o;n++)if(t(e[n],n))return E.some(n);return E.none()},Y=e=>{const t=[];for(let n=0,o=e.length;n<o;++n){if(!i(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);V.apply(t,e[n])}return t},Q=(e,t)=>Y(U(e,t)),J=(e,t)=>{for(let n=0,o=e.length;n<o;++n)if(!0!==t(e[n],n))return!1;return!0},X=e=>{const t=P.call(e,0);return t.reverse(),t},Z=(e,t)=>z(e,(e=>!W(t,e))),ee=(e,t)=>{const n={};for(let o=0,r=e.length;o<r;o++){const r=e[o];n[String(r)]=t(r,o)}return n},te=e=>[e],ne=(e,t)=>t>=0&&t<e.length?E.some(e[t]):E.none(),oe=e=>ne(e,0),re=(e,t)=>{for(let n=0;n<e.length;n++){const o=t(e[n],n);if(o.isSome())return o}return E.none()},se=(e,t)=>{const n=e.dom;if(1!==n.nodeType)return!1;{const e=n;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},ae=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,ie=(e,t)=>e.dom===t.dom;"undefined"!=typeof window?window:Function("return this;")();const ce=e=>e.dom.nodeName.toLowerCase(),le=e=>t=>(e=>e.dom.nodeType)(t)===e,ue=le(1),de=le(3),me=le(9),ge=le(11),pe=e=>t=>ue(t)&&ce(t)===e,he=e=>R(e.dom.ownerDocument),ve=e=>me(e)?e:he(e),fe=e=>R(ve(e).dom.defaultView),be=e=>E.from(e.dom.parentNode).map(R),ye=e=>E.from(e.dom.parentElement).map(R),_e=e=>U(e.dom.childNodes,R),xe=(e,t)=>{const n=e.dom.childNodes;return E.from(n[t]).map(R)},we=e=>xe(e,0),Oe=e=>ge(e)&&d(e.dom.host),Se=m(Element.prototype.attachShadow)&&m(Node.prototype.getRootNode),Ce=v(Se),Ee=Se?e=>R(e.dom.getRootNode()):ve,ke=e=>R(e.dom.host),Te=e=>{const t=R((e=>{if(Ce()&&d(e.target)){const t=R(e.target);if(ue(t)&&(e=>d(e.dom.shadowRoot))(t)&&e.composed&&e.composedPath){const t=e.composedPath();if(t)return oe(t)}}return E.from(e.target)})(e).getOr(e.target)),n=()=>e.stopPropagation(),o=()=>e.preventDefault(),r=h(o,n);return((e,t,n,o,r,s,a)=>({target:e,x:t,y:n,stop:o,prevent:r,kill:s,raw:a}))(t,e.clientX,e.clientY,n,o,r,e)},Ae=(e,t,n,o)=>{e.dom.removeEventListener(t,n,o)},Me=O,Re=(e,t,n)=>((e,t,n,o)=>((e,t,n,o,r)=>{const s=((e,t)=>n=>{e(n)&&t(Te(n))})(n,o);return e.dom.addEventListener(t,s,r),{unbind:y(Ae,e,t,s,r)}})(e,t,n,o,!1))(e,t,Me,n),Ne=(e,t)=>{be(e).each((n=>{n.dom.insertBefore(t.dom,e.dom)}))},Fe=(e,t)=>{we(e).fold((()=>{Be(e,t)}),(n=>{e.dom.insertBefore(t.dom,n.dom)}))},Be=(e,t)=>{e.dom.appendChild(t.dom)},De=Object.keys,He=Object.hasOwnProperty,Pe=(e,t)=>{const n=De(e);for(let o=0,r=n.length;o<r;o++){const r=n[o];t(e[r],r)}},Ie=(e,t)=>Ve(e,((e,n)=>({k:n,v:t(e,n)}))),Ve=(e,t)=>{const n={};return Pe(e,((e,o)=>{const r=t(e,o);n[r.k]=r.v})),n},We=e=>(t,n)=>{e[n]=t},Le=(e,t,n,o)=>{Pe(e,((e,r)=>{(t(e,r)?n:o)(e,r)}))},Ue=(e,t)=>{const n={};return Le(e,t,We(n),p),n},je=(e,t)=>{const n=[];return Pe(e,((e,o)=>{n.push(t(e,o))})),n},ze=(e,t)=>{const n=De(e);for(let o=0,r=n.length;o<r;o++){const r=n[o],s=e[r];if(t(s,r,e))return E.some(s)}return E.none()},$e=(e,t)=>qe(e,t)?E.from(e[t]):E.none(),qe=(e,t)=>He.call(e,t),Ge=(e,t)=>qe(e,t)&&void 0!==e[t]&&null!==e[t],Ke=v("tinycomments"),Ye=v("data-mce-annotation"),Qe=e=>{let t=E.none(),n=[];const o=e=>{r()?s(e):n.push(e)},r=()=>t.isSome(),s=e=>{t.each((t=>{setTimeout((()=>{e(t)}),0)}))};return e((e=>{r()||(t=E.some(e),j(n,s),n=[])})),{get:o,map:e=>Qe((t=>{o((n=>{t(e(n))}))})),isReady:r}},Je={nu:Qe,pure:e=>Qe((t=>{t(e)}))},Xe=e=>{setTimeout((()=>{throw e}),0)},Ze=e=>{const t=t=>{e().then(t,Xe)};return{map:t=>Ze((()=>e().then(t))),bind:t=>Ze((()=>e().then((e=>t(e).toPromise())))),anonBind:t=>Ze((()=>e().then((()=>t.toPromise())))),toLazy:()=>Je.nu(t),toCached:()=>{let t=null;return Ze((()=>(null===t&&(t=e()),t)))},toPromise:e,get:t}},et=e=>Ze((()=>new Promise(e))),tt=e=>Ze((()=>Promise.resolve(e))),nt=e=>{const t=t=>t(e),n=v(e),o=()=>r,r={tag:!0,inner:e,fold:(t,n)=>n(e),isValue:O,isError:w,map:t=>rt.value(t(e)),mapError:o,bind:t,exists:t,forall:t,getOr:n,or:o,getOrThunk:n,orThunk:o,getOrDie:n,each:t=>{t(e)},toOptional:()=>E.some(e)};return r},ot=e=>{const t=()=>n,n={tag:!1,inner:e,fold:(t,n)=>t(e),isValue:w,isError:O,map:t,mapError:t=>rt.error(t(e)),bind:t,exists:w,forall:O,getOr:f,or:f,getOrThunk:x,orThunk:x,getOrDie:_(String(e)),each:p,toOptional:E.none};return n},rt={value:nt,error:ot,fromOption:(e,t)=>e.fold((()=>ot(t)),nt)},st=e=>({...e,toCached:()=>st(e.toCached()),bindFuture:t=>st(e.bind((e=>e.fold((e=>tt(rt.error(e))),(e=>t(e)))))),bindResult:t=>st(e.map((e=>e.bind(t)))),mapResult:t=>st(e.map((e=>e.map(t)))),mapError:t=>st(e.map((e=>e.mapError(t)))),foldResult:(t,n)=>e.map((e=>e.fold(t,n))),withTimeout:(t,n)=>st(et((o=>{let r=!1;const s=setTimeout((()=>{r=!0,o(rt.error(n()))}),t);e.get((e=>{r||(clearTimeout(s),o(e))}))})))}),at=e=>st(et(e)),it=e=>st(tt(rt.value(e))),ct={nu:at,wrap:st,pure:it,value:it,error:e=>st(tt(rt.error(e))),fromResult:e=>st(tt(e)),fromFuture:e=>st(e.map(rt.value)),fromPromise:e=>at((t=>{e.then((e=>{t(rt.value(e))}),(e=>{t(rt.error(e))}))}))},lt=e=>{const t=de(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;const n=t.ownerDocument;return(e=>{const t=Ee(e);return Oe(t)?E.some(t):E.none()})(R(t)).fold((()=>n.body.contains(t)),(o=lt,r=ke,e=>o(r(e))));var o,r},ut=(e,t)=>((e,t)=>{const n=void 0===t?document:t.dom;return ae(n)?[]:U(n.querySelectorAll(e),R)})(t,e);var dt;!function(e){e[e.Error=0]="Error",e[e.Value=1]="Value"}(dt||(dt={}));const mt=(e,t,n)=>e.stype===dt.Error?t(e.serror):n(e.svalue),gt=e=>({stype:dt.Value,svalue:e}),pt=e=>({stype:dt.Error,serror:e}),ht=gt,vt=pt,ft=mt,bt=(e,t,n,o)=>({tag:"field",key:e,newKey:t,presence:n,prop:o}),yt=(e,t,n)=>{switch(e.tag){case"field":return t(e.key,e.newKey,e.presence,e.prop);case"custom":return n(e.newKey,e.instantiator)}},_t=e=>(...t)=>{if(0===t.length)throw new Error("Can't merge zero objects");const n={};for(let o=0;o<t.length;o++){const r=t[o];for(const t in r)qe(r,t)&&(n[t]=e(n[t],r[t]))}return n},xt=_t(((e,t)=>a(e)&&a(t)?xt(e,t):t)),wt=_t(((e,t)=>t)),Ot=e=>{let t,n=!1;return(...o)=>(n||(n=!0,t=e.apply(null,o)),t)},St=e=>({tag:"defaultedThunk",process:e}),Ct=e=>St(v(e)),Et=e=>({tag:"mergeWithThunk",process:e}),kt=e=>{const t=(e=>{const t=[],n=[];return j(e,(e=>{mt(e,(e=>n.push(e)),(e=>t.push(e)))})),{values:t,errors:n}})(e);return t.errors.length>0?(n=t.errors,h(vt,Y)(n)):ht(t.values);var n},Tt=e=>s(e)&&De(e).length>100?" removed due to size":JSON.stringify(e,null,2),At=(e,t)=>vt([{path:e,getErrorInfo:t}]),Mt=e=>({extract:(t,n)=>((e,t)=>e.stype===dt.Error?t(e.serror):e)(e(n),(e=>((e,t)=>At(e,v(t)))(t,e))),toString:v("val")}),Rt=Mt(ht),Nt=(e,t,n,o)=>o($e(e,t).getOrThunk((()=>n(e)))),Ft=(e,t,n,o,r)=>{const s=e=>r.extract(t.concat([o]),e),a=e=>e.fold((()=>ht(E.none())),(e=>((e,t)=>e.stype===dt.Value?{stype:dt.Value,svalue:t(e.svalue)}:e)(r.extract(t.concat([o]),e),E.some)));switch(e.tag){case"required":return((e,t,n,o)=>$e(t,n).fold((()=>((e,t,n)=>At(e,(()=>'Could not find valid *required* value for "'+t+'" in '+Tt(n))))(e,n,t)),o))(t,n,o,s);case"defaultedThunk":return Nt(n,o,e.process,s);case"option":return((e,t,n)=>n($e(e,t)))(n,o,a);case"defaultedOptionThunk":return((e,t,n,o)=>o($e(e,t).map((t=>!0===t?n(e):t))))(n,o,e.process,a);case"mergeWithThunk":return Nt(n,o,v({}),(t=>{const o=xt(e.process(n),t);return s(o)}))}},Bt=e=>De(Ue(e,d)),Dt=e=>{const t=Ht(e),n=$(e,((e,t)=>yt(t,(t=>xt(e,{[t]:!0})),v(e))),{});return{extract:(e,o)=>{const r=c(o)?[]:Bt(o),s=z(r,(e=>!Ge(n,e)));return 0===s.length?t.extract(e,o):((e,t)=>At(e,(()=>"There are unsupported fields: ["+t.join(", ")+"] specified")))(e,s)},toString:t.toString}},Ht=e=>({extract:(t,n)=>((e,t,n)=>{const o={},r=[];for(const s of n)yt(s,((n,s,a,i)=>{const c=Ft(a,e,t,n,i);ft(c,(e=>{r.push(...e)}),(e=>{o[s]=e}))}),((e,n)=>{o[e]=n(t)}));return r.length>0?vt(r):ht(o)})(t,n,e),toString:()=>{const t=U(e,(e=>yt(e,((e,t,n,o)=>e+" -> "+o.toString()),((e,t)=>"state("+e+")"))));return"obj{\n"+t.join("\n")+"}"}}),Pt=e=>({extract:(t,n)=>{const o=U(n,((n,o)=>e.extract(t.concat(["["+o+"]"]),n)));return kt(o)},toString:()=>"array("+e.toString()+")"}),It=(e,t)=>({extract:(n,o)=>{const r=De(o),s=((t,n)=>Pt(Mt(e)).extract(t,n))(n,r);return((e,t)=>e.stype===dt.Value?t(e.svalue):e)(s,(e=>{const r=U(e,(e=>bt(e,e,{tag:"required",process:{}},t)));return Ht(r).extract(n,o)}))},toString:()=>"setOf("+t.toString()+")"}),Vt=v(Rt),Wt=(e,t)=>Mt((n=>{const o=typeof n;return e(n)?ht(n):vt(`Expected type: ${t} but got: ${o}`)})),Lt=Wt(r,"string"),Ut=Wt(c,"boolean"),jt=Wt(m,"function"),zt=(e,t)=>({extract:(n,o)=>$e(o,e).fold((()=>((e,t)=>At(e,(()=>'Choice schema did not contain choice key: "'+t+'"')))(n,e)),(e=>((e,t,n,o)=>$e(n,o).fold((()=>((e,t,n)=>At(e,(()=>'The chosen schema: "'+n+'" did not exist in branches: '+Tt(t))))(e,n,o)),(n=>n.extract(e.concat(["branch: "+o]),t))))(n,o,t,e))),toString:()=>"chooseOn("+e+"). Possible values: "+De(t)}),$t=e=>Mt((t=>e(t).fold(vt,ht))),qt=(e,t)=>It((t=>e(t).fold(pt,gt)),t),Gt=(e,t,n)=>{return o=((e,t,n)=>((e,t)=>e.stype===dt.Error?{stype:dt.Error,serror:t(e.serror)}:e)(t.extract([e],n),(e=>({input:n,errors:e}))))(e,t,n),mt(o,rt.error,rt.value);var o},Kt=e=>e.fold((e=>{throw new Error(Qt(e))}),f),Yt=(e,t,n)=>Kt(Gt(e,t,n)),Qt=e=>"Errors: \n"+(e=>{const t=e.length>10?e.slice(0,10).concat([{path:[],getErrorInfo:v("... (only showing first ten failures)")}]):e;return U(t,(e=>"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()))})(e.errors).join("\n")+"\n\nInput object: "+Tt(e.input),Jt=(e,t)=>zt(e,Ie(t,Ht)),Xt=bt,Zt=(e,t)=>({tag:"custom",newKey:e,instantiator:t}),en=e=>Xt(e,e,{tag:"required",process:{}},Vt()),tn=(e,t)=>Xt(e,e,{tag:"required",process:{}},t),nn=e=>tn(e,Ut),on=(e,t)=>Xt(e,e,{tag:"required",process:{}},Ht(t)),rn=e=>Xt(e,e,{tag:"option",process:{}},Vt()),sn=(e,t)=>Xt(e,e,{tag:"option",process:{}},t),an=(e,t)=>sn(e,Ht(t)),cn=(e,t)=>sn(e,Dt(t)),ln=(e,t)=>Xt(e,e,Ct(t),Vt()),un=(e,t,n)=>Xt(e,e,Ct(t),n),dn=Dt([nn("readonly"),nn("invalidSelection"),nn("saving")]),mn=e=>e.readonly||e.invalidSelection,gn=e=>mn(e)||e.saving,pn=pe("hr");var hn;!function(e){e[e.Change=0]="Change",e[e.NoChange=1]="NoChange"}(hn||(hn={}));const vn=(e,t,n,o)=>{let r={readonly:!1,saving:!1,invalidSelection:!1};const s=(e,t)=>{n.notificationManager.open({text:e,type:"error"}),t&&console.error(e,t)},a=(e,t)=>({view:{type:"splash"},grabFocus:()=>1===e||t}),i=(e,t,n)=>({view:{type:"comments",conversation:n},grabFocus:()=>t||W([1,3,4],e)}),c=(n,r)=>{t.set(n),t.get().fold((()=>ct.pure({response:hn.Change,update:a(r,o.hasFocus())})),(n=>e.lookup({conversationUid:n}).foldResult((()=>rt.value({response:hn.Change,update:a(r,o.hasFocus())})),(e=>{const n=t.get().forall((t=>t!==e.conversation.uid));return rt.value(n?{response:hn.NoChange}:{response:hn.Change,update:i(r,o.hasFocus(),e.conversation)})})))).get((e=>e.fold((e=>{s("An error occurred reading the conversation. See the Console for details.",e)}),(e=>{e.response===hn.Change&&(o.update(e.update),g())}))))},l=e=>{r={...r,readonly:e},m()},m=()=>{o.sendGlobalUiState(r),(e=>{e.dispatch("mce-tinycomments-uistate-updated")})(n)},g=()=>{var e;return t.get().isSome()||u(n.selection)?l(!1):(e=(e=>{const t=R(e.selection.getNode()),n=R(e.selection.getStart());return(e=>{let t=e.selection.getRng().commonAncestorContainer;return 3===t.nodeType&&(t=t.parentNode),!!d(t)&&e.dom.isEmpty(t)})(e)||pn(t)||pn(n)})(n)||(()=>{const e=(e,t,n)=>{const o=t.createRange();return o.selectNode(n.dom),o.compareBoundaryPoints(window.Range.END_TO_START,e)<0&&o.compareBoundaryPoints(window.Range.START_TO_END,e)>0};if(n.selection){const t=n.selection.getRng(),o=ut(R(t.commonAncestorContainer),`[${Ye()}="${Ke()}"]`);return L(o,y(e,t,n.getDoc()))}return!1})(),r={...r,invalidSelection:e},m()),mn(r)};return{refreshSidebar:c,refreshView:e=>{e.fold((()=>{c(E.none(),0)}),(({uid:e})=>{c(E.some(e),0)}))},setReadonly:l,isReadonly:()=>mn(r),setSaving:e=>{r={...r,saving:e},m()},showError:s,refreshReadonly:g}},fn=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},bn=()=>(new Date).toISOString(),yn=36e5,_n=864e5,xn=6048e5,wn=24192e5,On=290304e5;var Sn;!function(e){e[e.LessThanMinute=0]="LessThanMinute",e[e.Minute=1]="Minute",e[e.Hour=2]="Hour",e[e.Day=3]="Day",e[e.Week=4]="Week",e[e.Month=5]="Month",e[e.Year=6]="Year"}(Sn||(Sn={}));const Cn=y(((e,t)=>{const n=e()-Date.parse(t);return n<6e4?{interval:Sn.LessThanMinute,intervalUnits:n,intervalMs:n}:n<yn?{interval:Sn.Minute,intervalUnits:Math.floor(n/6e4),intervalMs:n}:n<_n?{interval:Sn.Hour,intervalUnits:Math.floor(n/yn),intervalMs:n}:n<xn?{interval:Sn.Day,intervalUnits:Math.floor(n/_n),intervalMs:n}:n<wn?{interval:Sn.Week,intervalUnits:Math.floor(n/xn),intervalMs:n}:n<On?{interval:Sn.Month,intervalUnits:Math.floor(n/wn),intervalMs:n}:{interval:Sn.Year,intervalUnits:Math.floor(n/On),intervalMs:n}}),(()=>Date.now())),En=(e,t="")=>{const n=e.get(),o=""===t?0:Date.parse(t);return{timestamp:bn(),events:o>0?z(n,(e=>Date.parse(e.timestamp)>o)):n}},kn="comments.globalUiState",Tn="comments.resize",An={init:()=>Mn({readState:v("No State required")})},Mn=e=>e,Rn=e=>{if(!i(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");const t=[],n={};return j(e,((o,r)=>{const s=De(o);if(1!==s.length)throw new Error("one and only one name per case");const a=s[0],c=o[a];if(void 0!==n[a])throw new Error("duplicate key detected:"+a);if("cata"===a)throw new Error("cannot have a case named cata (sorry)");if(!i(c))throw new Error("case arguments must be an array");t.push(a),n[a]=(...n)=>{const o=n.length;if(o!==c.length)throw new Error("Wrong number of arguments to case "+a+". Expected "+c.length+" ("+c+"), got "+o);return{fold:(...t)=>{if(t.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+t.length);return t[r].apply(null,n)},match:e=>{const o=De(e);if(t.length!==o.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+o.join(","));if(!J(t,(e=>W(o,e))))throw new Error("Not all branches were specified when using match. Specified: "+o.join(", ")+"\nRequired: "+t.join(", "));return e[a].apply(null,n)},log:e=>{console.log(e,{constructors:t,constructor:a,params:n})}}}})),n};Rn([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);const Nn=(e,t)=>((e,t)=>({[e]:t}))(e,t),Fn=e=>(e=>{const t={};return j(e,(e=>{t[e.key]=e.value})),t})(e),Bn=e=>m(e)?e:w,Dn=(e,t)=>ie(e.element,t.event.target),Hn={can:O,abort:w,run:p},Pn=e=>{if(!Ge(e,"can")&&!Ge(e,"abort")&&!Ge(e,"run"))throw new Error("EventHandler defined by: "+JSON.stringify(e,null,2)+" does not have can, abort, or run!");return{...Hn,...e}},In=()=>Vn(0,0),Vn=(e,t)=>({major:e,minor:t}),Wn={nu:Vn,detect:(e,t)=>{const n=String(t).toLowerCase();return 0===e.length?In():((e,t)=>{const n=((e,t)=>{for(let n=0;n<e.length;n++){const o=e[n];if(o.test(t))return o}})(e,t);if(!n)return{major:0,minor:0};const o=e=>Number(t.replace(n,"$"+e));return Vn(o(1),o(2))})(e,n)},unknown:In},Ln=(e,t)=>{const n=String(t).toLowerCase();return G(e,(e=>e.search(n)))},Un=(e,t,n=0,o)=>{const r=e.indexOf(t,n);return-1!==r&&(!!l(o)||r+t.length<=o)},jn=(e,t)=>((e,t,n)=>""===t||e.length>=t.length&&e.substr(n,n+t.length)===t)(e,t,e.length-t.length),zn=(e=>t=>t.replace(e,""))(/^\s+|\s+$/g),$n=e=>e.length>0,qn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Gn=e=>t=>Un(t,e),Kn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:e=>Un(e,"edge/")&&Un(e,"chrome")&&Un(e,"safari")&&Un(e,"applewebkit")},{name:"Chromium",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,qn],search:e=>Un(e,"chrome")&&!Un(e,"chromeframe")},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:e=>Un(e,"msie")||Un(e,"trident")},{name:"Opera",versionRegexes:[qn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Gn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Gn("firefox")},{name:"Safari",versionRegexes:[qn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:e=>(Un(e,"safari")||Un(e,"mobile/"))&&Un(e,"applewebkit")}],Yn=[{name:"Windows",search:Gn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:e=>Un(e,"iphone")||Un(e,"ipad"),versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Gn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"macOS",search:Gn("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Gn("linux"),versionRegexes:[]},{name:"Solaris",search:Gn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Gn("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Gn("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Qn={browsers:v(Kn),oses:v(Yn)},Jn="Edge",Xn="Chromium",Zn="Opera",eo="Firefox",to="Safari",no=e=>{const t=e.current,n=e.version,o=e=>()=>t===e;return{current:t,version:n,isEdge:o(Jn),isChromium:o(Xn),isIE:o("IE"),isOpera:o(Zn),isFirefox:o(eo),isSafari:o(to)}},oo=()=>no({current:void 0,version:Wn.unknown()}),ro=no,so=(v(Jn),v(Xn),v("IE"),v(Zn),v(eo),v(to),"Windows"),ao="Android",io="Linux",co="macOS",lo="Solaris",uo="FreeBSD",mo="ChromeOS",go=e=>{const t=e.current,n=e.version,o=e=>()=>t===e;return{current:t,version:n,isWindows:o(so),isiOS:o("iOS"),isAndroid:o(ao),isMacOS:o(co),isLinux:o(io),isSolaris:o(lo),isFreeBSD:o(uo),isChromeOS:o(mo)}},po=()=>go({current:void 0,version:Wn.unknown()}),ho=go,vo=(v(so),v("iOS"),v(ao),v(io),v(co),v(lo),v(uo),v(mo),e=>window.matchMedia(e).matches);let fo=Ot((()=>((e,t,n)=>{const o=Qn.browsers(),r=Qn.oses(),s=t.bind((e=>((e,t)=>re(t.brands,(t=>{const n=t.brand.toLowerCase();return G(e,(e=>{var t;return n===(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase())})).map((e=>({current:e.name,version:Wn.nu(parseInt(t.version,10),0)})))})))(o,e))).orThunk((()=>((e,t)=>Ln(e,t).map((e=>{const n=Wn.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(o,e))).fold(oo,ro),a=((e,t)=>Ln(e,t).map((e=>{const n=Wn.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(r,e).fold(po,ho),i=((e,t,n,o)=>{const r=e.isiOS()&&!0===/ipad/i.test(n),s=e.isiOS()&&!r,a=e.isiOS()||e.isAndroid(),i=a||o("(pointer:coarse)"),c=r||!s&&a&&o("(min-device-width:768px)"),l=s||a&&!c,u=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(n),d=!l&&!c&&!u;return{isiPad:v(r),isiPhone:v(s),isTablet:v(c),isPhone:v(l),isTouch:v(i),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:v(u),isDesktop:v(d)}})(a,s,e,n);return{browser:s,os:a,deviceType:i}})(navigator.userAgent,E.from(navigator.userAgentData),vo)));const bo=()=>fo(),yo=v,_o=yo("touchstart"),xo=yo("touchmove"),wo=yo("touchend"),Oo=yo("mousedown"),So=yo("mouseover"),Co=yo("keydown"),Eo=yo("keyup"),ko=yo("input"),To=yo("click"),Ao=yo("transitioncancel"),Mo=yo("transitionend"),Ro=yo("transitionstart"),No=e=>v("alloy."+e),Fo={tap:No("tap")},Bo=No("focus"),Do=No("blur.post"),Ho=No("paste.post"),Po=No("receive"),Io=No("execute"),Vo=No("focus.item"),Wo=Fo.tap,Lo=No("longpress"),Uo=No("sandbox.close"),jo=No("system.init"),zo=No("system.attached"),$o=No("system.detached"),qo=No("system.dismissRequested"),Go=No("system.repositionRequested"),Ko=No("focusmanager.shifted"),Yo=No("highlight"),Qo=No("dehighlight"),Jo=(e,t)=>{tr(e,e.element,t,{})},Xo=(e,t,n)=>{tr(e,e.element,t,n)},Zo=e=>{Jo(e,Io())},er=(e,t,n)=>{tr(e,t,n,{})},tr=(e,t,n,o)=>{const r={target:t,...o};e.getSystem().triggerEvent(n,t,r)},nr=e=>Fn(e),or=(e,t)=>({key:e,value:Pn({abort:t})}),rr=(e,t)=>({key:e,value:Pn({run:t})}),sr=e=>t=>({key:e,value:Pn({run:(e,n)=>{Dn(e,n)&&t(e,n)}})}),ar=e=>rr(e,((e,t)=>{t.cut()})),ir=e=>rr(e,((e,t)=>{t.stop()})),cr=(e,t)=>sr(e)(t),lr=sr(zo()),ur=sr($o()),dr=sr(jo()),mr=(e=>t=>rr(e,t))(Io()),gr=(e,t,n=b)=>e.exists((e=>n(e,t))),pr=e=>{const t=[],n=e=>{t.push(e)};for(let t=0;t<e.length;t++)e[t].each(n);return t},hr=(e,t,n)=>e.isSome()&&t.isSome()?E.some(n(e.getOrDie(),t.getOrDie())):E.none(),vr=e=>U(e,(e=>jn(e,"/*")?e.substring(0,e.length-"/*".length):e)),fr=(e,t)=>{const n=e.toString(),o=n.indexOf(")")+1,r=n.indexOf("("),s=n.substring(r+1,o-1).split(/,\s*/);return e.toFunctionAnnotation=()=>({name:t,parameters:vr(s)}),e},br=e=>({classes:l(e.classes)?[]:e.classes,attributes:l(e.attributes)?{}:e.attributes,styles:l(e.styles)?{}:e.styles}),yr=(e,t,n)=>dr(((o,r)=>{n(o,e,t)})),_r=e=>({key:e,value:void 0}),xr=(e,t,n,o,r,s,a)=>{const i=e=>Ge(e,n)?e[n]():E.none(),c=Ie(r,((e,t)=>((e,t,n)=>((e,t,n)=>{const o=n.toString(),r=o.indexOf(")")+1,s=o.indexOf("("),a=o.substring(s+1,r-1).split(/,\s*/);return e.toFunctionAnnotation=()=>({name:t,parameters:vr(a.slice(0,1).concat(a.slice(3)))}),e})(((o,...r)=>{const s=[o].concat(r);return o.config({name:v(e)}).fold((()=>{throw new Error("We could not find any behaviour configuration for: "+e+". Using API: "+n)}),(e=>{const n=Array.prototype.slice.call(s,1);return t.apply(void 0,[o,e.config,e.state].concat(n))}))}),n,t))(n,e,t))),l={...Ie(s,((e,t)=>fr(e,t))),...c,revoke:y(_r,n),config:t=>{const o=Yt(n+"-config",e,t);return{key:n,value:{config:o,me:l,configAsRaw:Ot((()=>Yt(n+"-config",e,t))),initialConfig:t,state:a}}},schema:v(t),exhibit:(e,t)=>hr(i(e),$e(o,"exhibit"),((e,n)=>n(t,e.config,e.state))).getOrThunk((()=>br({}))),name:v(n),handlers:e=>i(e).map((e=>$e(o,"events").getOr((()=>({})))(e.config,e.state))).getOr({})};return l},wr=e=>Fn(e),Or=Dt([en("fields"),en("name"),ln("active",{}),ln("apis",{}),ln("state",An),ln("extra",{})]),Sr=e=>{const t=Yt("Creating behaviour: "+e.name,Or,e);return((e,t,n,o,r,s)=>{const a=Dt(e),i=an(t,[cn("config",e)]);return xr(a,i,t,n,o,r,s)})(t.fields,t.name,t.active,t.apis,t.extra,t.state)},Cr=Dt([en("branchKey"),en("branches"),en("name"),ln("active",{}),ln("apis",{}),ln("state",An),ln("extra",{})]),Er=v(void 0),kr=(e,t)=>{const n=((e,t)=>{const n=nr(t);return Sr({fields:[en("enabled")],name:e,active:{events:v(n)}})})(e,t);return{key:e,value:{config:{},me:n,configAsRaw:v({}),initialConfig:{},state:An}}},Tr=()=>R(document),Ar=e=>e.dom.focus(),Mr=(e=Tr())=>E.from(e.dom.activeElement).map(R),Rr=e=>Mr(Ee(e)).filter((t=>e.dom.contains(t.dom))),Nr=(e,t)=>{j(t,(t=>{Be(e,t)}))},Fr=e=>{e.dom.textContent="",j(_e(e),(e=>{Br(e)}))},Br=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},Dr=e=>e.dom.innerHTML,Hr=(e,t)=>{const n=he(e).dom,o=R(n.createDocumentFragment()),r=((e,t)=>{const n=(t||document).createElement("div");return n.innerHTML=e,_e(R(n))})(t,n);Nr(o,r),Fr(e),Be(e,o)},Pr=(e,t,n)=>{if(!(r(n)||c(n)||g(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},Ir=(e,t,n)=>{Pr(e.dom,t,n)},Vr=(e,t)=>{const n=e.dom;Pe(t,((e,t)=>{Pr(n,t,e)}))},Wr=(e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n},Lr=(e,t)=>E.from(Wr(e,t)),Ur=(e,t)=>{const n=e.dom;return!(!n||!n.hasAttribute)&&n.hasAttribute(t)},jr=(e,t)=>{e.dom.removeAttribute(t)},zr=e=>Oe(e)?"#shadow-root":(e=>{const t=A("div"),n=R(e.dom.cloneNode(!0));return Be(t,n),Dr(t)})((e=>((e,t)=>R(e.dom.cloneNode(!1)))(e))(e)),$r=e=>zr(e);var qr;!function(e){e[e.STOP=0]="STOP",e[e.NORMAL=1]="NORMAL",e[e.LOGGING=2]="LOGGING"}(qr||(qr={}));const Gr=fn({}),Kr=["alloy/data/Fields","alloy/debugging/Debugging"],Yr=(e,t,n)=>((e,t,n)=>{switch($e(Gr.get(),e).orThunk((()=>{const t=De(Gr.get());return re(t,(t=>e.indexOf(t)>-1?E.some(Gr.get()[t]):E.none()))})).getOr(qr.NORMAL)){case qr.NORMAL:return n(Qr());case qr.LOGGING:{const o=((e,t)=>{const n=[],o=(new Date).getTime();return{logEventCut:(e,t,o)=>{n.push({outcome:"cut",target:t,purpose:o})},logEventStopped:(e,t,o)=>{n.push({outcome:"stopped",target:t,purpose:o})},logNoParent:(e,t,o)=>{n.push({outcome:"no-parent",target:t,purpose:o})},logEventNoHandlers:(e,t)=>{n.push({outcome:"no-handlers-left",target:t})},logEventResponse:(e,t,o)=>{n.push({outcome:"response",purpose:o,target:t})},write:()=>{const r=(new Date).getTime();W(["mousemove","mouseover","mouseout",jo()],e)||console.log(e,{event:e,time:r-o,target:t.dom,sequence:U(n,(e=>W(["cut","stopped","response"],e.outcome)?"{"+e.purpose+"} "+e.outcome+" at ("+$r(e.target)+")":e.outcome))})}}})(e,t),r=n(o);return o.write(),r}case qr.STOP:return!0}})(e,t,n),Qr=v({logEventCut:p,logEventStopped:p,logNoParent:p,logEventNoHandlers:p,logEventResponse:p,write:p}),Jr=e=>e.cHandler,Xr=e=>{const t=fn(E.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(E.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(E.some(e))}}},Zr=()=>Xr((e=>e.unbind())),es=()=>{const e=Xr(p);return{...e,on:t=>e.get().each(t)}};var ts=(e,t,n,o,r)=>e(n,o)?E.some(n):m(r)&&r(n)?E.none():t(n,o,r);const ns=(e,t,n)=>{let o=e.dom;const r=m(n)?n:w;for(;o.parentNode;){o=o.parentNode;const e=R(o);if(t(e))return E.some(e);if(r(e))break}return E.none()},os=(e,t,n)=>ts(((e,t)=>t(e)),ns,e,t,n),rs=(e,t,n)=>ns(e,(e=>se(e,t)),n),ss=(e,t)=>((e,t)=>{const n=void 0===t?document:t.dom;return ae(n)?E.none():E.from(n.querySelector(e)).map(R)})(t,e),as=(e,t,n)=>ts(((e,t)=>se(e,t)),rs,e,t,n),is=[8],cs=[9],ls=[13],us=[27],ds=[32],ms=[37],gs=[38],ps=[39],hs=[40],vs=e=>{const t=e.raw;return void 0===t.touches||1!==t.touches.length?E.none():E.some(t.touches[0])},fs=e=>{const t=es(),n=fn(!1),o=((e,t)=>{let n=null;return{cancel:()=>{null!==n&&(clearTimeout(n),n=null)},schedule:(...t)=>{n=setTimeout((()=>{e.apply(null,t),n=null}),400)}}})((t=>{e.triggerEvent(Lo(),t),n.set(!0)})),r=Fn([{key:_o(),value:e=>(vs(e).each((r=>{o.cancel();const s={x:r.clientX,y:r.clientY,target:e.target};o.schedule(e),n.set(!1),t.set(s)})),E.none())},{key:xo(),value:e=>(o.cancel(),vs(e).each((e=>{t.on((n=>{((e,t)=>{const n=Math.abs(e.clientX-t.x),o=Math.abs(e.clientY-t.y);return n>5||o>5})(e,n)&&t.clear()}))})),E.none())},{key:wo(),value:r=>(o.cancel(),t.get().filter((e=>ie(e.target,r.target))).map((t=>n.get()?(r.prevent(),!1):e.triggerEvent(Wo(),r))))}]);return{fireIfReady:(e,t)=>$e(r,t).bind((t=>t(e)))}},bs=(e,t)=>{const n=$e(e,"target").getOr(t);return fn(n)},ys=Rn([{stopped:[]},{resume:["element"]},{complete:[]}]),_s=(e,t,n,o,r,s)=>{const a=e(t,o),i=((e,t)=>{const n=fn(!1),o=fn(!1);return{stop:()=>{n.set(!0)},cut:()=>{o.set(!0)},isStopped:n.get,isCut:o.get,event:e,setSource:t.set,getSource:t.get}})(n,r);return a.fold((()=>(s.logEventNoHandlers(t,o),ys.complete())),(e=>{const n=e.descHandler;return Jr(n)(i),i.isStopped()?(s.logEventStopped(t,e.element,n.purpose),ys.stopped()):i.isCut()?(s.logEventCut(t,e.element,n.purpose),ys.complete()):be(e.element).fold((()=>(s.logNoParent(t,e.element,n.purpose),ys.complete())),(o=>(s.logEventResponse(t,e.element,n.purpose),ys.resume(o))))}))},xs=(e,t,n,o,r,s)=>_s(e,t,n,o,r,s).fold(O,(o=>xs(e,t,n,o,r,s)),w),ws=(e,t,n,o,r)=>{const s=bs(n,o);return xs(e,t,n,o,s,r)};let Os=0;const Ss=e=>{const t=(new Date).getTime(),n=Math.floor(1e9*Math.random());return Os++,e+"_"+n+Os+String(t)},Cs=v("alloy-id-"),Es=v("data-alloy-id"),ks=Cs(),Ts=Es(),As=(e,t)=>{Object.defineProperty(e.dom,Ts,{value:t,writable:!0})},Ms=e=>{const t=ue(e)?e.dom[Ts]:null;return E.from(t)},Rs=e=>Ss(e),Ns=()=>{const e={};return{registerId:(t,n,o)=>{Pe(o,((o,r)=>{const s=void 0!==e[r]?e[r]:{};s[n]=((e,t)=>({cHandler:y.apply(void 0,[e.handler].concat(t)),purpose:e.purpose}))(o,t),e[r]=s}))},unregisterId:t=>{Pe(e,((e,n)=>{qe(e,t)&&delete e[t]}))},filterByType:t=>$e(e,t).map((e=>je(e,((e,t)=>((e,t)=>({id:e,descHandler:t}))(t,e))))).getOr([]),find:(t,n,o)=>$e(e,n).bind((e=>((e,t,n)=>{const o=t(e),r=Bn(n);return o.orThunk((()=>r(e)?E.none():((e,t,n)=>{let o=e.dom;const r=Bn(n);for(;o.parentNode;){o=o.parentNode;const e=R(o),n=t(e);if(n.isSome())return n;if(r(e))break}return E.none()})(e,t,r)))})(o,(t=>((e,t)=>Ms(t).bind((t=>$e(e,t))).map((e=>((e,t)=>({element:e,descHandler:t}))(t,e))))(e,t)),t)))}},Fs=()=>{const e=Ns(),t={},n=n=>{Ms(n.element).each((n=>{delete t[n],e.unregisterId(n)}))};return{find:(t,n,o)=>e.find(t,n,o),filter:t=>e.filterByType(t),register:o=>{const r=(e=>{const t=e.element;return Ms(t).getOrThunk((()=>((e,t)=>{const n=Ss(ks+"uid-");return As(t,n),n})(0,e.element)))})(o);Ge(t,r)&&((e,o)=>{const r=t[o];if(r!==e)throw new Error('The tagId "'+o+'" is already used by: '+$r(r.element)+"\nCannot use it for: "+$r(e.element)+"\nThe conflicting element is"+(lt(r.element)?" ":" not ")+"already in the DOM");n(e)})(o,r);const s=[o];e.registerId(s,r,o.events),t[r]=o},unregister:n,getById:e=>$e(t,e)}},Bs=nr([((e,t)=>({key:e,value:Pn({can:(e,t)=>{const n=t.event,o=n.originator,r=n.target;return!((e,t,n)=>ie(t,e.element)&&!ie(t,n))(e,o,r)||(console.warn(Bo()+" did not get interpreted by the desired target. \nOriginator: "+$r(o)+"\nTarget: "+$r(r)+"\nCheck the "+Bo()+" event handlers"),!1)}})}))(Bo())]);var Ds=Object.freeze({__proto__:null,events:Bs});const Hs=f,Ps=e=>{const t=t=>`The component must be in a context to execute: ${t}`+(e?"\n"+$r(e().element)+" is not in context.":""),n=e=>()=>{throw new Error(t(e))},o=e=>()=>{console.warn(t(e))};return{debugInfo:v("fake"),triggerEvent:o("triggerEvent"),triggerFocus:o("triggerFocus"),triggerEscape:o("triggerEscape"),broadcast:o("broadcast"),broadcastOn:o("broadcastOn"),broadcastEvent:o("broadcastEvent"),build:n("build"),buildOrPatch:n("buildOrPatch"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),isConnected:w}},Is=Ps(),Vs=Ss("alloy-premade"),Ws=e=>(Object.defineProperty(e.element.dom,Vs,{value:e.uid,writable:!0}),Nn(Vs,e)),Ls=e=>$e(e,Vs),Us=e=>((e,t)=>{const n=t.toString(),o=n.indexOf(")")+1,r=n.indexOf("("),s=n.substring(r+1,o-1).split(/,\s*/);return e.toFunctionAnnotation=()=>({name:"OVERRIDE",parameters:vr(s.slice(1))}),e})(((t,...n)=>e(t.getApis(),t,...n)),e),js=(e,t)=>{const n={};return Pe(e,((e,o)=>{Pe(e,((e,r)=>{const s=$e(n,r).getOr([]);n[r]=s.concat([t(o,e)])}))})),n},zs=(e,t,n,o)=>{try{const r=((n,r)=>{const s=P.call(n,0);return s.sort(((n,r)=>{const s=n[t],a=r[t],i=o.indexOf(s),c=o.indexOf(a);if(-1===i)throw new Error("The ordering for "+e+" does not have an entry for "+s+".\nOrder specified: "+JSON.stringify(o,null,2));if(-1===c)throw new Error("The ordering for "+e+" does not have an entry for "+a+".\nOrder specified: "+JSON.stringify(o,null,2));return i<c?-1:c<i?1:0})),s})(n);return rt.value(r)}catch(e){return rt.error([e])}},$s=(e,t)=>({name:e,handler:t}),qs=(e,t)=>{const n={};return j(e,(e=>{n[e.name()]=e.handlers(t)})),n},Gs=(e,t,n)=>{const o=t[n];return o?zs("Event: "+n,"name",e,o).map((e=>(e=>{const t=((e,t)=>(...t)=>q(e,((e,n)=>e&&(e=>e.can)(n).apply(void 0,t)),!0))(e),n=((e,t)=>(...t)=>q(e,((e,n)=>e||(e=>e.abort)(n).apply(void 0,t)),!1))(e);return{can:t,abort:n,run:(...t)=>{j(e,(e=>{e.run.apply(void 0,t)}))}}})(U(e,(e=>e.handler))))):((e,t)=>rt.error(["The event ("+e+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(U(t,(e=>e.name)),null,2)]))(n,e)},Ks=(e,t)=>{const n=je(e,((e,n)=>(1===e.length?rt.value(e[0].handler):Gs(e,t,n)).map((o=>{const r=(e=>{const t=(e=>m(e)?{can:O,abort:w,run:e}:e)(e);return(e,n,...o)=>{const r=[e,n].concat(o);t.abort.apply(void 0,r)?n.stop():t.can.apply(void 0,r)&&t.run.apply(void 0,r)}})(o),s=e.length>1?z(t[n],(t=>L(e,(e=>e.name===t)))).join(" > "):e[0].name;return Nn(n,((e,t)=>({handler:e,purpose:t}))(r,s))}))));return((e,t)=>{const n=(e=>{const t=[],n=[];return j(e,(e=>{e.fold((e=>{t.push(e)}),(e=>{n.push(e)}))})),{errors:t,values:n}})(e);return n.errors.length>0?(o=n.errors,rt.error(Y(o))):((e,t)=>0===e.length?rt.value(t):rt.value(xt(t,wt.apply(void 0,e))))(n.values,t);var o})(n,{})},Ys="alloy.base.behaviour",Qs=Ht([Xt("dom","dom",{tag:"required",process:{}},Ht([en("tag"),ln("styles",{}),ln("classes",[]),ln("attributes",{}),rn("value"),rn("innerHtml")])),en("components"),en("uid"),ln("events",{}),ln("apis",{}),Xt("eventOrder","eventOrder",(Ia={[Io()]:["disabling",Ys,"toggling","typeaheadevents"],[Bo()]:[Ys,"focusing","keying"],[jo()]:[Ys,"disabling","toggling","representing"],[ko()]:[Ys,"representing","streaming","invalidating"],[$o()]:[Ys,"representing","item-events","tooltipping"],[Oo()]:["focusing",Ys,"item-type-events"],[_o()]:["focusing",Ys,"item-type-events"],[So()]:["item-type-events","tooltipping"],[Po()]:["receiving","reflecting","tooltipping"]},Et(v(Ia))),Vt()),rn("domModification")]),Js=e=>e.events,Xs=(e,t)=>{const n=Wr(e,t);return void 0===n||""===n?[]:n.split(" ")},Zs=e=>void 0!==e.dom.classList,ea=e=>Xs(e,"class"),ta=(e,t)=>{Zs(e)?e.dom.classList.add(t):((e,t)=>{((e,t,n)=>{const o=Xs(e,t).concat([n]);Ir(e,t,o.join(" "))})(e,"class",t)})(e,t)},na=(e,t)=>{Zs(e)?e.dom.classList.remove(t):((e,t)=>{((e,t,n)=>{const o=z(Xs(e,t),(e=>e!==n));o.length>0?Ir(e,t,o.join(" ")):jr(e,t)})(e,"class",t)})(e,t),(e=>{0===(Zs(e)?e.dom.classList:ea(e)).length&&jr(e,"class")})(e)},oa=(e,t)=>Zs(e)&&e.dom.classList.contains(t),ra=(e,t)=>{j(t,(t=>{ta(e,t)}))},sa=(e,t)=>{j(t,(t=>{na(e,t)}))},aa=e=>void 0!==e.style&&m(e.style.getPropertyValue),ia=(e,t,n)=>{if(!r(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);aa(e)&&e.style.setProperty(t,n)},ca=(e,t)=>{aa(e)&&e.style.removeProperty(t)},la=(e,t,n)=>{const o=e.dom;ia(o,t,n)},ua=(e,t)=>{const n=e.dom;Pe(t,((e,t)=>{ia(n,t,e)}))},da=(e,t)=>{const n=e.dom;Pe(t,((e,t)=>{e.fold((()=>{ca(n,t)}),(e=>{ia(n,t,e)}))}))},ma=(e,t)=>{const n=e.dom,o=window.getComputedStyle(n).getPropertyValue(t);return""!==o||lt(e)?o:ga(n,t)},ga=(e,t)=>aa(e)?e.style.getPropertyValue(t):"",pa=(e,t)=>{const n=e.dom,o=ga(n,t);return E.from(o).filter((e=>e.length>0))},ha=(e,t)=>{const n=e.dom;ca(n,t),gr(Lr(e,"style").map(zn),"")&&jr(e,"style")},va=e=>e.dom.offsetWidth,fa=e=>e.dom.value,ba=(e,t)=>{if(void 0===t)throw new Error("Value.set was undefined");e.dom.value=t},ya=(e,t,n)=>{n.fold((()=>Be(e,t)),(e=>{ie(e,t)||(Ne(e,t),Br(e))}))},_a=(e,t,n)=>{const o=U(t,n),r=_e(e);return j(r.slice(o.length),Br),o},xa=(e,t,n,o)=>{const r=xe(e,t),s=o(n,r),a=((e,t,n)=>xe(e,t).map((e=>{if(n.exists((t=>!ie(t,e)))){const t=n.map(ce).getOr("span"),o=A(t);return Ne(e,o),o}return e})))(e,t,r);return ya(e,s.element,a),s},wa=(e,t)=>{const n=De(e),o=De(t),r=Z(o,n),s=((e,n)=>{const o={},r={};return Le(e,((e,n)=>!qe(t,n)||e!==t[n]),We(o),We(r)),{t:o,f:r}})(e).t;return{toRemove:r,toSet:s}},Oa=(e,t)=>{const{class:n,style:o,...r}=(e=>q(e.dom.attributes,((e,t)=>(e[t.name]=t.value,e)),{}))(t),{toSet:s,toRemove:a}=wa(e.attributes,r),i=(e=>{const t={},n=e.dom;if(aa(n))for(let e=0;e<n.style.length;e++){const o=n.style.item(e);t[o]=n.style[o]}return t})(t),{toSet:c,toRemove:l}=wa(e.styles,i),u=(e=>Zs(e)?(e=>{const t=e.dom.classList,n=new Array(t.length);for(let e=0;e<t.length;e++){const o=t.item(e);null!==o&&(n[e]=o)}return n})(e):ea(e))(t),d=Z(u,e.classes),m=Z(e.classes,u);return j(a,(e=>jr(t,e))),Vr(t,s),ra(t,m),sa(t,d),j(l,(e=>ha(t,e))),ua(t,c),e.innerHtml.fold((()=>{const n=e.domChildren;((e,t)=>{_a(e,t,((t,n)=>{const o=xe(e,n);return ya(e,t,o),t}))})(t,n)}),(e=>{Hr(t,e)})),(()=>{const n=t,o=e.value.getOrUndefined();o!==fa(n)&&ba(n,null!=o?o:"")})(),t},Sa=e=>{const t=(e=>{const t=$e(e,"behaviours").getOr({});return Q(De(t),(e=>{const n=t[e];return d(n)?[n.me]:[]}))})(e);return((e,t)=>((e,t)=>{const n=U(t,(e=>an(e.name(),[en("config"),ln("state",An)]))),o=Gt("component.behaviours",Ht(n),e.behaviours).fold((t=>{throw new Error(Qt(t)+"\nComplete spec:\n"+JSON.stringify(e,null,2))}),f);return{list:t,data:Ie(o,(e=>{const t=e.map((e=>({config:e.config,state:e.state.init(e.config)})));return v(t)}))}})(e,t))(e,t)},Ca=(e,t)=>{const n=()=>g,o=fn(Is),r=Kt((e=>Gt("custom.definition",Qs,e))(e)),s=Sa(e),a=(e=>e.list)(s),i=(e=>e.data)(s),c=((e,t,n)=>{const o={...(r=e).dom,uid:r.uid,domChildren:U(r.components,(e=>e.element))};var r;const s=(e=>e.domModification.fold((()=>br({})),br))(e),a={"alloy.base.modification":s},i=t.length>0?((e,t,n,o)=>{const r={...t};j(n,(t=>{r[t.name()]=t.exhibit(e,o)}));const s=js(r,((e,t)=>({name:e,modification:t}))),a=e=>$(e,((e,t)=>({...t.modification,...e})),{}),i=$(s.classes,((e,t)=>t.modification.concat(e)),[]),c=a(s.attributes),l=a(s.styles);return br({classes:i,attributes:c,styles:l})})(n,a,t,o):s;return c=o,l=i,{...c,attributes:{...c.attributes,...l.attributes},styles:{...c.styles,...l.styles},classes:c.classes.concat(l.classes)};var c,l})(r,a,i),l=((e,t)=>{const n=t.filter((t=>ce(t)===e.tag&&!(e=>e.innerHtml.isSome()&&e.domChildren.length>0)(e)&&!(e=>qe(e.dom,Vs))(t))).bind((t=>((e,t)=>{try{const n=Oa(e,t);return E.some(n)}catch(e){return E.none()}})(e,t))).getOrThunk((()=>(e=>{const t=A(e.tag);Vr(t,e.attributes),ra(t,e.classes),ua(t,e.styles),e.innerHtml.each((e=>Hr(t,e)));const n=e.domChildren;return Nr(t,n),e.value.each((e=>{ba(t,e)})),t})(e)));return As(n,e.uid),n})(c,t),u=((e,t,n)=>{const o={"alloy.base.behaviour":Js(e)};return((e,t,n,o)=>{const r=((e,t,n)=>{const o={...n,...qs(t,e)};return js(o,$s)})(e,n,o);return Ks(r,t)})(n,e.eventOrder,t,o).getOrDie()})(r,a,i),d=fn(r.components),g={uid:e.uid,getSystem:o.get,config:t=>{const n=i;return(m(n[t.name()])?n[t.name()]:()=>{throw new Error("Could not find "+t.name()+" in "+JSON.stringify(e,null,2))})()},hasConfigured:e=>m(i[e.name()]),spec:e,readState:e=>i[e]().map((e=>e.state.readState())).getOr("not enabled"),getApis:()=>r.apis,connect:e=>{o.set(e)},disconnect:()=>{o.set(Ps(n))},element:l,syncComponents:()=>{const e=_e(l),t=Q(e,(e=>o.get().getByDom(e).fold((()=>[]),te)));d.set(t)},components:d.get,events:u};return g},Ea=e=>{const t=M(e);return ka({element:t})},ka=e=>{const t=Yt("external.component",Dt([en("element"),rn("uid")]),e),n=fn(Ps()),o=t.uid.getOrThunk((()=>Rs("external")));As(t.element,o);const r={uid:o,getSystem:n.get,config:E.none,hasConfigured:w,connect:e=>{n.set(e)},disconnect:()=>{n.set(Ps((()=>r)))},getApis:()=>({}),element:t.element,spec:e,readState:v("No state"),syncComponents:p,components:v([]),events:{}};return Ws(r)},Ta=Rs,Aa=(e,t)=>Ls(e).getOrThunk((()=>((e,t)=>{const{events:n,...o}=Hs(e),r=((e,t)=>{const n=$e(e,"components").getOr([]);return t.fold((()=>U(n,Ma)),(e=>U(n,((t,n)=>Aa(t,xe(e,n))))))})(o,t),s={...o,events:{...Ds,...n},components:r};return rt.value(Ca(s,t))})((e=>qe(e,"uid"))(e)?e:{uid:Ta(""),...e},t).getOrDie())),Ma=e=>Aa(e,E.none()),Ra=Ws,Na=(e,t)=>((e,t,n)=>un(e,{},Ht(n)))(e,0,U(t,(t=>{return n=t.name(),o="Cannot configure "+t.name()+" for "+e,Xt(n,n,{tag:"option",process:{}},Mt((e=>vt("The field: "+n+" is forbidden. "+o))));var n,o})).concat([Zt("dump",f)])),Fa=(e,t)=>({...wr(t),...e.dump}),Ba=Na,Da=Fa,Ha=v([en("menu"),en("selectedMenu")]),Pa=v([en("item"),en("selectedItem")]);var Ia;v(Ht(Pa().concat(Ha())));const Va=v(Ht(Pa())),Wa=on("initSize",[en("numColumns"),en("numRows")]),La=()=>on("markers",[en("backgroundMenu")].concat(Ha()).concat(Pa())),Ua=(e,t,n)=>((()=>{const e=new Error;if(void 0!==e.stack){const t=e.stack.split("\n");G(t,(e=>e.indexOf("alloy")>0&&!L(Kr,(t=>e.indexOf(t)>-1)))).getOr("unknown")}})(),Xt(t,t,n,$t((e=>rt.value(((...t)=>e.apply(void 0,t))))))),ja=e=>Ua(0,e,Ct(p)),za=e=>Ua(0,e,Ct(E.none)),$a=e=>Ua(0,e,{tag:"required",process:{}}),qa=e=>Ua(0,e,{tag:"required",process:{}}),Ga=(e,t)=>Zt(e,v(t)),Ka=e=>Zt(e,f),Ya=v(Wa),Qa="placeholder",Ja=Rn([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Xa=e=>qe(e,"uiType"),Za=(e,t,n,o)=>((e,t,n,o)=>Xa(n)&&n.uiType===Qa?((e,t,n,o)=>e.exists((e=>e!==n.owner))?Ja.single(!0,v(n)):$e(o,n.name).fold((()=>{throw new Error("Unknown placeholder component: "+n.name+"\nKnown: ["+De(o)+"]\nNamespace: "+e.getOr("none")+"\nSpec: "+JSON.stringify(n,null,2))}),(e=>e.replace())))(e,0,n,o):Ja.single(!1,v(n)))(e,0,n,o).fold(((r,s)=>{const a=Xa(n)?s(t,n.config,n.validated):s(t),i=$e(a,"components").getOr([]),c=Q(i,(n=>Za(e,t,n,o)));return[{...a,components:c}]}),((e,o)=>{if(Xa(n)){const e=o(t,n.config,n.validated);return n.validated.preprocess.getOr(f)(e)}return o(t)})),ei=Ja.single,ti=Ja.multiple,ni=v(Qa),oi=Rn([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),ri=ln("factory",{sketch:f}),si=ln("schema",[]),ai=en("name"),ii=Xt("pname","pname",St((e=>"<alloy."+Ss(e.name)+">")),Vt()),ci=Zt("schema",(()=>[rn("preprocess")])),li=ln("defaults",v({})),ui=ln("overrides",v({})),di=Ht([ri,si,ai,ii,li,ui]),mi=Ht([ri,si,ai,li,ui]),gi=Ht([ri,si,ai,ii,li,ui]),pi=Ht([ri,ci,ai,en("unit"),ii,li,ui]),hi=e=>{const t=e=>e.name;return e.fold(t,t,t,t)},vi=(e,t)=>n=>{const o=Yt("Converting part type",t,n);return e(o)},fi=vi(oi.required,di),bi=vi(oi.external,mi),yi=vi(oi.optional,gi),_i=vi(oi.group,pi),xi=v("entirety"),wi=(e,t,n,o)=>xt(t.defaults(e,n,o),n,{uid:e.partUids[t.name]},t.overrides(e,n,o)),Oi=(e,t)=>({uiType:ni(),owner:e,name:t}),Si=(e,t,n)=>((e,t,n)=>{const o={},r={};return j(n,(e=>{e.fold((e=>{o[e.pname]=ei(!0,((t,n,o)=>e.factory.sketch(wi(t,e,n,o))))}),(e=>{const n=t.parts[e.name];r[e.name]=v(e.factory.sketch(wi(t,e,n[xi()]),n))}),(e=>{o[e.pname]=ei(!1,((t,n,o)=>e.factory.sketch(wi(t,e,n,o))))}),(e=>{o[e.pname]=ti(!0,((t,n,o)=>{const r=t[e.name];return U(r,(n=>e.factory.sketch(xt(e.defaults(t,n,o),n,e.overrides(t,n)))))}))}))})),{internals:v(o),externals:v(r)}})(0,t,n),Ci=(e,t,n)=>((e,t,n,o)=>{const r=Ie(o,((e,t)=>((e,t)=>{let n=!1;return{name:v(e),required:()=>t.fold(((e,t)=>e),((e,t)=>e)),used:()=>n,replace:()=>{if(n)throw new Error("Trying to use the same placeholder more than once: "+e);return n=!0,t}}})(t,e))),s=((e,t,n,o)=>Q(n,(n=>Za(e,t,n,o))))(e,t,n,r);return Pe(r,(n=>{if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+JSON.stringify(t.components,null,2))})),s})(E.some(e),t,t.components,n),Ei=e=>Xt("partUids","partUids",Et((t=>((e,t)=>{const n=(e=>U(e,hi))(t);return Fn(U(n,(t=>({key:t,value:e+"-"+t}))))})(t.uid,e))),Vt()),ki=(e,t,n,o,r)=>{const s=((e,t)=>(e.length>0?[on("parts",e)]:[]).concat([en("uid"),ln("dom",{}),ln("components",[]),Ka("originalSpec"),ln("debug.sketcher",{})]).concat(t))(o,r);return Yt(e+" [SpecSchema]",Dt(s.concat(t)),n)},Ti=e=>(e=>qe(e,"uid"))(e)?e:{...e,uid:Rs("uid")},Ai=Dt([en("name"),en("factory"),en("configFields"),ln("apis",{}),ln("extraApis",{})]),Mi=Dt([en("name"),en("factory"),en("configFields"),en("partFields"),ln("apis",{}),ln("extraApis",{})]),Ri=e=>{const t=Yt("Sketcher for "+e.name,Ai,e),n=Ie(t.apis,Us),o=Ie(t.extraApis,((e,t)=>fr(e,t)));return{name:t.name,configFields:t.configFields,sketch:e=>((e,t,n,o)=>{const r=Ti(o);return n(ki(e,t,r,[],[]),r)})(t.name,t.configFields,t.factory,e),...n,...o}},Ni=e=>{const t=Yt("Sketcher for "+e.name,Mi,e),n=((e,t)=>{const n={};return j(t,(t=>{(e=>e.fold(E.some,E.none,E.some,E.some))(t).each((t=>{const o=Oi(e,t.pname);n[t.name]=n=>{const r=Yt("Part: "+t.name+" in "+e,Ht(t.schema),n);return{...o,config:n,validated:r}}}))})),n})(t.name,t.partFields),o=Ie(t.apis,Us),r=Ie(t.extraApis,((e,t)=>fr(e,t)));return{name:t.name,partFields:t.partFields,configFields:t.configFields,sketch:e=>((e,t,n,o,r)=>{const s=Ti(r),a=(e=>Q(e,(e=>e.fold(E.none,E.some,E.none,E.none).map((e=>on(e.name,e.schema.concat([Ka(xi())])))).toArray())))(n),i=Ei(n),c=ki(e,t,s,a,[i]),l=Si(0,c,n);return o(c,Ci(e,c,l.internals()),s,l.externals())})(t.name,t.configFields,t.partFields,t.factory,e),parts:n,...o,...r}};Ri({name:"Container",factory:e=>{const{attributes:t,...n}=e.dom;return{uid:e.uid,dom:{tag:"div",attributes:{role:"presentation",...t},...n},components:e.components,behaviours:(o=e.containerBehaviours,o.dump),events:e.events,domModification:e.domModification,eventOrder:e.eventOrder};var o},configFields:[ln("components",[]),Na("containerBehaviours",[]),ln("events",{}),ln("domModification",{}),ln("eventOrder",{})]});const Fi=e=>e.getSystem().isConnected(),Bi=e=>{Jo(e,$o());const t=e.components();j(t,Bi)},Di=e=>{const t=e.components();j(t,Di),Jo(e,zo())},Hi=(e,t)=>{e.getSystem().addToWorld(t),lt(e.element)&&Di(t)},Pi=e=>{Bi(e),e.getSystem().removeFromWorld(e)},Ii=(e,t)=>{Be(e.element,t.element)},Vi=(e,t)=>{Wi(e,t,Be)},Wi=(e,t,n)=>{e.getSystem().addToWorld(t),n(e.element,t.element),lt(e.element)&&Di(t),e.syncComponents()},Li=e=>{Bi(e),Br(e.element),e.getSystem().removeFromWorld(e)},Ui=e=>{const t=be(e.element).bind((t=>e.getSystem().getByDom(t).toOptional()));Li(e),t.each((e=>{e.syncComponents()}))},ji=e=>{const t=e.components();j(t,Li),Fr(e.element),e.syncComponents()},zi=e=>{const t=t=>be(e.element).fold(O,(e=>ie(t,e))),n=Fs(),o=(e,o)=>n.find(t,e,o),r=((e,t)=>{const n={stopBackspace:!0,...t},o=fs(n),r=U(["touchstart","touchmove","touchend","touchcancel","gesturestart","mousedown","mouseup","mouseover","mousemove","mouseout","click"].concat(["selectstart","input","contextmenu","change","transitionend","transitioncancel","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),(t=>Re(e,t,(e=>{o.fireIfReady(e,t).each((t=>{t&&e.kill()})),n.triggerEvent(t,e)&&e.kill()})))),s=es(),a=Re(e,"paste",(e=>{o.fireIfReady(e,"paste").each((t=>{t&&e.kill()})),n.triggerEvent("paste",e)&&e.kill(),s.set(setTimeout((()=>{n.triggerEvent(Ho(),e)}),0))})),i=Re(e,"keydown",(e=>{n.triggerEvent("keydown",e)?e.kill():n.stopBackspace&&(e=>{return e.raw.which===is[0]&&!W(["input","textarea"],ce(e.target))&&(t=e.target,!as(t,'[contenteditable="true"]',void 0).isSome());var t})(e)&&e.prevent()})),c=Re(e,"focusin",(e=>{n.triggerEvent("focusin",e)&&e.kill()})),l=es(),u=Re(e,"focusout",(e=>{n.triggerEvent("focusout",e)&&e.kill(),l.set(setTimeout((()=>{n.triggerEvent(Do(),e)}),0))}));return{unbind:()=>{j(r,(e=>{e.unbind()})),i.unbind(),c.unbind(),u.unbind(),a.unbind(),s.on(clearTimeout),l.on(clearTimeout)}}})(e.element,{triggerEvent:(e,t)=>Yr(e,t.target,(n=>((e,t,n,o)=>ws(e,t,n,n.target,o))(o,e,t,n)))}),s={debugInfo:v("real"),triggerEvent:(e,t,n)=>{Yr(e,t,(r=>ws(o,e,n,t,r)))},triggerFocus:(e,t)=>{Ms(e).fold((()=>{Ar(e)}),(n=>{Yr(Bo(),e,(n=>(((e,t,n,o,r)=>{const s=bs(n,o);_s(e,t,n,o,s,r)})(o,Bo(),{originator:t,kill:p,prevent:p,target:e},e,n),!1)))}))},triggerEscape:(e,t)=>{s.triggerEvent("keydown",e.element,t.event)},getByUid:e=>h(e),getByDom:e=>f(e),build:Ma,buildOrPatch:Aa,addToGui:e=>{c(e)},removeFromGui:e=>{l(e)},addToWorld:e=>{a(e)},removeFromWorld:e=>{i(e)},broadcast:e=>{d(e)},broadcastOn:(e,t)=>{m(e,t)},broadcastEvent:(e,t)=>{g(e,t)},isConnected:O},a=e=>{e.connect(s),de(e.element)||(n.register(e),j(e.components(),a),s.triggerEvent(jo(),e.element,{target:e.element}))},i=e=>{de(e.element)||(j(e.components(),i),n.unregister(e)),e.disconnect()},c=t=>{Vi(e,t)},l=e=>{Ui(e)},u=e=>{const t=n.filter(Po());j(t,(t=>{const n=t.descHandler;Jr(n)(e)}))},d=e=>{u({universal:!0,data:e})},m=(e,t)=>{u({universal:!1,channels:e,data:t})},g=(e,t)=>((e,t,n)=>{const o=(e=>{const t=fn(!1);return{stop:()=>{t.set(!0)},cut:p,isStopped:t.get,isCut:w,event:e,setSource:_("Cannot set source of a broadcasted event"),getSource:_("Cannot get source of a broadcasted event")}})(t);return j(e,(e=>{const t=e.descHandler;Jr(t)(o)})),o.isStopped()})(n.filter(e),t),h=e=>n.getById(e).fold((()=>rt.error(new Error('Could not find component with uid: "'+e+'" in system.'))),rt.value),f=e=>{const t=Ms(e).getOr("not found");return h(t)};return a(e),{root:e,element:e.element,destroy:()=>{r.unbind(),Br(e.element)},add:c,remove:l,getByUid:h,getByDom:f,addToWorld:a,removeFromWorld:i,broadcast:d,broadcastOn:m,broadcastEvent:g}},$i=e=>{const t=(e=>void 0!==e.uid)(e)&&Ge(e,"uid")?e.uid:Rs("memento");return{get:e=>e.getSystem().getByUid(t).getOrDie(),getOpt:e=>e.getSystem().getByUid(t).toOptional(),asSpec:()=>({...e,uid:t})}};var qi=Object.freeze({__proto__:null,exhibit:(e,t)=>br({classes:[],styles:t.useFixed()?{}:{position:"relative"}})});const Gi=(e,t)=>({left:e,top:t,translate:(n,o)=>Gi(e+n,t+o)}),Ki=Gi,Yi=(e,t)=>void 0!==e?e:void 0!==t?t:0,Qi=e=>{const t=e.dom.ownerDocument,n=t.body,o=t.defaultView,r=t.documentElement;if(n===e.dom)return Ki(n.offsetLeft,n.offsetTop);const s=Yi(null==o?void 0:o.pageYOffset,r.scrollTop),a=Yi(null==o?void 0:o.pageXOffset,r.scrollLeft),i=Yi(r.clientTop,n.clientTop),c=Yi(r.clientLeft,n.clientLeft);return Ji(e).translate(a-c,s-i)},Ji=e=>{const t=e.dom,n=t.ownerDocument.body;return n===t?Ki(n.offsetLeft,n.offsetTop):lt(e)?(e=>{const t=e.getBoundingClientRect();return Ki(t.left,t.top)})(t):Ki(0,0)},Xi=(e,t)=>{const n=n=>{const o=t(n);if(o<=0||null===o){const t=ma(n,e);return parseFloat(t)||0}return o},o=(e,t)=>q(t,((t,n)=>{const o=ma(e,n),r=void 0===o?0:parseInt(o,10);return isNaN(r)?t:t+r}),0);return{set:(t,n)=>{if(!g(n)&&!n.match(/^[0-9]+$/))throw new Error(e+".set accepts only positive integer values. Value was "+n);const o=t.dom;aa(o)&&(o.style[e]=n+"px")},get:n,getOuter:n,aggregate:o,max:(e,t,n)=>{const r=o(e,n);return t>r?t-r:0}}},Zi=Xi("height",(e=>{const t=e.dom;return lt(e)?t.getBoundingClientRect().height:t.offsetHeight})),ec=e=>Zi.get(e),tc=e=>Zi.getOuter(e),nc=Xi("width",(e=>e.dom.offsetWidth)),oc=e=>nc.get(e),rc=e=>nc.getOuter(e),sc=e=>{const t=void 0!==e?e.dom:document,n=t.body.scrollLeft||t.documentElement.scrollLeft,o=t.body.scrollTop||t.documentElement.scrollTop;return Ki(n,o)},ac=(e,t,n,o)=>({x:e,y:t,width:n,height:o,right:e+n,bottom:t+o}),ic=(e,t)=>e.view(t).fold(v([]),(t=>{const n=e.owner(t),o=ic(e,n);return[t].concat(o)}));var cc=Object.freeze({__proto__:null,view:e=>{var t;return(e.dom===document?E.none():E.from(null===(t=e.dom.defaultView)||void 0===t?void 0:t.frameElement)).map(R)},owner:e=>he(e)});const lc=e=>{const t=Tr(),n=sc(t),o=((e,t)=>{const n=t.owner(e),o=ic(t,n);return E.some(o)})(e,cc);return o.fold(y(Qi,e),(t=>{const o=Ji(e),r=$(t,((e,t)=>{const n=Ji(t);return{left:e.left+n.left,top:e.top+n.top}}),{left:0,top:0});return Ki(r.left+o.left+n.left,r.top+o.top+n.top)}))},uc=(e,t,n,o)=>({x:e,y:t,width:n,height:o,right:e+n,bottom:t+o}),dc=e=>{const t=Qi(e),n=rc(e),o=tc(e);return uc(t.left,t.top,n,o)},mc=()=>(e=>{const t=void 0===e?window:e,n=t.document,o=sc(R(n));return(e=>{const t=void 0===e?window:e;return bo().browser.isFirefox()?E.none():E.from(t.visualViewport)})(t).fold((()=>{const e=t.document.documentElement,n=e.clientWidth,r=e.clientHeight;return ac(o.left,o.top,n,r)}),(e=>ac(Math.max(e.pageLeft,o.left),Math.max(e.pageTop,o.top),e.width,e.height)))})(window),gc=(e,t)=>{const n=Ee(t),o=Mr(n).bind((e=>{const n=t=>ie(e,t);return n(t)?E.some(t):((e,t)=>{const n=e=>{for(let o=0;o<e.childNodes.length;o++){const r=R(e.childNodes[o]);if(t(r))return E.some(r);const s=n(e.childNodes[o]);if(s.isSome())return s}return E.none()};return n(e.dom)})(t,n)})),r=e(t);return o.each((e=>{Mr(n).filter((t=>ie(t,e))).fold((()=>{Ar(e)}),p)})),r},pc=(e,t,n,o,r)=>{const s=e=>e+"px";return{position:e,left:t.map(s),top:n.map(s),right:o.map(s),bottom:r.map(s)}},hc=Rn([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),vc=hc.southeast,fc=hc.southwest,bc=hc.northeast,yc=hc.northwest,_c=hc.south,xc=hc.north,wc=hc.east,Oc=hc.west,Sc=Rn([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),Cc=(e,t,n,o,r,s)=>{const a=t.rect,i=a.x-n,c=a.y-o,l=r-(i+a.width),u=s-(c+a.height),d=E.some(i),m=E.some(c),g=E.some(l),p=E.some(u),h=E.none();return t.direction.fold((()=>pc(e,d,m,h,h)),(()=>pc(e,h,m,g,h)),(()=>pc(e,d,h,h,p)),(()=>pc(e,h,h,g,p)),(()=>pc(e,d,m,h,h)),(()=>pc(e,d,h,h,p)),(()=>pc(e,d,m,h,h)),(()=>pc(e,h,m,g,h)))},Ec=(e,t)=>e.fold((()=>{const e=t.rect;return pc("absolute",E.some(e.x),E.some(e.y),E.none(),E.none())}),((e,n,o,r)=>Cc("absolute",t,e,n,o,r)),((e,n,o,r)=>Cc("fixed",t,e,n,o,r))),kc=(e,t)=>{const n=y(lc,t),o=e.fold(n,n,(()=>{const e=sc();return lc(t).translate(-e.left,-e.top)})),r=rc(t),s=tc(t);return uc(o.left,o.top,r,s)},Tc=(e,t)=>t.fold((()=>e.fold(mc,mc,uc)),(t=>e.fold(t,t,(()=>{const n=t(),o=Ac(e,n.x,n.y);return uc(o.left,o.top,n.width,n.height)})))),Ac=(e,t,n)=>{const o=Ki(t,n);return e.fold(v(o),v(o),(()=>{const e=sc();return o.translate(-e.left,-e.top)}))};Sc.none;const Mc=Sc.relative,Rc=Sc.fixed,Nc="data-alloy-placement",Fc=(e,t,n,o)=>{const r=e+t;return r>o?n:r<n?o:r},Bc=(e,t,n)=>Math.min(Math.max(e,t),n),Dc=(e,t)=>ee(["left","right","top","bottom"],(n=>$e(t,n).map((t=>((e,t)=>{switch(t){case 1:return e.x;case 0:return e.x+e.width;case 2:return e.y;case 3:return e.y+e.height}})(e,t))))),Hc=Rn([{fit:["reposition"]},{nofit:["reposition","visibleW","visibleH","isVisible"]}]),Pc=(e,t,n,o)=>{const r=e.bubble,s=r.offset,a=((e,t,n)=>{const o=(o,r)=>t[o].map((t=>{const s="top"===o||"bottom"===o,a=s?n.top:n.left,i=("left"===o||"top"===o?Math.max:Math.min)(t,r)+a;return s?Bc(i,e.y,e.bottom):Bc(i,e.x,e.right)})).getOr(r),r=o("left",e.x),s=o("top",e.y),a=o("right",e.right),i=o("bottom",e.bottom);return uc(r,s,a-r,i-s)})(o,e.restriction,s),i=e.x+s.left,c=e.y+s.top,l=uc(i,c,t,n),{originInBounds:u,sizeInBounds:d,visibleW:m,visibleH:g}=((e,t)=>{const{x:n,y:o,right:r,bottom:s}=t,{x:a,y:i,right:c,bottom:l,width:u,height:d}=e;return{originInBounds:a>=n&&a<=r&&i>=o&&i<=s,sizeInBounds:c<=r&&c>=n&&l<=s&&l>=o,visibleW:Math.min(u,a>=n?r-a:c-n),visibleH:Math.min(d,i>=o?s-i:l-o)}})(l,a),p=u&&d,h=p?l:((e,t)=>{const{x:n,y:o,right:r,bottom:s}=t,{x:a,y:i,width:c,height:l}=e,u=Math.max(n,r-c),d=Math.max(o,s-l),m=Bc(a,n,u),g=Bc(i,o,d),p=Math.min(m+c,r)-m,h=Math.min(g+l,s)-g;return uc(m,g,p,h)})(l,a),f=h.width>0&&h.height>0,{maxWidth:b,maxHeight:y}=((e,t,n)=>{const o=v(t.bottom-n.y),r=v(n.bottom-t.y),s=((e,t,n,o)=>e.fold(t,t,o,o,t,o,n,n))(e,r,r,o),a=v(t.right-n.x),i=v(n.right-t.x),c=((e,t,n,o)=>e.fold(t,o,t,o,n,n,t,o))(e,i,i,a);return{maxWidth:c,maxHeight:s}})(e.direction,h,o),_={rect:h,maxHeight:y,maxWidth:b,direction:e.direction,placement:e.placement,classes:{on:r.classesOn,off:r.classesOff},layout:e.label,testY:c};return p||e.alwaysFit?Hc.fit(_):Hc.nofit(_,m,g,f)},Ic=["top","bottom","right","left"],Vc="data-alloy-transition-timer",Wc=(e,t,n,o,s,a)=>{const i=((e,t,n)=>n.exists((n=>{const o=e.mode;return"all"===o||n[o]!==t[o]})))(o,s,a);if(i||((e,t)=>((e,t)=>J(t,(t=>oa(e,t))))(e,t.classes))(e,o)){la(e,"position",n.position);const a=kc(t,e),c=Ec(t,{...s,rect:a}),l=ee(Ic,(e=>c[e]));((e,t)=>{const n=e=>parseFloat(e).toFixed(3);return ze(t,((t,o)=>!((e,t,n=b)=>hr(e,t,n).getOr(e.isNone()&&t.isNone()))(e[o].map(n),t.map(n)))).isSome()})(n,l)&&(da(e,l),i&&((e,t)=>{ra(e,t.classes),Lr(e,Vc).each((t=>{clearTimeout(parseInt(t,10)),jr(e,Vc)})),((e,t)=>{const n=Zr(),o=Zr();let s;const a=t=>{var n;const o=null!==(n=t.raw.pseudoElement)&&void 0!==n?n:"";return ie(t.target,e)&&!$n(o)&&W(Ic,t.raw.propertyName)},i=r=>{if(u(r)||a(r)){n.clear(),o.clear();const a=null==r?void 0:r.raw.type;(u(a)||a===Mo())&&(clearTimeout(s),jr(e,Vc),sa(e,t.classes))}},c=Re(e,Ro(),(t=>{a(t)&&(c.unbind(),n.set(Re(e,Mo(),i)),o.set(Re(e,Ao(),i)))})),l=(e=>{const t=t=>{const n=ma(e,t).split(/\s*,\s*/);return z(n,$n)},n=e=>{if(r(e)&&/^[\d.]+/.test(e)){const t=parseFloat(e);return jn(e,"ms")?t:1e3*t}return 0},o=t("transition-delay"),s=t("transition-duration");return q(s,((e,t,r)=>{const s=n(o[r])+n(t);return Math.max(e,s)}),0)})(e);requestAnimationFrame((()=>{s=setTimeout(i,l+17),Ir(e,Vc,s)}))})(e,t)})(e,o),va(e))}else sa(e,o.classes)},Lc=v(((e,t)=>{((e,t)=>{((e,t)=>{const n=Zi.max(e,t,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]);la(e,"max-height",n+"px")})(e,Math.floor(t))})(e,t),ua(e,{"overflow-x":"hidden","overflow-y":"auto"})})),Uc=(e,t,n)=>void 0===e[t]?n:e[t],jc=(e,t,n,o)=>{const r=((e,t,n,o)=>{ha(t,"max-height"),ha(t,"max-width");const r={width:rc(s=t),height:tc(s)};var s;return((e,t,n,o,r,s)=>{const a=o.width,i=o.height,c=(t,c,l,u,d)=>{const m=t(n,o,r,e,s),g=Pc(m,a,i,s);return g.fold(v(g),((e,t,n,o)=>(d===o?n>u||t>l:!d&&o)?g:Hc.nofit(c,l,u,d)))};return q(t,((e,t)=>{const n=y(c,t);return e.fold(v(e),n)}),Hc.nofit({rect:n,maxHeight:o.height,maxWidth:o.width,direction:vc(),placement:"southeast",classes:{on:[],off:[]},layout:"none",testY:n.y},-1,-1,!1)).fold(f,f)})(t,o.preference,e,r,n,o.bounds)})(e,t,n,o);return((e,t,n)=>{const o=Ec(n.origin,t);n.transition.each((r=>{Wc(e,n.origin,o,r,t,n.lastPlacement)})),((e,t)=>{da(e,(e=>({...e,position:E.some(e.position)}))(t))})(e,o)})(t,r,o),((e,t)=>{((e,t)=>{Ir(e,Nc,t)})(e,t.placement)})(t,r),((e,t)=>{const n=t.classes;sa(e,n.off),ra(e,n.on)})(t,r),((e,t,n)=>{(0,n.maxHeightFunction)(e,t.maxHeight)})(t,r,o),((e,t,n)=>{(0,n.maxWidthFunction)(e,t.maxWidth)})(t,r,o),{layout:r.layout,placement:r.placement}},zc=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right","inset"],$c=()=>((e,t,n,o=1)=>{const r=e*o,s=t*o,a=e=>$e(n,e).getOr([]),i=(e,t,n)=>{const o=Z(zc,n);return{offset:Ki(e,t),classesOn:Q(n,a),classesOff:Q(o,a)}};return{southeast:()=>i(-e,t,["top","alignLeft"]),southwest:()=>i(e,t,["top","alignRight"]),south:()=>i(-e/2,t,["top","alignCentre"]),northeast:()=>i(-e,-t,["bottom","alignLeft"]),northwest:()=>i(e,-t,["bottom","alignRight"]),north:()=>i(-e/2,-t,["bottom","alignCentre"]),east:()=>i(e,-t/2,["valignCentre","left"]),west:()=>i(-e,-t/2,["valignCentre","right"]),insetNortheast:()=>i(r,s,["top","alignLeft","inset"]),insetNorthwest:()=>i(-r,s,["top","alignRight","inset"]),insetNorth:()=>i(-r/2,s,["top","alignCentre","inset"]),insetSoutheast:()=>i(r,-s,["bottom","alignLeft","inset"]),insetSouthwest:()=>i(-r,-s,["bottom","alignRight","inset"]),insetSouth:()=>i(-r/2,-s,["bottom","alignCentre","inset"]),insetEast:()=>i(-r,-s/2,["valignCentre","right","inset"]),insetWest:()=>i(r,-s/2,["valignCentre","left","inset"])}})(0,0,{}),qc=(e,t,n,o,r,s,a,i=!1)=>({x:e,y:t,bubble:n,direction:o,placement:r,restriction:s,label:`${a}-${r}`,alwaysFit:i}),Gc="layout",Kc=e=>e.x,Yc=(e,t)=>e.x+e.width/2-t.width/2,Qc=(e,t)=>e.x+e.width-t.width,Jc=(e,t)=>e.y-t.height,Xc=e=>e.y+e.height,Zc=(e,t)=>e.y+e.height/2-t.height/2,el=(e,t,n)=>qc(Kc(e),Xc(e),n.southeast(),vc(),"southeast",Dc(e,{left:1,top:3}),Gc),tl=(e,t,n)=>qc(Qc(e,t),Xc(e),n.southwest(),fc(),"southwest",Dc(e,{right:0,top:3}),Gc),nl=(e,t,n)=>qc(Kc(e),Jc(e,t),n.northeast(),bc(),"northeast",Dc(e,{left:1,bottom:2}),Gc),ol=(e,t,n)=>qc(Qc(e,t),Jc(e,t),n.northwest(),yc(),"northwest",Dc(e,{right:0,bottom:2}),Gc),rl=(e,t,n)=>qc(Yc(e,t),Jc(e,t),n.north(),xc(),"north",Dc(e,{bottom:2}),Gc),sl=(e,t,n)=>qc(Yc(e,t),Xc(e),n.south(),_c(),"south",Dc(e,{top:3}),Gc),al=(e,t,n)=>qc((e=>e.x+e.width)(e),Zc(e,t),n.east(),wc(),"east",Dc(e,{left:0}),Gc),il=(e,t,n)=>qc(((e,t)=>e.x-t.width)(e,t),Zc(e,t),n.west(),Oc(),"west",Dc(e,{right:1}),Gc),cl=()=>[el,tl,nl,ol,sl,rl,al,il],ll=()=>[tl,el,ol,nl,sl,rl,al,il],ul=()=>[nl,ol,el,tl,rl,sl],dl=()=>[ol,nl,tl,el,rl,sl],ml=()=>[el,tl,nl,ol,sl,rl],gl=()=>[tl,el,ol,nl,sl,rl],pl=f,hl=(e,t)=>n=>"rtl"===vl(n)?t:e,vl=e=>"rtl"===ma(e,"direction")?"rtl":"ltr",fl=(e,t,n)=>os(e,t,n).isSome();var bl;!function(e){e.TopToBottom="toptobottom",e.BottomToTop="bottomtotop"}(bl||(bl={}));const yl=e=>fl(e,(e=>ue(e)&&Wr(e,"data-alloy-vertical-dir")===bl.BottomToTop)),_l=()=>an("layouts",[en("onLtr"),en("onRtl"),rn("onBottomLtr"),rn("onBottomRtl")]),xl=(e,t,n,o,r,s,a)=>{const i=a.map(yl).getOr(!1),c=t.layouts.map((t=>t.onLtr(e))),l=t.layouts.map((t=>t.onRtl(e))),u=i?t.layouts.bind((t=>t.onBottomLtr.map((t=>t(e))))).or(c).getOr(r):c.getOr(n),d=i?t.layouts.bind((t=>t.onBottomRtl.map((t=>t(e))))).or(l).getOr(s):l.getOr(o);return hl(u,d)(e)};var wl=[en("hotspot"),rn("bubble"),ln("overrides",{}),_l(),Ga("placement",((e,t,n)=>{const o=t.hotspot,r=kc(n,o.element),s=xl(e.element,t,ml(),gl(),ul(),dl(),E.some(t.hotspot.element));return E.some(pl({anchorBox:r,bubble:t.bubble.getOr($c()),overrides:t.overrides,layouts:s,placer:E.none()}))}))],Ol=[en("x"),en("y"),ln("height",0),ln("width",0),ln("bubble",$c()),ln("overrides",{}),_l(),Ga("placement",((e,t,n)=>{const o=Ac(n,t.x,t.y),r=uc(o.left,o.top,t.width,t.height),s=xl(e.element,t,cl(),ll(),cl(),ll(),E.none());return E.some(pl({anchorBox:r,bubble:t.bubble,overrides:t.overrides,layouts:s,placer:E.none()}))}))];const Sl=Rn([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),Cl=e=>e.fold(f,((e,t,n)=>e.translate(-t,-n))),El=e=>e.fold(f,f),kl=e=>q(e,((e,t)=>e.translate(t.left,t.top)),Ki(0,0)),Tl=e=>{const t=U(e,El);return kl(t)},Al=Sl.screen,Ml=Sl.absolute,Rl=(e,t,n)=>{const o=he(e.element),r=sc(o),s=((e,t,n)=>{const o=fe(n.root).dom;return E.from(o.frameElement).map(R).filter((t=>{const n=he(t),o=he(e.element);return ie(n,o)})).map(Qi)})(e,0,n).getOr(r);return Ml(s,r.left,r.top)},Nl=(e,t,n,o)=>{const r=Al(Ki(e,t));return E.some(((e,t,n)=>({point:e,width:t,height:n}))(r,n,o))},Fl=(e,t,n,o,r)=>e.map((e=>{const s=[t,e.point],a=(i=()=>Tl(s),c=()=>Tl(s),l=()=>(e=>{const t=U(e,Cl);return kl(t)})(s),o.fold(i,c,l));var i,c,l;const u={x:a.left,y:a.top,width:e.width,height:e.height};const d=n.showAbove?ul():ml(),m=n.showAbove?dl():gl(),g=xl(r,n,d,m,d,m,E.none());return pl({anchorBox:u,bubble:n.bubble.getOr($c()),overrides:n.overrides,layouts:g,placer:E.none()})}));var Bl=[en("node"),en("root"),rn("bubble"),_l(),ln("overrides",{}),ln("showAbove",!1),Ga("placement",((e,t,n)=>{const o=Rl(e,0,t);return t.node.filter(lt).bind((r=>{const s=r.dom.getBoundingClientRect(),a=Nl(s.left,s.top,s.width,s.height),i=t.node.getOr(e.element);return Fl(a,o,t,n,i)}))}))];const Dl=(e,t,n,o)=>({start:e,soffset:t,finish:n,foffset:o}),Hl=Rn([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Pl=(Hl.before,Hl.on,Hl.after,e=>e.fold(f,f,f)),Il=Rn([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Vl={domRange:Il.domRange,relative:Il.relative,exact:Il.exact,exactFromRange:e=>Il.exact(e.start,e.soffset,e.finish,e.foffset),getWin:e=>{const t=(e=>e.match({domRange:e=>R(e.startContainer),relative:(e,t)=>Pl(e),exact:(e,t,n,o)=>e}))(e);return fe(t)},range:Dl},Wl=(e,t,n)=>{const o=e.document.createRange();var r;return r=o,t.fold((e=>{r.setStartBefore(e.dom)}),((e,t)=>{r.setStart(e.dom,t)}),(e=>{r.setStartAfter(e.dom)})),((e,t)=>{t.fold((t=>{e.setEndBefore(t.dom)}),((t,n)=>{e.setEnd(t.dom,n)}),(t=>{e.setEndAfter(t.dom)}))})(o,n),o},Ll=(e,t,n,o,r)=>{const s=e.document.createRange();return s.setStart(t.dom,n),s.setEnd(o.dom,r),s},Ul=e=>({left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}),jl=Rn([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),zl=(e,t,n)=>t(R(n.startContainer),n.startOffset,R(n.endContainer),n.endOffset),$l=(e,t)=>((e,t)=>{const n=((e,t)=>t.match({domRange:e=>({ltr:v(e),rtl:E.none}),relative:(t,n)=>({ltr:Ot((()=>Wl(e,t,n))),rtl:Ot((()=>E.some(Wl(e,n,t))))}),exact:(t,n,o,r)=>({ltr:Ot((()=>Ll(e,t,n,o,r))),rtl:Ot((()=>E.some(Ll(e,o,r,t,n))))})}))(e,t);return((e,t)=>{const n=t.ltr();return n.collapsed?t.rtl().filter((e=>!1===e.collapsed)).map((e=>jl.rtl(R(e.endContainer),e.endOffset,R(e.startContainer),e.startOffset))).getOrThunk((()=>zl(0,jl.ltr,n))):zl(0,jl.ltr,n)})(0,n)})(e,t).match({ltr:(t,n,o,r)=>{const s=e.document.createRange();return s.setStart(t.dom,n),s.setEnd(o.dom,r),s},rtl:(t,n,o,r)=>{const s=e.document.createRange();return s.setStart(o.dom,r),s.setEnd(t.dom,n),s}});jl.ltr,jl.rtl;const ql=e=>{if(e.rangeCount>0){const t=e.getRangeAt(0),n=e.getRangeAt(e.rangeCount-1);return E.some(Dl(R(t.startContainer),t.startOffset,R(n.endContainer),n.endOffset))}return E.none()},Gl=e=>{if(null===e.anchorNode||null===e.focusNode)return ql(e);{const t=R(e.anchorNode),n=R(e.focusNode);return((e,t,n,o)=>{const r=((e,t,n,o)=>{const r=he(e).dom.createRange();return r.setStart(e.dom,t),r.setEnd(n.dom,o),r})(e,t,n,o),s=ie(e,n)&&t===o;return r.collapsed&&!s})(t,e.anchorOffset,n,e.focusOffset)?E.some(Dl(t,e.anchorOffset,n,e.focusOffset)):ql(e)}},Kl=((e,t)=>{const n=t=>e(t)?E.from(t.dom.nodeValue):E.none();return{get:t=>{if(!e(t))throw new Error("Can only get text value of a text node");return n(t).getOr("")},getOption:n,set:(t,n)=>{if(!e(t))throw new Error("Can only set raw text value of a text node");t.dom.nodeValue=n}}})(de),Yl=(e,t)=>({element:e,offset:t}),Ql=(e,t)=>de(e)?Yl(e,t):((e,t)=>{const n=_e(e);if(0===n.length)return Yl(e,t);if(t<n.length)return Yl(n[t],0);{const e=n[n.length-1],t=de(e)?(e=>Kl.get(e))(e).length:_e(e).length;return Yl(e,t)}})(e,t),Jl=(e,t)=>t.getSelection.getOrThunk((()=>()=>(e=>(e=>E.from(e.getSelection()))(e).filter((e=>e.rangeCount>0)).bind(Gl))(e)))().map((e=>{const t=Ql(e.start,e.soffset),n=Ql(e.finish,e.foffset);return Vl.range(t.element,t.offset,n.element,n.offset)}));var Xl=[rn("getSelection"),en("root"),rn("bubble"),_l(),ln("overrides",{}),ln("showAbove",!1),Ga("placement",((e,t,n)=>{const o=fe(t.root).dom,r=Rl(e,0,t),s=Jl(o,t).bind((e=>{const t=((e,t)=>(e=>{const t=e.getBoundingClientRect();return t.width>0||t.height>0?E.some(t).map(Ul):E.none()})($l(e,t)))(o,Vl.exactFromRange(e)).orThunk((()=>{const t=M("\ufeff");Ne(e.start,t);const n=((e,t)=>(e=>{const t=e.getClientRects(),n=t.length>0?t[0]:e.getBoundingClientRect();return n.width>0||n.height>0?E.some(n).map(Ul):E.none()})($l(e,t)))(o,Vl.exact(t,0,t,1));return Br(t),n}));return t.bind((e=>Nl(e.left,e.top,e.width,e.height)))})),a=Jl(o,t).bind((e=>ue(e.start)?E.some(e.start):ye(e.start))).getOr(e.element);return Fl(s,r,t,n,a)}))];const Zl="link-layout",eu=e=>e.x+e.width,tu=(e,t)=>e.x-t.width,nu=(e,t)=>e.y-t.height+e.height,ou=e=>e.y,ru=(e,t,n)=>qc(eu(e),ou(e),n.southeast(),vc(),"southeast",Dc(e,{left:0,top:2}),Zl),su=(e,t,n)=>qc(tu(e,t),ou(e),n.southwest(),fc(),"southwest",Dc(e,{right:1,top:2}),Zl),au=(e,t,n)=>qc(eu(e),nu(e,t),n.northeast(),bc(),"northeast",Dc(e,{left:0,bottom:3}),Zl),iu=(e,t,n)=>qc(tu(e,t),nu(e,t),n.northwest(),yc(),"northwest",Dc(e,{right:1,bottom:3}),Zl),cu=()=>[ru,su,au,iu],lu=()=>[su,ru,iu,au];var uu=[en("item"),_l(),ln("overrides",{}),Ga("placement",((e,t,n)=>{const o=kc(n,t.item.element),r=xl(e.element,t,cu(),lu(),cu(),lu(),E.none());return E.some(pl({anchorBox:o,bubble:$c(),overrides:t.overrides,layouts:r,placer:E.none()}))}))],du=Jt("type",{selection:Xl,node:Bl,hotspot:wl,submenu:uu,makeshift:Ol});const mu=[((e,t)=>Xt(e,e,{tag:"required",process:{}},Pt(t)))("classes",Lt),un("mode","all",(bu=["all","layout","placement"],$t((e=>W(bu,e)?rt.value(e):rt.error(`Unsupported value: "${e}", choose one of "${bu.join(", ")}".`)))))],gu=[ln("useFixed",w),rn("getBounds")],pu=[tn("anchor",du),an("transition",mu)],hu=(e,t,n,o,r,s,a)=>((e,t,n,o,r,s,a,i)=>{const c=Uc(a,"maxHeightFunction",Lc()),l=Uc(a,"maxWidthFunction",p),u=e.anchorBox,d=e.origin,m={bounds:Tc(d,s),origin:d,preference:o,maxHeightFunction:c,maxWidthFunction:l,lastPlacement:r,transition:i};return jc(u,t,n,m)})(((e,t)=>((e,t)=>({anchorBox:e,origin:t}))(e,t))(n.anchorBox,t),r.element,n.bubble,n.layouts,s,o,n.overrides,a),vu=(e,t,n,o,r,s)=>{const a=s.map(dc);return fu(e,t,n,o,r,a)},fu=(e,t,n,o,r,s)=>{const a=Yt("placement.info",Ht(pu),r),i=a.anchor,c=o.element,l=n.get(o.uid);gc((()=>{la(c,"position","fixed");const r=pa(c,"visibility");la(c,"visibility","hidden");const u=t.useFixed()?(()=>{const e=document.documentElement;return Rc(0,0,e.clientWidth,e.clientHeight)})():(e=>{const t=Qi(e.element),n=e.element.dom.getBoundingClientRect();return Mc(t.left,t.top,n.width,n.height)})(e),d=i.placement,m=s.map(v).or(t.getBounds);d(e,i,u).each((t=>{const r=t.placer.getOr(hu)(e,u,t,m,o,l,a.transition);n.set(o.uid,r)})),r.fold((()=>{ha(c,"visibility")}),(e=>{la(c,"visibility",e)})),pa(c,"left").isNone()&&pa(c,"top").isNone()&&pa(c,"right").isNone()&&pa(c,"bottom").isNone()&&gr(pa(c,"position"),"fixed")&&ha(c,"position")}),c)};var bu,yu=Object.freeze({__proto__:null,position:(e,t,n,o,r)=>{vu(e,t,n,o,r,E.none())},positionWithin:vu,positionWithinBounds:fu,getMode:(e,t,n)=>t.useFixed()?"fixed":"absolute",reset:(e,t,n,o)=>{const r=o.element;j(["position","left","right","top","bottom"],(e=>ha(r,e))),(e=>{jr(e,Nc)})(r),n.clear(o.uid)}});const _u=Sr({fields:gu,name:"positioning",active:qi,apis:yu,state:Object.freeze({__proto__:null,init:()=>{let e={};return Mn({readState:()=>e,clear:t=>{d(t)?delete e[t]:e={}},set:(t,n)=>{e[t]=n},get:t=>$e(e,t)})}})}),xu=(e,t)=>{gc((()=>{((e,t,n)=>{const o=e.components();(e=>{j(e.components(),(e=>Br(e.element))),Fr(e.element),e.syncComponents()})(e);const r=n(t),s=Z(o,r);j(s,(t=>{Bi(t),e.getSystem().removeFromWorld(t)})),j(r,(t=>{Fi(t)?Ii(e,t):(e.getSystem().addToWorld(t),Ii(e,t),lt(e.element)&&Di(t))})),e.syncComponents()})(e,t,(()=>U(t,e.getSystem().build)))}),e.element)},wu=(e,t)=>{gc((()=>{((n,o,r)=>{const s=n.components(),a=Q(o,(e=>Ls(e).toArray()));j(s,(e=>{W(a,e)||Pi(e)}));const i=((e,t,n)=>_a(e,t,((t,o)=>xa(e,o,t,n))))(e.element,t,e.getSystem().buildOrPatch),c=Z(s,i);j(c,(e=>{Fi(e)&&Pi(e)})),j(i,(e=>{Fi(e)||Hi(n,e)})),n.syncComponents()})(e,t)}),e.element)},Ou=(e,t,n,o)=>{Pi(t);const r=xa(e.element,n,o,e.getSystem().buildOrPatch);Hi(e,r),e.syncComponents()},Su=(e,t,n)=>{const o=e.getSystem().build(n);Wi(e,o,t)},Cu=(e,t,n,o)=>{Ui(t),Su(e,((e,t)=>((e,t,n)=>{xe(e,n).fold((()=>{Be(e,t)}),(e=>{Ne(e,t)}))})(e,t,n)),o)},Eu=(e,t)=>e.components(),ku=(e,t,n,o,r)=>{const s=Eu(e);return E.from(s[o]).map((n=>(r.fold((()=>Ui(n)),(r=>{(t.reuseDom?Ou:Cu)(e,n,o,r)})),n)))};var Tu=Object.freeze({__proto__:null,append:(e,t,n,o)=>{Su(e,Be,o)},prepend:(e,t,n,o)=>{Su(e,Fe,o)},remove:(e,t,n,o)=>{const r=Eu(e),s=G(r,(e=>ie(o.element,e.element)));s.each(Ui)},replaceAt:ku,replaceBy:(e,t,n,o,r)=>{const s=Eu(e);return K(s,o).bind((n=>ku(e,t,0,n,r)))},set:(e,t,n,o)=>(t.reuseDom?wu:xu)(e,o),contents:Eu});const Au=Sr({fields:[un("reuseDom",!0,Ut)],name:"replacing",apis:Tu}),Mu=e=>!(e=>e.offsetWidth<=0&&e.offsetHeight<=0)(e.dom);var Ru,Nu={exports:{}};(Ru=Nu).exports&&(Ru.exports=function(){var e=3,t=4,n=12,o=13,r=16,s=17;function a(e,t){void 0===t&&(t=0);var n=e.charCodeAt(t);if(55296<=n&&n<=56319&&t<e.length-1){var o=n;return 56320<=(r=e.charCodeAt(t+1))&&r<=57343?1024*(o-55296)+(r-56320)+65536:o}if(56320<=n&&n<=57343&&t>=1){var r=n;return 55296<=(o=e.charCodeAt(t-1))&&o<=56319?1024*(o-55296)+(r-56320)+65536:r}return n}function i(a,i,c){var l=[a].concat(i).concat([c]),u=l[l.length-2],d=c,m=l.lastIndexOf(14);if(m>1&&l.slice(1,m).every((function(t){return t==e}))&&-1==[e,o,s].indexOf(a))return 2;var g=l.lastIndexOf(t);if(g>0&&l.slice(1,g).every((function(e){return e==t}))&&-1==[n,t].indexOf(u))return l.filter((function(e){return e==t})).length%2==1?3:4;if(0==u&&1==d)return 0;if(2==u||0==u||1==u)return 14==d&&i.every((function(t){return t==e}))?2:1;if(2==d||0==d||1==d)return 1;if(6==u&&(6==d||7==d||9==d||10==d))return 0;if(!(9!=u&&7!=u||7!=d&&8!=d))return 0;if((10==u||8==u)&&8==d)return 0;if(d==e||15==d)return 0;if(5==d)return 0;if(u==n)return 0;var p=-1!=l.indexOf(e)?l.lastIndexOf(e)-1:l.length-2;return-1!=[o,s].indexOf(l[p])&&l.slice(p+1,-1).every((function(t){return t==e}))&&14==d||15==u&&-1!=[r,s].indexOf(d)?0:-1!=i.indexOf(t)?2:u==t&&d==t?0:1}function c(a){return 1536<=a&&a<=1541||1757==a||1807==a||2274==a||3406==a||69821==a||70082<=a&&a<=70083||72250==a||72326<=a&&a<=72329||73030==a?n:13==a?0:10==a?1:0<=a&&a<=9||11<=a&&a<=12||14<=a&&a<=31||127<=a&&a<=159||173==a||1564==a||6158==a||8203==a||8206<=a&&a<=8207||8232==a||8233==a||8234<=a&&a<=8238||8288<=a&&a<=8292||8293==a||8294<=a&&a<=8303||55296<=a&&a<=57343||65279==a||65520<=a&&a<=65528||65529<=a&&a<=65531||113824<=a&&a<=113827||119155<=a&&a<=119162||917504==a||917505==a||917506<=a&&a<=917535||917632<=a&&a<=917759||918e3<=a&&a<=921599?2:768<=a&&a<=879||1155<=a&&a<=1159||1160<=a&&a<=1161||1425<=a&&a<=1469||1471==a||1473<=a&&a<=1474||1476<=a&&a<=1477||1479==a||1552<=a&&a<=1562||1611<=a&&a<=1631||1648==a||1750<=a&&a<=1756||1759<=a&&a<=1764||1767<=a&&a<=1768||1770<=a&&a<=1773||1809==a||1840<=a&&a<=1866||1958<=a&&a<=1968||2027<=a&&a<=2035||2070<=a&&a<=2073||2075<=a&&a<=2083||2085<=a&&a<=2087||2089<=a&&a<=2093||2137<=a&&a<=2139||2260<=a&&a<=2273||2275<=a&&a<=2306||2362==a||2364==a||2369<=a&&a<=2376||2381==a||2385<=a&&a<=2391||2402<=a&&a<=2403||2433==a||2492==a||2494==a||2497<=a&&a<=2500||2509==a||2519==a||2530<=a&&a<=2531||2561<=a&&a<=2562||2620==a||2625<=a&&a<=2626||2631<=a&&a<=2632||2635<=a&&a<=2637||2641==a||2672<=a&&a<=2673||2677==a||2689<=a&&a<=2690||2748==a||2753<=a&&a<=2757||2759<=a&&a<=2760||2765==a||2786<=a&&a<=2787||2810<=a&&a<=2815||2817==a||2876==a||2878==a||2879==a||2881<=a&&a<=2884||2893==a||2902==a||2903==a||2914<=a&&a<=2915||2946==a||3006==a||3008==a||3021==a||3031==a||3072==a||3134<=a&&a<=3136||3142<=a&&a<=3144||3146<=a&&a<=3149||3157<=a&&a<=3158||3170<=a&&a<=3171||3201==a||3260==a||3263==a||3266==a||3270==a||3276<=a&&a<=3277||3285<=a&&a<=3286||3298<=a&&a<=3299||3328<=a&&a<=3329||3387<=a&&a<=3388||3390==a||3393<=a&&a<=3396||3405==a||3415==a||3426<=a&&a<=3427||3530==a||3535==a||3538<=a&&a<=3540||3542==a||3551==a||3633==a||3636<=a&&a<=3642||3655<=a&&a<=3662||3761==a||3764<=a&&a<=3769||3771<=a&&a<=3772||3784<=a&&a<=3789||3864<=a&&a<=3865||3893==a||3895==a||3897==a||3953<=a&&a<=3966||3968<=a&&a<=3972||3974<=a&&a<=3975||3981<=a&&a<=3991||3993<=a&&a<=4028||4038==a||4141<=a&&a<=4144||4146<=a&&a<=4151||4153<=a&&a<=4154||4157<=a&&a<=4158||4184<=a&&a<=4185||4190<=a&&a<=4192||4209<=a&&a<=4212||4226==a||4229<=a&&a<=4230||4237==a||4253==a||4957<=a&&a<=4959||5906<=a&&a<=5908||5938<=a&&a<=5940||5970<=a&&a<=5971||6002<=a&&a<=6003||6068<=a&&a<=6069||6071<=a&&a<=6077||6086==a||6089<=a&&a<=6099||6109==a||6155<=a&&a<=6157||6277<=a&&a<=6278||6313==a||6432<=a&&a<=6434||6439<=a&&a<=6440||6450==a||6457<=a&&a<=6459||6679<=a&&a<=6680||6683==a||6742==a||6744<=a&&a<=6750||6752==a||6754==a||6757<=a&&a<=6764||6771<=a&&a<=6780||6783==a||6832<=a&&a<=6845||6846==a||6912<=a&&a<=6915||6964==a||6966<=a&&a<=6970||6972==a||6978==a||7019<=a&&a<=7027||7040<=a&&a<=7041||7074<=a&&a<=7077||7080<=a&&a<=7081||7083<=a&&a<=7085||7142==a||7144<=a&&a<=7145||7149==a||7151<=a&&a<=7153||7212<=a&&a<=7219||7222<=a&&a<=7223||7376<=a&&a<=7378||7380<=a&&a<=7392||7394<=a&&a<=7400||7405==a||7412==a||7416<=a&&a<=7417||7616<=a&&a<=7673||7675<=a&&a<=7679||8204==a||8400<=a&&a<=8412||8413<=a&&a<=8416||8417==a||8418<=a&&a<=8420||8421<=a&&a<=8432||11503<=a&&a<=11505||11647==a||11744<=a&&a<=11775||12330<=a&&a<=12333||12334<=a&&a<=12335||12441<=a&&a<=12442||42607==a||42608<=a&&a<=42610||42612<=a&&a<=42621||42654<=a&&a<=42655||42736<=a&&a<=42737||43010==a||43014==a||43019==a||43045<=a&&a<=43046||43204<=a&&a<=43205||43232<=a&&a<=43249||43302<=a&&a<=43309||43335<=a&&a<=43345||43392<=a&&a<=43394||43443==a||43446<=a&&a<=43449||43452==a||43493==a||43561<=a&&a<=43566||43569<=a&&a<=43570||43573<=a&&a<=43574||43587==a||43596==a||43644==a||43696==a||43698<=a&&a<=43700||43703<=a&&a<=43704||43710<=a&&a<=43711||43713==a||43756<=a&&a<=43757||43766==a||44005==a||44008==a||44013==a||64286==a||65024<=a&&a<=65039||65056<=a&&a<=65071||65438<=a&&a<=65439||66045==a||66272==a||66422<=a&&a<=66426||68097<=a&&a<=68099||68101<=a&&a<=68102||68108<=a&&a<=68111||68152<=a&&a<=68154||68159==a||68325<=a&&a<=68326||69633==a||69688<=a&&a<=69702||69759<=a&&a<=69761||69811<=a&&a<=69814||69817<=a&&a<=69818||69888<=a&&a<=69890||69927<=a&&a<=69931||69933<=a&&a<=69940||70003==a||70016<=a&&a<=70017||70070<=a&&a<=70078||70090<=a&&a<=70092||70191<=a&&a<=70193||70196==a||70198<=a&&a<=70199||70206==a||70367==a||70371<=a&&a<=70378||70400<=a&&a<=70401||70460==a||70462==a||70464==a||70487==a||70502<=a&&a<=70508||70512<=a&&a<=70516||70712<=a&&a<=70719||70722<=a&&a<=70724||70726==a||70832==a||70835<=a&&a<=70840||70842==a||70845==a||70847<=a&&a<=70848||70850<=a&&a<=70851||71087==a||71090<=a&&a<=71093||71100<=a&&a<=71101||71103<=a&&a<=71104||71132<=a&&a<=71133||71219<=a&&a<=71226||71229==a||71231<=a&&a<=71232||71339==a||71341==a||71344<=a&&a<=71349||71351==a||71453<=a&&a<=71455||71458<=a&&a<=71461||71463<=a&&a<=71467||72193<=a&&a<=72198||72201<=a&&a<=72202||72243<=a&&a<=72248||72251<=a&&a<=72254||72263==a||72273<=a&&a<=72278||72281<=a&&a<=72283||72330<=a&&a<=72342||72344<=a&&a<=72345||72752<=a&&a<=72758||72760<=a&&a<=72765||72767==a||72850<=a&&a<=72871||72874<=a&&a<=72880||72882<=a&&a<=72883||72885<=a&&a<=72886||73009<=a&&a<=73014||73018==a||73020<=a&&a<=73021||73023<=a&&a<=73029||73031==a||92912<=a&&a<=92916||92976<=a&&a<=92982||94095<=a&&a<=94098||113821<=a&&a<=113822||119141==a||119143<=a&&a<=119145||119150<=a&&a<=119154||119163<=a&&a<=119170||119173<=a&&a<=119179||119210<=a&&a<=119213||119362<=a&&a<=119364||121344<=a&&a<=121398||121403<=a&&a<=121452||121461==a||121476==a||121499<=a&&a<=121503||121505<=a&&a<=121519||122880<=a&&a<=122886||122888<=a&&a<=122904||122907<=a&&a<=122913||122915<=a&&a<=122916||122918<=a&&a<=122922||125136<=a&&a<=125142||125252<=a&&a<=125258||917536<=a&&a<=917631||917760<=a&&a<=917999?e:127462<=a&&a<=127487?t:2307==a||2363==a||2366<=a&&a<=2368||2377<=a&&a<=2380||2382<=a&&a<=2383||2434<=a&&a<=2435||2495<=a&&a<=2496||2503<=a&&a<=2504||2507<=a&&a<=2508||2563==a||2622<=a&&a<=2624||2691==a||2750<=a&&a<=2752||2761==a||2763<=a&&a<=2764||2818<=a&&a<=2819||2880==a||2887<=a&&a<=2888||2891<=a&&a<=2892||3007==a||3009<=a&&a<=3010||3014<=a&&a<=3016||3018<=a&&a<=3020||3073<=a&&a<=3075||3137<=a&&a<=3140||3202<=a&&a<=3203||3262==a||3264<=a&&a<=3265||3267<=a&&a<=3268||3271<=a&&a<=3272||3274<=a&&a<=3275||3330<=a&&a<=3331||3391<=a&&a<=3392||3398<=a&&a<=3400||3402<=a&&a<=3404||3458<=a&&a<=3459||3536<=a&&a<=3537||3544<=a&&a<=3550||3570<=a&&a<=3571||3635==a||3763==a||3902<=a&&a<=3903||3967==a||4145==a||4155<=a&&a<=4156||4182<=a&&a<=4183||4228==a||6070==a||6078<=a&&a<=6085||6087<=a&&a<=6088||6435<=a&&a<=6438||6441<=a&&a<=6443||6448<=a&&a<=6449||6451<=a&&a<=6456||6681<=a&&a<=6682||6741==a||6743==a||6765<=a&&a<=6770||6916==a||6965==a||6971==a||6973<=a&&a<=6977||6979<=a&&a<=6980||7042==a||7073==a||7078<=a&&a<=7079||7082==a||7143==a||7146<=a&&a<=7148||7150==a||7154<=a&&a<=7155||7204<=a&&a<=7211||7220<=a&&a<=7221||7393==a||7410<=a&&a<=7411||7415==a||43043<=a&&a<=43044||43047==a||43136<=a&&a<=43137||43188<=a&&a<=43203||43346<=a&&a<=43347||43395==a||43444<=a&&a<=43445||43450<=a&&a<=43451||43453<=a&&a<=43456||43567<=a&&a<=43568||43571<=a&&a<=43572||43597==a||43755==a||43758<=a&&a<=43759||43765==a||44003<=a&&a<=44004||44006<=a&&a<=44007||44009<=a&&a<=44010||44012==a||69632==a||69634==a||69762==a||69808<=a&&a<=69810||69815<=a&&a<=69816||69932==a||70018==a||70067<=a&&a<=70069||70079<=a&&a<=70080||70188<=a&&a<=70190||70194<=a&&a<=70195||70197==a||70368<=a&&a<=70370||70402<=a&&a<=70403||70463==a||70465<=a&&a<=70468||70471<=a&&a<=70472||70475<=a&&a<=70477||70498<=a&&a<=70499||70709<=a&&a<=70711||70720<=a&&a<=70721||70725==a||70833<=a&&a<=70834||70841==a||70843<=a&&a<=70844||70846==a||70849==a||71088<=a&&a<=71089||71096<=a&&a<=71099||71102==a||71216<=a&&a<=71218||71227<=a&&a<=71228||71230==a||71340==a||71342<=a&&a<=71343||71350==a||71456<=a&&a<=71457||71462==a||72199<=a&&a<=72200||72249==a||72279<=a&&a<=72280||72343==a||72751==a||72766==a||72873==a||72881==a||72884==a||94033<=a&&a<=94078||119142==a||119149==a?5:4352<=a&&a<=4447||43360<=a&&a<=43388?6:4448<=a&&a<=4519||55216<=a&&a<=55238?7:4520<=a&&a<=4607||55243<=a&&a<=55291?8:44032==a||44060==a||44088==a||44116==a||44144==a||44172==a||44200==a||44228==a||44256==a||44284==a||44312==a||44340==a||44368==a||44396==a||44424==a||44452==a||44480==a||44508==a||44536==a||44564==a||44592==a||44620==a||44648==a||44676==a||44704==a||44732==a||44760==a||44788==a||44816==a||44844==a||44872==a||44900==a||44928==a||44956==a||44984==a||45012==a||45040==a||45068==a||45096==a||45124==a||45152==a||45180==a||45208==a||45236==a||45264==a||45292==a||45320==a||45348==a||45376==a||45404==a||45432==a||45460==a||45488==a||45516==a||45544==a||45572==a||45600==a||45628==a||45656==a||45684==a||45712==a||45740==a||45768==a||45796==a||45824==a||45852==a||45880==a||45908==a||45936==a||45964==a||45992==a||46020==a||46048==a||46076==a||46104==a||46132==a||46160==a||46188==a||46216==a||46244==a||46272==a||46300==a||46328==a||46356==a||46384==a||46412==a||46440==a||46468==a||46496==a||46524==a||46552==a||46580==a||46608==a||46636==a||46664==a||46692==a||46720==a||46748==a||46776==a||46804==a||46832==a||46860==a||46888==a||46916==a||46944==a||46972==a||47e3==a||47028==a||47056==a||47084==a||47112==a||47140==a||47168==a||47196==a||47224==a||47252==a||47280==a||47308==a||47336==a||47364==a||47392==a||47420==a||47448==a||47476==a||47504==a||47532==a||47560==a||47588==a||47616==a||47644==a||47672==a||47700==a||47728==a||47756==a||47784==a||47812==a||47840==a||47868==a||47896==a||47924==a||47952==a||47980==a||48008==a||48036==a||48064==a||48092==a||48120==a||48148==a||48176==a||48204==a||48232==a||48260==a||48288==a||48316==a||48344==a||48372==a||48400==a||48428==a||48456==a||48484==a||48512==a||48540==a||48568==a||48596==a||48624==a||48652==a||48680==a||48708==a||48736==a||48764==a||48792==a||48820==a||48848==a||48876==a||48904==a||48932==a||48960==a||48988==a||49016==a||49044==a||49072==a||49100==a||49128==a||49156==a||49184==a||49212==a||49240==a||49268==a||49296==a||49324==a||49352==a||49380==a||49408==a||49436==a||49464==a||49492==a||49520==a||49548==a||49576==a||49604==a||49632==a||49660==a||49688==a||49716==a||49744==a||49772==a||49800==a||49828==a||49856==a||49884==a||49912==a||49940==a||49968==a||49996==a||50024==a||50052==a||50080==a||50108==a||50136==a||50164==a||50192==a||50220==a||50248==a||50276==a||50304==a||50332==a||50360==a||50388==a||50416==a||50444==a||50472==a||50500==a||50528==a||50556==a||50584==a||50612==a||50640==a||50668==a||50696==a||50724==a||50752==a||50780==a||50808==a||50836==a||50864==a||50892==a||50920==a||50948==a||50976==a||51004==a||51032==a||51060==a||51088==a||51116==a||51144==a||51172==a||51200==a||51228==a||51256==a||51284==a||51312==a||51340==a||51368==a||51396==a||51424==a||51452==a||51480==a||51508==a||51536==a||51564==a||51592==a||51620==a||51648==a||51676==a||51704==a||51732==a||51760==a||51788==a||51816==a||51844==a||51872==a||51900==a||51928==a||51956==a||51984==a||52012==a||52040==a||52068==a||52096==a||52124==a||52152==a||52180==a||52208==a||52236==a||52264==a||52292==a||52320==a||52348==a||52376==a||52404==a||52432==a||52460==a||52488==a||52516==a||52544==a||52572==a||52600==a||52628==a||52656==a||52684==a||52712==a||52740==a||52768==a||52796==a||52824==a||52852==a||52880==a||52908==a||52936==a||52964==a||52992==a||53020==a||53048==a||53076==a||53104==a||53132==a||53160==a||53188==a||53216==a||53244==a||53272==a||53300==a||53328==a||53356==a||53384==a||53412==a||53440==a||53468==a||53496==a||53524==a||53552==a||53580==a||53608==a||53636==a||53664==a||53692==a||53720==a||53748==a||53776==a||53804==a||53832==a||53860==a||53888==a||53916==a||53944==a||53972==a||54e3==a||54028==a||54056==a||54084==a||54112==a||54140==a||54168==a||54196==a||54224==a||54252==a||54280==a||54308==a||54336==a||54364==a||54392==a||54420==a||54448==a||54476==a||54504==a||54532==a||54560==a||54588==a||54616==a||54644==a||54672==a||54700==a||54728==a||54756==a||54784==a||54812==a||54840==a||54868==a||54896==a||54924==a||54952==a||54980==a||55008==a||55036==a||55064==a||55092==a||55120==a||55148==a||55176==a?9:44033<=a&&a<=44059||44061<=a&&a<=44087||44089<=a&&a<=44115||44117<=a&&a<=44143||44145<=a&&a<=44171||44173<=a&&a<=44199||44201<=a&&a<=44227||44229<=a&&a<=44255||44257<=a&&a<=44283||44285<=a&&a<=44311||44313<=a&&a<=44339||44341<=a&&a<=44367||44369<=a&&a<=44395||44397<=a&&a<=44423||44425<=a&&a<=44451||44453<=a&&a<=44479||44481<=a&&a<=44507||44509<=a&&a<=44535||44537<=a&&a<=44563||44565<=a&&a<=44591||44593<=a&&a<=44619||44621<=a&&a<=44647||44649<=a&&a<=44675||44677<=a&&a<=44703||44705<=a&&a<=44731||44733<=a&&a<=44759||44761<=a&&a<=44787||44789<=a&&a<=44815||44817<=a&&a<=44843||44845<=a&&a<=44871||44873<=a&&a<=44899||44901<=a&&a<=44927||44929<=a&&a<=44955||44957<=a&&a<=44983||44985<=a&&a<=45011||45013<=a&&a<=45039||45041<=a&&a<=45067||45069<=a&&a<=45095||45097<=a&&a<=45123||45125<=a&&a<=45151||45153<=a&&a<=45179||45181<=a&&a<=45207||45209<=a&&a<=45235||45237<=a&&a<=45263||45265<=a&&a<=45291||45293<=a&&a<=45319||45321<=a&&a<=45347||45349<=a&&a<=45375||45377<=a&&a<=45403||45405<=a&&a<=45431||45433<=a&&a<=45459||45461<=a&&a<=45487||45489<=a&&a<=45515||45517<=a&&a<=45543||45545<=a&&a<=45571||45573<=a&&a<=45599||45601<=a&&a<=45627||45629<=a&&a<=45655||45657<=a&&a<=45683||45685<=a&&a<=45711||45713<=a&&a<=45739||45741<=a&&a<=45767||45769<=a&&a<=45795||45797<=a&&a<=45823||45825<=a&&a<=45851||45853<=a&&a<=45879||45881<=a&&a<=45907||45909<=a&&a<=45935||45937<=a&&a<=45963||45965<=a&&a<=45991||45993<=a&&a<=46019||46021<=a&&a<=46047||46049<=a&&a<=46075||46077<=a&&a<=46103||46105<=a&&a<=46131||46133<=a&&a<=46159||46161<=a&&a<=46187||46189<=a&&a<=46215||46217<=a&&a<=46243||46245<=a&&a<=46271||46273<=a&&a<=46299||46301<=a&&a<=46327||46329<=a&&a<=46355||46357<=a&&a<=46383||46385<=a&&a<=46411||46413<=a&&a<=46439||46441<=a&&a<=46467||46469<=a&&a<=46495||46497<=a&&a<=46523||46525<=a&&a<=46551||46553<=a&&a<=46579||46581<=a&&a<=46607||46609<=a&&a<=46635||46637<=a&&a<=46663||46665<=a&&a<=46691||46693<=a&&a<=46719||46721<=a&&a<=46747||46749<=a&&a<=46775||46777<=a&&a<=46803||46805<=a&&a<=46831||46833<=a&&a<=46859||46861<=a&&a<=46887||46889<=a&&a<=46915||46917<=a&&a<=46943||46945<=a&&a<=46971||46973<=a&&a<=46999||47001<=a&&a<=47027||47029<=a&&a<=47055||47057<=a&&a<=47083||47085<=a&&a<=47111||47113<=a&&a<=47139||47141<=a&&a<=47167||47169<=a&&a<=47195||47197<=a&&a<=47223||47225<=a&&a<=47251||47253<=a&&a<=47279||47281<=a&&a<=47307||47309<=a&&a<=47335||47337<=a&&a<=47363||47365<=a&&a<=47391||47393<=a&&a<=47419||47421<=a&&a<=47447||47449<=a&&a<=47475||47477<=a&&a<=47503||47505<=a&&a<=47531||47533<=a&&a<=47559||47561<=a&&a<=47587||47589<=a&&a<=47615||47617<=a&&a<=47643||47645<=a&&a<=47671||47673<=a&&a<=47699||47701<=a&&a<=47727||47729<=a&&a<=47755||47757<=a&&a<=47783||47785<=a&&a<=47811||47813<=a&&a<=47839||47841<=a&&a<=47867||47869<=a&&a<=47895||47897<=a&&a<=47923||47925<=a&&a<=47951||47953<=a&&a<=47979||47981<=a&&a<=48007||48009<=a&&a<=48035||48037<=a&&a<=48063||48065<=a&&a<=48091||48093<=a&&a<=48119||48121<=a&&a<=48147||48149<=a&&a<=48175||48177<=a&&a<=48203||48205<=a&&a<=48231||48233<=a&&a<=48259||48261<=a&&a<=48287||48289<=a&&a<=48315||48317<=a&&a<=48343||48345<=a&&a<=48371||48373<=a&&a<=48399||48401<=a&&a<=48427||48429<=a&&a<=48455||48457<=a&&a<=48483||48485<=a&&a<=48511||48513<=a&&a<=48539||48541<=a&&a<=48567||48569<=a&&a<=48595||48597<=a&&a<=48623||48625<=a&&a<=48651||48653<=a&&a<=48679||48681<=a&&a<=48707||48709<=a&&a<=48735||48737<=a&&a<=48763||48765<=a&&a<=48791||48793<=a&&a<=48819||48821<=a&&a<=48847||48849<=a&&a<=48875||48877<=a&&a<=48903||48905<=a&&a<=48931||48933<=a&&a<=48959||48961<=a&&a<=48987||48989<=a&&a<=49015||49017<=a&&a<=49043||49045<=a&&a<=49071||49073<=a&&a<=49099||49101<=a&&a<=49127||49129<=a&&a<=49155||49157<=a&&a<=49183||49185<=a&&a<=49211||49213<=a&&a<=49239||49241<=a&&a<=49267||49269<=a&&a<=49295||49297<=a&&a<=49323||49325<=a&&a<=49351||49353<=a&&a<=49379||49381<=a&&a<=49407||49409<=a&&a<=49435||49437<=a&&a<=49463||49465<=a&&a<=49491||49493<=a&&a<=49519||49521<=a&&a<=49547||49549<=a&&a<=49575||49577<=a&&a<=49603||49605<=a&&a<=49631||49633<=a&&a<=49659||49661<=a&&a<=49687||49689<=a&&a<=49715||49717<=a&&a<=49743||49745<=a&&a<=49771||49773<=a&&a<=49799||49801<=a&&a<=49827||49829<=a&&a<=49855||49857<=a&&a<=49883||49885<=a&&a<=49911||49913<=a&&a<=49939||49941<=a&&a<=49967||49969<=a&&a<=49995||49997<=a&&a<=50023||50025<=a&&a<=50051||50053<=a&&a<=50079||50081<=a&&a<=50107||50109<=a&&a<=50135||50137<=a&&a<=50163||50165<=a&&a<=50191||50193<=a&&a<=50219||50221<=a&&a<=50247||50249<=a&&a<=50275||50277<=a&&a<=50303||50305<=a&&a<=50331||50333<=a&&a<=50359||50361<=a&&a<=50387||50389<=a&&a<=50415||50417<=a&&a<=50443||50445<=a&&a<=50471||50473<=a&&a<=50499||50501<=a&&a<=50527||50529<=a&&a<=50555||50557<=a&&a<=50583||50585<=a&&a<=50611||50613<=a&&a<=50639||50641<=a&&a<=50667||50669<=a&&a<=50695||50697<=a&&a<=50723||50725<=a&&a<=50751||50753<=a&&a<=50779||50781<=a&&a<=50807||50809<=a&&a<=50835||50837<=a&&a<=50863||50865<=a&&a<=50891||50893<=a&&a<=50919||50921<=a&&a<=50947||50949<=a&&a<=50975||50977<=a&&a<=51003||51005<=a&&a<=51031||51033<=a&&a<=51059||51061<=a&&a<=51087||51089<=a&&a<=51115||51117<=a&&a<=51143||51145<=a&&a<=51171||51173<=a&&a<=51199||51201<=a&&a<=51227||51229<=a&&a<=51255||51257<=a&&a<=51283||51285<=a&&a<=51311||51313<=a&&a<=51339||51341<=a&&a<=51367||51369<=a&&a<=51395||51397<=a&&a<=51423||51425<=a&&a<=51451||51453<=a&&a<=51479||51481<=a&&a<=51507||51509<=a&&a<=51535||51537<=a&&a<=51563||51565<=a&&a<=51591||51593<=a&&a<=51619||51621<=a&&a<=51647||51649<=a&&a<=51675||51677<=a&&a<=51703||51705<=a&&a<=51731||51733<=a&&a<=51759||51761<=a&&a<=51787||51789<=a&&a<=51815||51817<=a&&a<=51843||51845<=a&&a<=51871||51873<=a&&a<=51899||51901<=a&&a<=51927||51929<=a&&a<=51955||51957<=a&&a<=51983||51985<=a&&a<=52011||52013<=a&&a<=52039||52041<=a&&a<=52067||52069<=a&&a<=52095||52097<=a&&a<=52123||52125<=a&&a<=52151||52153<=a&&a<=52179||52181<=a&&a<=52207||52209<=a&&a<=52235||52237<=a&&a<=52263||52265<=a&&a<=52291||52293<=a&&a<=52319||52321<=a&&a<=52347||52349<=a&&a<=52375||52377<=a&&a<=52403||52405<=a&&a<=52431||52433<=a&&a<=52459||52461<=a&&a<=52487||52489<=a&&a<=52515||52517<=a&&a<=52543||52545<=a&&a<=52571||52573<=a&&a<=52599||52601<=a&&a<=52627||52629<=a&&a<=52655||52657<=a&&a<=52683||52685<=a&&a<=52711||52713<=a&&a<=52739||52741<=a&&a<=52767||52769<=a&&a<=52795||52797<=a&&a<=52823||52825<=a&&a<=52851||52853<=a&&a<=52879||52881<=a&&a<=52907||52909<=a&&a<=52935||52937<=a&&a<=52963||52965<=a&&a<=52991||52993<=a&&a<=53019||53021<=a&&a<=53047||53049<=a&&a<=53075||53077<=a&&a<=53103||53105<=a&&a<=53131||53133<=a&&a<=53159||53161<=a&&a<=53187||53189<=a&&a<=53215||53217<=a&&a<=53243||53245<=a&&a<=53271||53273<=a&&a<=53299||53301<=a&&a<=53327||53329<=a&&a<=53355||53357<=a&&a<=53383||53385<=a&&a<=53411||53413<=a&&a<=53439||53441<=a&&a<=53467||53469<=a&&a<=53495||53497<=a&&a<=53523||53525<=a&&a<=53551||53553<=a&&a<=53579||53581<=a&&a<=53607||53609<=a&&a<=53635||53637<=a&&a<=53663||53665<=a&&a<=53691||53693<=a&&a<=53719||53721<=a&&a<=53747||53749<=a&&a<=53775||53777<=a&&a<=53803||53805<=a&&a<=53831||53833<=a&&a<=53859||53861<=a&&a<=53887||53889<=a&&a<=53915||53917<=a&&a<=53943||53945<=a&&a<=53971||53973<=a&&a<=53999||54001<=a&&a<=54027||54029<=a&&a<=54055||54057<=a&&a<=54083||54085<=a&&a<=54111||54113<=a&&a<=54139||54141<=a&&a<=54167||54169<=a&&a<=54195||54197<=a&&a<=54223||54225<=a&&a<=54251||54253<=a&&a<=54279||54281<=a&&a<=54307||54309<=a&&a<=54335||54337<=a&&a<=54363||54365<=a&&a<=54391||54393<=a&&a<=54419||54421<=a&&a<=54447||54449<=a&&a<=54475||54477<=a&&a<=54503||54505<=a&&a<=54531||54533<=a&&a<=54559||54561<=a&&a<=54587||54589<=a&&a<=54615||54617<=a&&a<=54643||54645<=a&&a<=54671||54673<=a&&a<=54699||54701<=a&&a<=54727||54729<=a&&a<=54755||54757<=a&&a<=54783||54785<=a&&a<=54811||54813<=a&&a<=54839||54841<=a&&a<=54867||54869<=a&&a<=54895||54897<=a&&a<=54923||54925<=a&&a<=54951||54953<=a&&a<=54979||54981<=a&&a<=55007||55009<=a&&a<=55035||55037<=a&&a<=55063||55065<=a&&a<=55091||55093<=a&&a<=55119||55121<=a&&a<=55147||55149<=a&&a<=55175||55177<=a&&a<=55203?10:9757==a||9977==a||9994<=a&&a<=9997||127877==a||127938<=a&&a<=127940||127943==a||127946<=a&&a<=127948||128066<=a&&a<=128067||128070<=a&&a<=128080||128110==a||128112<=a&&a<=128120||128124==a||128129<=a&&a<=128131||128133<=a&&a<=128135||128170==a||128372<=a&&a<=128373||128378==a||128400==a||128405<=a&&a<=128406||128581<=a&&a<=128583||128587<=a&&a<=128591||128675==a||128692<=a&&a<=128694||128704==a||128716==a||129304<=a&&a<=129308||129310<=a&&a<=129311||129318==a||129328<=a&&a<=129337||129341<=a&&a<=129342||129489<=a&&a<=129501?o:127995<=a&&a<=127999?14:8205==a?15:9792==a||9794==a||9877<=a&&a<=9878||9992==a||10084==a||127752==a||127806==a||127859==a||127891==a||127908==a||127912==a||127979==a||127981==a||128139==a||128187<=a&&a<=128188||128295==a||128300==a||128488==a||128640==a||128658==a?r:128102<=a&&a<=128105?s:11}return this.nextBreak=function(e,t){if(void 0===t&&(t=0),t<0)return 0;if(t>=e.length-1)return e.length;for(var n,o,r=c(a(e,t)),s=[],l=t+1;l<e.length;l++)if(o=l-1,!(55296<=(n=e).charCodeAt(o)&&n.charCodeAt(o)<=56319&&56320<=n.charCodeAt(o+1)&&n.charCodeAt(o+1)<=57343)){var u=c(a(e,l));if(i(r,s,u))return l;s.push(u)}return e.length},this.splitGraphemes=function(e){for(var t,n=[],o=0;(t=this.nextBreak(e,o))<e.length;)n.push(e.slice(o,t)),o=t;return o<e.length&&n.push(e.slice(o)),n},this.iterateGraphemes=function(e){var t=0,n={next:function(){var n,o;return(o=this.nextBreak(e,t))<e.length?(n=e.slice(t,o),t=o,{value:n,done:!1}):t<e.length?(n=e.slice(t),t=e.length,{value:n,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return n}),n},this.countGraphemes=function(e){for(var t,n=0,o=0;(t=this.nextBreak(e,o))<e.length;)o=t,n++;return o<e.length&&n++,n},this});var Fu=Nu.exports;const Bu=bo().os.isMacOS()?"\u2318":"Ctrl",Du=Ie({tc_menu_name:"TinyComments",tc_conversations_title:"Comments",tc_announce_sidebar_available:`Comment. Sidebar available. Press ${Bu} + Alt + M to switch to sidebar`,tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_comment:"Comment",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Add comment...",tc_kebab_delete_conversation:"Delete conversation",tc_kebab_resolve_conversation:"Resolve conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_resolve_buttons_proceed:"Resolve",tc_create_problem:"An error occurred while creating a comment. See the console for details",tc_reply_problem:"An error occurred while replying to a comment. See the console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone.",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_resolve_prompts_conversation:"Resolve this conversation?",tc_resolve_prompts_conversation_detail_sing:"1 comment will be resolved. You can't undo this action.",tc_resolve_prompts_conversation_detail_pl:"{0} comments will be resolved. You can't undo this action.",tc_delete_problem_all:"An error occurred deleting all the conversations. See the console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_resolve_unauthorised_conversation:"You are not allowed to resolve this conversation",tc_resolve_problem_conversation:"An error occurred resolving the conversation. See the console for details.",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},f),Hu="tox-button--kebab",Pu="tox-comment",Iu="tox-comment__body",Vu="tox-textarea",Wu="tox-comment__reply",Lu="tox-comment__overlay",Uu="tox-comment__overlaytext",ju="tox-comment__buttonspacing",zu="tox-button",$u="tox-comment__edit",qu="tox-comment__scroll",Gu="tox-collection__item",Ku="tox-conversations",Yu=`tox-comment__expander p:contains(${Du.tc_comment_buttons_showmore})`,Qu=`tox-comment__expander p:contains(${Du.tc_comment_buttons_showless})`,Ju=e=>`.${e}`,Xu=e=>t=>[`${Ju(Pu)}:contains(${t})`,Ju(e)].join(" "),Zu={kebab:Ju(Hu),cardBody:`${Ju(Pu)} ${Ju(Iu)}`,card:Ju(Pu),showMore:Ju(Yu),showLess:Ju(Qu),editItem:[".tox-menu",`[role="menuitem"]:contains(${Du.tc_kebab_edit})`].join(" "),deleteItem:[".tox-menu",`[role="menuitem"]:contains(${Du.tc_kebab_delete})`].join(" "),deleteConversationItem:[".tox-menu",`[role="menuitem"]:contains(${Du.tc_kebab_delete_conversation})`].join(" "),resolveConversationItem:[".tox-menu",`[role="menuitem"]:contains(${Du.tc_kebab_resolve_conversation})`].join(" "),outerScroll:Ju(qu),outerContainer:Ju(Ku),cardFor:e=>`${Ju(Pu)}:contains("${e}")`,cardN:e=>`${Ju(Pu)}:nth-child(${e+1})`,kebabFor:Xu(Hu),showMoreFor:Xu(Yu),showLessFor:Xu(Qu),editSaveButton:`.tox-button:contains(${Du.tc_edit_buttons_save})`,replyCommentButton:`.tox-button:contains(${Du.tc_reply_buttons_comment})`,cancelButton:`.tox-button:contains(${Du.tc_edit_buttons_cancel})`,clearButton:`.tox-button:contains(${Du.tc_reply_buttons_clear})`,deleteButton:`.tox-button:contains(${Du.tc_delete_buttons_proceed})`,resolveButton:`.tox-button:contains(${Du.tc_resolve_buttons_proceed})`,commentText:[Ju(Ku),Ju(qu),Ju(Pu),"textarea"].join(" "),editActions:Ju($u),cardOverlay:Ju(Lu),cardOverlayText:Ju(Uu),cardOverlayButtons:Ju(ju),replyTextarea:`.${Wu} textarea`,editTextarea:[Ju(Pu),"textarea"].join(" "),kebabMenu:Ju("tox-menu"),textarea:Ju(Vu)},ed={kebabOpen:`${Hu}--open`,bodyExpanded:"tox-comment__body--expanded",bodyNotAnimating:"tox-comment__body--pending",disappearing:"tox-comment--disappearing",commentThreadOverlay:"tox-comment-thread__overlay",bodyHasGradient:"tox-comment__gradient",editingTextarea:Vu},td={conversationsTitle:["tox-conversations__title"],conversationsHead:["tox-conversations__header"],showMoreLessContainer:["tox-comment__expander"],outerContainer:[Ku],date:["tox-comment__date"],replySection:[Wu],replyTextarea:[Vu],textarea:[],editTextarea:[],kebab:["tox-button--naked",Hu,zu,"tox-button--icon"],kebabIcon:["tox-icon"],card:[Pu],cardHead:["tox-comment__header"],cardHeadMeta:["tox-comment__meta"],cardBody:[Iu],cardOverlay:[Lu],cardOverlayText:[Uu],cardOverlayButtons:[ju],button:[zu],secondaryButton:[zu,"tox-button--secondary"],editActions:[$u],outerScroll:[qu],commentList:["tox-comment-thread"],avatar:["tox-user__avatar"],username:["tox-user__name"],user:["tox-user"],showMoreLess:[],kebabItem:[Gu],kebabItemLabel:["tox-collection__item-label"],kebabDisabledItem:["tox-collection__item--state-disabled"],kebabMenu:["tox-menu","tox-collection","tox-collection--list"],kebabMenuGroup:["tox-collection__group"],roots:[Ku]},nd={kebab:{backgroundMenu:"tox-menu--background",selectedMenu:"tox-menu--active",menu:"tox-menu",item:Gu,selectedItem:"tox-collection__item--active"}},od=["#2DC26B","#F1C40F","#E03E2D","#B96AD9","#3598DB","#169179","#E67E23","#BA372A","#843FA1","#236FA1","#95A5A6","#7E8C8D","#34495E"],rd=(e,t)=>E.from(t.authorAvatar).orThunk((()=>e.lookup(t.author))).getOrThunk((()=>{const n=((e,t,n=36)=>{const o=n/2;return`<svg height="${n}" width="${n}" xmlns="http://www.w3.org/2000/svg"><circle cx="${o}" cy="${o}" r="${o}" fill="${t}"/><text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" fill="#FFF" font-family="sans-serif" font-size="${o}">`+(e=>(new Fu).splitGraphemes(e)[0])(e)+"</text></svg>"})(t.authorName,(()=>{const e=Math.floor(Math.random()*od.length);return od[e]})()),o="data:image/svg+xml,"+encodeURIComponent(n);return e.store(t.author,o),o}));var sd=Object.freeze({__proto__:null,getCurrent:(e,t,n)=>t.find(e)});const ad=[en("find")],id=Sr({fields:ad,name:"composing",apis:sd}),cd=(e,t)=>{t.ignore||(Ar(e.element),t.onFocus(e))};var ld=Object.freeze({__proto__:null,focus:cd,blur:(e,t)=>{t.ignore||(e=>{e.dom.blur()})(e.element)},isFocused:e=>(e=>{const t=Ee(e).dom;return e.dom===t.activeElement})(e.element)}),ud=Object.freeze({__proto__:null,exhibit:(e,t)=>{const n=t.ignore?{}:{attributes:{tabindex:"-1"}};return br(n)},events:e=>nr([rr(Bo(),((t,n)=>{cd(t,e),n.stop()}))].concat(e.stopMousedown?[rr(Oo(),((e,t)=>{t.event.prevent()}))]:[]))}),dd=[ja("onFocus"),ln("stopMousedown",!1),ln("ignore",!1)];const md=Sr({fields:dd,name:"focusing",active:ud,apis:ld}),gd=(e,t,n)=>{t.store.manager.onLoad(e,t,n)},pd=(e,t,n)=>{t.store.manager.onUnload(e,t,n)};var hd=Object.freeze({__proto__:null,onLoad:gd,onUnload:pd,setValue:(e,t,n,o)=>{t.store.manager.setValue(e,t,n,o)},getValue:(e,t,n)=>t.store.manager.getValue(e,t,n),getState:(e,t,n)=>n}),vd=Object.freeze({__proto__:null,events:(e,t)=>{const n=e.resetOnDom?[lr(((n,o)=>{gd(n,e,t)})),ur(((n,o)=>{pd(n,e,t)}))]:[yr(e,t,gd)];return nr(n)}});const fd=()=>{const e=fn(null);return Mn({set:e.set,get:e.get,isNotSet:()=>null===e.get(),clear:()=>{e.set(null)},readState:()=>({mode:"memory",value:e.get()})})},bd=()=>{const e=fn({}),t=fn({});return Mn({readState:()=>({mode:"dataset",dataByValue:e.get(),dataByText:t.get()}),lookup:n=>$e(e.get(),n).orThunk((()=>$e(t.get(),n))),update:n=>{const o=e.get(),r=t.get(),s={},a={};j(n,(e=>{s[e.value]=e,$e(e,"meta").each((t=>{$e(t,"text").each((t=>{a[t]=e}))}))})),e.set({...o,...s}),t.set({...r,...a})},clear:()=>{e.set({}),t.set({})}})};var yd=Object.freeze({__proto__:null,memory:fd,dataset:bd,manual:()=>Mn({readState:p}),init:e=>e.store.manager.state(e)});const _d=(e,t,n,o)=>{const r=t.store;n.update([o]),r.setValue(e,o),t.onSetValue(e,o)};var xd=[rn("initialValue"),en("getFallbackEntry"),en("getDataKey"),en("setValue"),Ga("manager",{setValue:_d,getValue:(e,t,n)=>{const o=t.store,r=o.getDataKey(e);return n.lookup(r).getOrThunk((()=>o.getFallbackEntry(r)))},onLoad:(e,t,n)=>{t.store.initialValue.each((o=>{_d(e,t,n,o)}))},onUnload:(e,t,n)=>{n.clear()},state:bd})],wd=[en("getValue"),ln("setValue",p),rn("initialValue"),Ga("manager",{setValue:(e,t,n,o)=>{t.store.setValue(e,o),t.onSetValue(e,o)},getValue:(e,t,n)=>t.store.getValue(e),onLoad:(e,t,n)=>{t.store.initialValue.each((n=>{t.store.setValue(e,n)}))},onUnload:p,state:An.init})],Od=[rn("initialValue"),Ga("manager",{setValue:(e,t,n,o)=>{n.set(o),t.onSetValue(e,o)},getValue:(e,t,n)=>n.get(),onLoad:(e,t,n)=>{t.store.initialValue.each((e=>{n.isNotSet()&&n.set(e)}))},onUnload:(e,t,n)=>{n.clear()},state:fd})],Sd=[un("store",{mode:"memory"},Jt("mode",{memory:Od,manual:wd,dataset:xd})),ja("onSetValue"),ln("resetOnDom",!1)];const Cd=Sr({fields:Sd,name:"representing",active:vd,apis:hd,extra:{setValueFrom:(e,t)=>{const n=Cd.getValue(t);Cd.setValue(e,n)}},state:yd});var Ed=Object.freeze({__proto__:null,exhibit:(e,t)=>br({attributes:Fn([{key:t.tabAttr,value:"true"}])})}),kd=[ln("tabAttr","data-alloy-tabstop")];const Td=Sr({fields:kd,name:"tabstopping",active:Ed}),Ad=(e,t,n,o)=>$e(t.routes,o.start).bind((e=>$e(e,o.destination))),Md=(e,t,n,o)=>Ad(0,t,0,o).bind((e=>e.transition.map((t=>({transition:t,route:e}))))),Rd=(e,t,n)=>{((e,t,n)=>Nd(e,t).bind((e=>Md(0,t,0,e))))(e,t).each((n=>{const o=n.transition;na(e.element,o.transitionClass),jr(e.element,t.destinationAttr)}))},Nd=(e,t,n)=>{const o=e.element;return Lr(o,t.destinationAttr).map((n=>({start:Wr(e.element,t.stateAttr),destination:n})))},Fd=(e,t,n,o)=>{Rd(e,t),Ur(e.element,t.stateAttr)&&Wr(e.element,t.stateAttr)!==o&&t.onFinish(e,o),Ir(e.element,t.stateAttr,o)};var Bd=Object.freeze({__proto__:null,findRoute:Ad,disableTransition:Rd,getCurrentRoute:Nd,jumpTo:Fd,progressTo:(e,t,n,o)=>{((e,t,n,o)=>{Ur(e.element,t.destinationAttr)&&(Lr(e.element,t.destinationAttr).each((n=>{Ir(e.element,t.stateAttr,n)})),jr(e.element,t.destinationAttr))})(e,t);const r=((e,t,n,o)=>({start:Wr(e.element,t.stateAttr),destination:o}))(e,t,0,o);Md(0,t,0,r).fold((()=>{Fd(e,t,0,o)}),(n=>{Rd(e,t);const r=n.transition;ta(e.element,r.transitionClass),Ir(e.element,t.destinationAttr,o)}))},getState:(e,t,n)=>Lr(e.element,t.stateAttr)}),Dd=Object.freeze({__proto__:null,events:(e,t)=>nr([rr(Mo(),((t,n)=>{const o=n.event.raw;Nd(t,e).each((n=>{Ad(0,e,0,n).each((r=>{r.transition.each((r=>{o.propertyName===r.property&&(Fd(t,e,0,n.destination),e.onTransition(t,n))}))}))}))})),lr(((t,n)=>{Fd(t,e,0,e.initialState)}))])}),Hd=[ln("destinationAttr","data-transitioning-destination"),ln("stateAttr","data-transitioning-state"),en("initialState"),ja("onTransition"),ja("onFinish"),tn("routes",qt(rt.value,qt(rt.value,Dt([cn("transition",[en("property"),en("transitionClass")])]))))];const Pd=Sr({fields:Hd,name:"transitioning",active:Dd,apis:Bd,extra:{createRoutes:e=>{const t={};return Pe(e,((e,n)=>{const o=n.split("<->");t[o[0]]=Nn(o[1],e),t[o[1]]=Nn(o[0],e)})),t},createBistate:(e,t,n)=>Fn([{key:e,value:Nn(t,n)},{key:t,value:Nn(e,n)}]),createTristate:(e,t,n,o)=>Fn([{key:e,value:Fn([{key:t,value:o},{key:n,value:o}])},{key:t,value:Fn([{key:e,value:o},{key:n,value:o}])},{key:n,value:Fn([{key:e,value:o},{key:t,value:o}])}])}}),Id=(e,t,n,o)=>{const r=n.get();n.set(o),((e,t,n)=>{t.toggleClass.each((t=>{n.get()?ta(e.element,t):na(e.element,t)}))})(e,t,n),((e,t,n)=>{const o=t.aria;o.update(e,o,n.get())})(e,t,n),r!==o&&t.onToggled(e,o)},Vd=(e,t,n)=>{Id(e,t,n,!n.get())},Wd=(e,t,n)=>{Id(e,t,n,t.selected)};var Ld=Object.freeze({__proto__:null,onLoad:Wd,toggle:Vd,isOn:(e,t,n)=>n.get(),on:(e,t,n)=>{Id(e,t,n,!0)},off:(e,t,n)=>{Id(e,t,n,!1)},set:Id}),Ud=Object.freeze({__proto__:null,exhibit:()=>br({}),events:(e,t)=>{const n=(o=e,r=t,s=Vd,mr((e=>{s(e,o,r)})));var o,r,s;const a=yr(e,t,Wd);return nr(Y([e.toggleOnExecute?[n]:[],[a]]))}});const jd=(e,t,n)=>{Ir(e.element,"aria-expanded",n)};var zd=[ln("selected",!1),rn("toggleClass"),ln("toggleOnExecute",!0),ja("onToggled"),un("aria",{mode:"none"},Jt("mode",{pressed:[ln("syncWithExpanded",!1),Ga("update",((e,t,n)=>{Ir(e.element,"aria-pressed",n),t.syncWithExpanded&&jd(e,0,n)}))],checked:[Ga("update",((e,t,n)=>{Ir(e.element,"aria-checked",n)}))],expanded:[Ga("update",jd)],selected:[Ga("update",((e,t,n)=>{Ir(e.element,"aria-selected",n)}))],none:[Ga("update",p)]}))];const $d=Sr({fields:zd,name:"toggling",active:Ud,apis:Ld,state:(!1,{init:()=>{const e=fn(false);return{get:()=>e.get(),set:t=>e.set(t),clear:()=>e.set(false),readState:()=>e.get()}}})});const qd=()=>{const e=(e,t)=>{t.stop(),Zo(e)};return[rr(To(),e),rr(Wo(),e),ar(_o()),ar(Oo())]},Gd=e=>nr(Y([e.map((e=>mr(((t,n)=>{e(t),n.stop()})))).toArray(),qd()])),Kd=(e,t,n)=>{const o=X(e.slice(0,t)),r=X(e.slice(t+1));return G(o.concat(r),n)},Yd=(e,t,n)=>{const o=X(e.slice(0,t));return G(o,n)},Qd=(e,t,n)=>{const o=e.slice(0,t),r=e.slice(t+1);return G(r.concat(o),n)},Jd=(e,t,n)=>{const o=e.slice(t+1);return G(o,n)},Xd=e=>t=>{const n=t.raw;return W(e,n.which)},Zd=e=>t=>J(e,(e=>e(t))),em=e=>!0===e.raw.shiftKey,tm=e=>!0===e.raw.ctrlKey,nm=(om=em,e=>!om(e));var om;const rm=(e,t)=>({matches:e,classification:t}),sm=(e,t,n,o)=>{const r=ut(e.element,"."+t.highlightClass);j(r,(n=>{L(o,(e=>e.element===n))||(na(n,t.highlightClass),e.getSystem().getByDom(n).each((n=>{t.onDehighlight(e,n),Jo(n,Qo())})))}))},am=(e,t,n,o)=>{sm(e,t,0,[o]),im(e,t,n,o)||(ta(o.element,t.highlightClass),t.onHighlight(e,o),Jo(o,Yo()))},im=(e,t,n,o)=>oa(o.element,t.highlightClass),cm=(e,t,n)=>ss(e.element,"."+t.itemClass).bind((t=>e.getSystem().getByDom(t).toOptional())),lm=(e,t,n)=>{const o=ut(e.element,"."+t.itemClass);return(o.length>0?E.some(o[o.length-1]):E.none()).bind((t=>e.getSystem().getByDom(t).toOptional()))},um=(e,t,n,o)=>{const r=ut(e.element,"."+t.itemClass);return K(r,(e=>oa(e,t.highlightClass))).bind((t=>{const n=Fc(t,o,0,r.length-1);return e.getSystem().getByDom(r[n]).toOptional()}))},dm=(e,t,n)=>{const o=ut(e.element,"."+t.itemClass);return pr(U(o,(t=>e.getSystem().getByDom(t).toOptional())))};var mm=Object.freeze({__proto__:null,dehighlightAll:(e,t,n)=>sm(e,t,0,[]),dehighlight:(e,t,n,o)=>{im(e,t,n,o)&&(na(o.element,t.highlightClass),t.onDehighlight(e,o),Jo(o,Qo()))},highlight:am,highlightFirst:(e,t,n)=>{cm(e,t).each((o=>{am(e,t,n,o)}))},highlightLast:(e,t,n)=>{lm(e,t).each((o=>{am(e,t,n,o)}))},highlightAt:(e,t,n,o)=>{((e,t,n,o)=>{const r=ut(e.element,"."+t.itemClass);return E.from(r[o]).fold((()=>rt.error(new Error("No element found with index "+o))),e.getSystem().getByDom)})(e,t,0,o).fold((e=>{throw e}),(o=>{am(e,t,n,o)}))},highlightBy:(e,t,n,o)=>{const r=dm(e,t);G(r,o).each((o=>{am(e,t,n,o)}))},isHighlighted:im,getHighlighted:(e,t,n)=>ss(e.element,"."+t.highlightClass).bind((t=>e.getSystem().getByDom(t).toOptional())),getFirst:cm,getLast:lm,getPrevious:(e,t,n)=>um(e,t,0,-1),getNext:(e,t,n)=>um(e,t,0,1),getCandidates:dm}),gm=[en("highlightClass"),en("itemClass"),ja("onHighlight"),ja("onDehighlight")];const pm=Sr({fields:gm,name:"highlighting",apis:mm}),hm=(e,t,n)=>{t.exists((e=>n.exists((t=>ie(t,e)))))||Xo(e,Ko(),{prevFocus:t,newFocus:n})},vm=()=>{const e=e=>Rr(e.element);return{get:e,set:(t,n)=>{const o=e(t);t.getSystem().triggerFocus(n,t.element);const r=e(t);hm(t,o,r)}}},fm=()=>{const e=e=>pm.getHighlighted(e).map((e=>e.element));return{get:e,set:(t,n)=>{const o=e(t);t.getSystem().getByDom(n).fold(p,(e=>{pm.highlight(t,e)}));const r=e(t);hm(t,o,r)}}};var bm;!function(e){e.OnFocusMode="onFocus",e.OnEnterOrSpaceMode="onEnterOrSpace",e.OnApiMode="onApi"}(bm||(bm={}));const ym=(e,t,n,o,r)=>{const s=(e,t,n,o,r)=>((e,t)=>{const n=G(e,(e=>e.matches(t)));return n.map((e=>e.classification))})(n(e,t,o,r),t.event).bind((n=>n(e,t,o,r))),a={schema:()=>e.concat([ln("focusManager",vm()),un("focusInside","onFocus",$t((e=>W(["onFocus","onEnterOrSpace","onApi"],e)?rt.value(e):rt.error("Invalid value for focusInside")))),Ga("handler",a),Ga("state",t),Ga("sendFocusIn",r)]),processKey:s,toEvents:(e,t)=>{const a=e.focusInside!==bm.OnFocusMode?E.none():r(e).map((n=>rr(Bo(),((o,r)=>{n(o,e,t),r.stop()})))),i=[rr(Co(),((o,a)=>{s(o,a,n,e,t).fold((()=>{((n,o)=>{const s=Xd(ds.concat(ls))(o.event);e.focusInside===bm.OnEnterOrSpaceMode&&s&&Dn(n,o)&&r(e).each((r=>{r(n,e,t),o.stop()}))})(o,a)}),(e=>{a.stop()}))})),rr(Eo(),((n,r)=>{s(n,r,o,e,t).each((e=>{r.stop()}))}))];return nr(a.toArray().concat(i))}};return a},_m=e=>{const t=[rn("onEscape"),rn("onEnter"),ln("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),ln("firstTabstop",0),ln("useTabstopAt",O),rn("visibilitySelector")].concat([e]),n=(e,t)=>{const n=e.visibilitySelector.bind((e=>as(t,e))).getOr(t);return ec(n)>0},o=(e,t,o)=>{((e,t)=>{const o=ut(e.element,t.selector),r=z(o,(e=>n(t,e)));return E.from(r[t.firstTabstop])})(e,t).each((n=>{t.focusManager.set(e,n)}))},r=(e,t,o,r)=>{const s=ut(e.element,o.selector);return((e,t)=>t.focusManager.get(e).bind((e=>as(e,t.selector))))(e,o).bind((t=>K(s,y(ie,t)).bind((t=>((e,t,o,r,s)=>s(t,o,(e=>((e,t)=>n(e,t)&&e.useTabstopAt(t))(r,e))).fold((()=>r.cyclic?E.some(!0):E.none()),(t=>(r.focusManager.set(e,t),E.some(!0)))))(e,s,t,o,r)))))},s=v([rm(Zd([em,Xd(cs)]),((e,t,n)=>{const o=n.cyclic?Kd:Yd;return r(e,0,n,o)})),rm(Xd(cs),((e,t,n)=>{const o=n.cyclic?Qd:Jd;return r(e,0,n,o)})),rm(Zd([nm,Xd(ls)]),((e,t,n)=>n.onEnter.bind((n=>n(e,t)))))]),a=v([rm(Xd(us),((e,t,n)=>n.onEscape.bind((n=>n(e,t)))))]);return ym(t,An.init,s,a,(()=>E.some(o)))};var xm=_m(Zt("cyclic",w)),wm=_m(Zt("cyclic",O));const Om=e=>pe("input")(e)&&"radio"!==Wr(e,"type")||pe("textarea")(e),Sm=(e,t,n)=>Om(n)&&Xd(ds)(t.event)?E.none():((e,t,n)=>(er(e,n,Io()),E.some(!0)))(e,0,n),Cm=(e,t)=>E.some(!0),Em=[ln("execute",Sm),ln("useSpace",!1),ln("useEnter",!0),ln("useControlEnter",!1),ln("useDown",!1)],km=(e,t,n)=>n.execute(e,t,e.element);var Tm=ym(Em,An.init,((e,t,n,o)=>{const r=n.useSpace&&!Om(e.element)?ds:[],s=n.useEnter?ls:[],a=n.useDown?hs:[],i=r.concat(s).concat(a);return[rm(Xd(i),km)].concat(n.useControlEnter?[rm(Zd([tm,Xd(ls)]),km)]:[])}),((e,t,n,o)=>n.useSpace&&!Om(e.element)?[rm(Xd(ds),Cm)]:[]),(()=>E.none()));const Am=()=>{const e=es();return Mn({readState:()=>e.get().map((e=>({numRows:String(e.numRows),numColumns:String(e.numColumns)}))).getOr({numRows:"?",numColumns:"?"}),setGridSize:(t,n)=>{e.set({numRows:t,numColumns:n})},getNumRows:()=>e.get().map((e=>e.numRows)),getNumColumns:()=>e.get().map((e=>e.numColumns))})};var Mm=Object.freeze({__proto__:null,flatgrid:Am,init:e=>e.state(e)});const Rm=e=>(t,n,o,r)=>{const s=e(t.element);return Dm(s,t,n,o,r)},Nm=(e,t)=>{const n=hl(e,t);return Rm(n)},Fm=(e,t)=>{const n=hl(t,e);return Rm(n)},Bm=e=>(t,n,o,r)=>Dm(e,t,n,o,r),Dm=(e,t,n,o,r)=>o.focusManager.get(t).bind((n=>e(t.element,n,o,r))).map((e=>(o.focusManager.set(t,e),!0))),Hm=Bm,Pm=Bm,Im=Bm,Vm=(e,t,n)=>{const o=ut(e,n);return((e,n)=>K(e,(e=>ie(e,t))).map((t=>({index:t,candidates:e}))))(z(o,Mu))},Wm=(e,t)=>K(e,(e=>ie(t,e))),Lm=(e,t,n,o)=>o(Math.floor(t/n),t%n).bind((t=>{const o=t.row*n+t.column;return o>=0&&o<e.length?E.some(e[o]):E.none()})),Um=(e,t,n,o,r)=>Lm(e,t,o,((t,s)=>{const a=t===n-1?e.length-t*o:o,i=Fc(s,r,0,a-1);return E.some({row:t,column:i})})),jm=(e,t,n,o,r)=>Lm(e,t,o,((t,s)=>{const a=Fc(t,r,0,n-1),i=a===n-1?e.length-a*o:o,c=Bc(s,0,i-1);return E.some({row:a,column:c})})),zm=[en("selector"),ln("execute",Sm),za("onEscape"),ln("captureTab",!1),Ya()],$m=(e,t,n)=>{ss(e.element,t.selector).each((n=>{t.focusManager.set(e,n)}))},qm=e=>(t,n,o,r)=>Vm(t,n,o.selector).bind((t=>e(t.candidates,t.index,r.getNumRows().getOr(o.initSize.numRows),r.getNumColumns().getOr(o.initSize.numColumns)))),Gm=(e,t,n)=>n.captureTab?E.some(!0):E.none(),Km=qm(((e,t,n,o)=>Um(e,t,n,o,-1))),Ym=qm(((e,t,n,o)=>Um(e,t,n,o,1))),Qm=qm(((e,t,n,o)=>jm(e,t,n,o,-1))),Jm=qm(((e,t,n,o)=>jm(e,t,n,o,1))),Xm=v([rm(Xd(ms),Nm(Km,Ym)),rm(Xd(ps),Fm(Km,Ym)),rm(Xd(gs),Hm(Qm)),rm(Xd(hs),Pm(Jm)),rm(Zd([em,Xd(cs)]),Gm),rm(Zd([nm,Xd(cs)]),Gm),rm(Xd(ds.concat(ls)),((e,t,n,o)=>((e,t)=>t.focusManager.get(e).bind((e=>as(e,t.selector))))(e,n).bind((o=>n.execute(e,t,o)))))]),Zm=v([rm(Xd(us),((e,t,n)=>n.onEscape(e,t))),rm(Xd(ds),Cm)]);var eg=ym(zm,Am,Xm,Zm,(()=>E.some($m)));const tg=(e,t,n,o)=>{const r=(e,t,n)=>{const s=Fc(t,o,0,n.length-1);return s===e?E.none():(a=n[s],"button"===ce(a)&&"disabled"===Wr(a,"disabled")?r(e,s,n):E.from(n[s]));var a};return Vm(e,n,t).bind((e=>{const t=e.index,n=e.candidates;return r(t,t,n)}))},ng=[en("selector"),ln("getInitial",E.none),ln("execute",Sm),za("onEscape"),ln("executeOnMove",!1),ln("allowVertical",!0)],og=(e,t,n)=>((e,t)=>t.focusManager.get(e).bind((e=>as(e,t.selector))))(e,n).bind((o=>n.execute(e,t,o))),rg=(e,t,n)=>{t.getInitial(e).orThunk((()=>ss(e.element,t.selector))).each((n=>{t.focusManager.set(e,n)}))},sg=(e,t,n)=>tg(e,n.selector,t,-1),ag=(e,t,n)=>tg(e,n.selector,t,1),ig=e=>(t,n,o,r)=>e(t,n,o,r).bind((()=>o.executeOnMove?og(t,n,o):E.some(!0))),cg=v([rm(Xd(ds),Cm),rm(Xd(us),((e,t,n)=>n.onEscape(e,t)))]);var lg=ym(ng,An.init,((e,t,n,o)=>{const r=ms.concat(n.allowVertical?gs:[]),s=ps.concat(n.allowVertical?hs:[]);return[rm(Xd(r),ig(Nm(sg,ag))),rm(Xd(s),ig(Fm(sg,ag))),rm(Xd(ls),og),rm(Xd(ds),og)]}),cg,(()=>E.some(rg)));const ug=(e,t,n)=>E.from(e[t]).bind((e=>E.from(e[n]).map((e=>({rowIndex:t,columnIndex:n,cell:e}))))),dg=(e,t,n,o)=>{const r=e[t].length,s=Fc(n,o,0,r-1);return ug(e,t,s)},mg=(e,t,n,o)=>{const r=Fc(n,o,0,e.length-1),s=e[r].length,a=Bc(t,0,s-1);return ug(e,r,a)},gg=(e,t,n,o)=>{const r=e[t].length,s=Bc(n+o,0,r-1);return ug(e,t,s)},pg=(e,t,n,o)=>{const r=Bc(n+o,0,e.length-1),s=e[r].length,a=Bc(t,0,s-1);return ug(e,r,a)},hg=[on("selectors",[en("row"),en("cell")]),ln("cycles",!0),ln("previousSelector",E.none),ln("execute",Sm)],vg=(e,t,n)=>{const o=t.previousSelector(e).orThunk((()=>{const n=t.selectors;return ss(e.element,n.cell)}));o.each((n=>{t.focusManager.set(e,n)}))},fg=(e,t)=>(n,o,r)=>{const s=r.cycles?e:t;return as(o,r.selectors.row).bind((e=>{const t=ut(e,r.selectors.cell);return Wm(t,o).bind((t=>{const o=ut(n,r.selectors.row);return Wm(o,e).bind((e=>{const n=((e,t)=>U(e,(e=>ut(e,t.selectors.cell))))(o,r);return s(n,e,t).map((e=>e.cell))}))}))}))},bg=fg(((e,t,n)=>dg(e,t,n,-1)),((e,t,n)=>gg(e,t,n,-1))),yg=fg(((e,t,n)=>dg(e,t,n,1)),((e,t,n)=>gg(e,t,n,1))),_g=fg(((e,t,n)=>mg(e,n,t,-1)),((e,t,n)=>pg(e,n,t,-1))),xg=fg(((e,t,n)=>mg(e,n,t,1)),((e,t,n)=>pg(e,n,t,1))),wg=v([rm(Xd(ms),Nm(bg,yg)),rm(Xd(ps),Fm(bg,yg)),rm(Xd(gs),Hm(_g)),rm(Xd(hs),Pm(xg)),rm(Xd(ds.concat(ls)),((e,t,n)=>Rr(e.element).bind((o=>n.execute(e,t,o)))))]),Og=v([rm(Xd(ds),Cm)]);var Sg=ym(hg,An.init,wg,Og,(()=>E.some(vg)));const Cg=[en("selector"),ln("execute",Sm),ln("moveOnTab",!1)],Eg=(e,t,n)=>n.focusManager.get(e).bind((o=>n.execute(e,t,o))),kg=(e,t,n)=>{ss(e.element,t.selector).each((n=>{t.focusManager.set(e,n)}))},Tg=(e,t,n)=>tg(e,n.selector,t,-1),Ag=(e,t,n)=>tg(e,n.selector,t,1),Mg=v([rm(Xd(gs),Im(Tg)),rm(Xd(hs),Im(Ag)),rm(Zd([em,Xd(cs)]),((e,t,n,o)=>n.moveOnTab?Im(Tg)(e,t,n,o):E.none())),rm(Zd([nm,Xd(cs)]),((e,t,n,o)=>n.moveOnTab?Im(Ag)(e,t,n,o):E.none())),rm(Xd(ls),Eg),rm(Xd(ds),Eg)]),Rg=v([rm(Xd(ds),Cm)]);var Ng=ym(Cg,An.init,Mg,Rg,(()=>E.some(kg)));const Fg=[za("onSpace"),za("onEnter"),za("onShiftEnter"),za("onLeft"),za("onRight"),za("onTab"),za("onShiftTab"),za("onUp"),za("onDown"),za("onEscape"),ln("stopSpaceKeyup",!1),rn("focusIn")];var Bg=ym(Fg,An.init,((e,t,n)=>[rm(Xd(ds),n.onSpace),rm(Zd([nm,Xd(ls)]),n.onEnter),rm(Zd([em,Xd(ls)]),n.onShiftEnter),rm(Zd([em,Xd(cs)]),n.onShiftTab),rm(Zd([nm,Xd(cs)]),n.onTab),rm(Xd(gs),n.onUp),rm(Xd(hs),n.onDown),rm(Xd(ms),n.onLeft),rm(Xd(ps),n.onRight),rm(Xd(ds),n.onSpace)]),((e,t,n)=>[...n.stopSpaceKeyup?[rm(Xd(ds),Cm)]:[],rm(Xd(us),n.onEscape)]),(e=>e.focusIn));const Dg=xm.schema(),Hg=wm.schema(),Pg=lg.schema(),Ig=eg.schema(),Vg=Sg.schema(),Wg=Tm.schema(),Lg=Ng.schema(),Ug=Bg.schema(),jg=(e=>{const t=Yt("Creating behaviour: "+e.name,Cr,e);return((e,t,n,o,r,s)=>{const a=e,i=an(t,[sn("config",e)]);return xr(a,i,t,n,o,r,s)})(Jt(t.branchKey,t.branches),t.name,t.active,t.apis,t.extra,t.state)})({branchKey:"mode",branches:Object.freeze({__proto__:null,acyclic:Dg,cyclic:Hg,flow:Pg,flatgrid:Ig,matrix:Vg,execution:Wg,menu:Lg,special:Ug}),name:"keying",active:{events:(e,t)=>e.handler.toEvents(e,t)},apis:{focusIn:(e,t,n)=>{t.sendFocusIn(t).fold((()=>{e.getSystem().triggerFocus(e.element,e.element)}),(o=>{o(e,t,n)}))},setGridSize:(e,t,n,o,r)=>{(e=>Ge(e,"setGridSize"))(n)?n.setGridSize(o,r):console.error("Layout does not support setGridSize")}},state:Mm}),zg=Ri({name:"Button",factory:e=>{const t=Gd(e.action),n=e.dom.tag,o=t=>$e(e.dom,"attributes").bind((e=>$e(e,t)));return{uid:e.uid,dom:e.dom,components:e.components,events:t,behaviours:Da(e.buttonBehaviours,[md.config({}),jg.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:"button"===n?{type:o("type").getOr("button"),...o("role").map((e=>({role:e}))).getOr({})}:{role:o("role").getOr("button")}},eventOrder:e.eventOrder}},configFields:[ln("uid",void 0),en("dom"),ln("components",[]),Ba("buttonBehaviours",[md,jg]),rn("action"),rn("role"),ln("eventOrder",{})]}),$g=["input","button","textarea","select"],qg=(e,t,n)=>{(t.disabled()?Xg:Zg)(e,t)},Gg=(e,t)=>!0===t.useNative&&W($g,ce(e.element)),Kg=e=>{Ir(e.element,"disabled","disabled")},Yg=e=>{jr(e.element,"disabled")},Qg=e=>{Ir(e.element,"aria-disabled","true")},Jg=e=>{Ir(e.element,"aria-disabled","false")},Xg=(e,t,n)=>{t.disableClass.each((t=>{ta(e.element,t)})),(Gg(e,t)?Kg:Qg)(e),t.onDisabled(e)},Zg=(e,t,n)=>{t.disableClass.each((t=>{na(e.element,t)})),(Gg(e,t)?Yg:Jg)(e),t.onEnabled(e)},ep=(e,t)=>Gg(e,t)?(e=>Ur(e.element,"disabled"))(e):(e=>"true"===Wr(e.element,"aria-disabled"))(e);var tp=Object.freeze({__proto__:null,enable:Zg,disable:Xg,isDisabled:ep,onLoad:qg,set:(e,t,n,o)=>{(o?Xg:Zg)(e,t)}}),np=Object.freeze({__proto__:null,exhibit:(e,t)=>br({classes:t.disabled()?t.disableClass.toArray():[]}),events:(e,t)=>nr([or(Io(),((t,n)=>ep(t,e))),yr(e,t,qg)])}),op=[((e,t)=>un("disabled",t,jt))(0,w),ln("useNative",!0),rn("disableClass"),ja("onDisabled"),ja("onEnabled")];const rp=Sr({fields:op,name:"disabling",active:np,apis:tp});var sp=Object.freeze({__proto__:null,events:e=>nr([rr(Po(),((t,n)=>{const o=e.channels,r=De(o),s=n,a=((e,t)=>t.universal?e:z(e,(e=>W(t.channels,e))))(r,s);j(a,(e=>{const n=o[e],r=n.schema,a=Yt("channel["+e+"] data\nReceiver: "+$r(t.element),r,s.data);n.onReceive(t,a)}))}))])}),ap=[tn("channels",qt(rt.value,Dt([$a("onReceive"),ln("schema",Vt())])))];const ip=Sr({fields:ap,name:"receiving",active:sp}),cp=e=>{var t;return rp.config(null!==(t=e.disablingConfig)&&void 0!==t?t:{})},lp=e=>({[kn]:{schema:dn,onReceive:(t,n)=>{rp.set(t,e(n))}}}),up=e=>{var t;const n=null!==(t=e.disableWhileSaving)&&void 0!==t&&t;return[cp(e),(o=n?gn:mn,ip.config({channels:lp(o)}))];var o},dp=e=>t=>{var n;const o=null!==(n=t.disableWhileSaving)&&void 0!==n&&n,r=t.eventName.map((e=>({action:t=>{Jo(t,e)}}))).getOr({});return zg.sketch({dom:{tag:"button",classes:e,styles:void 0!==t.styles?t.styles:{}},components:[Ea(t.text)],...r,buttonBehaviours:wr([Td.config({}),...up({disableWhileSaving:o})])})},mp=dp(td.button),gp=dp(td.secondaryButton),pp="tc-save-edit",hp="tc-cancel-edit",vp=Ss("tc-patch-comment-state-event"),fp=Ss("tc-purge-comment-state-event"),bp=Ss("tc-force-patch-state-event");var yp,_p;!function(e){e.None="Prop_None",e.Collapsed="Prop_Collapsed",e.Expanded="Prop_Expanded",e.CollapsedOrNone="Prop_CollapsedOrNone",e.ExpandOrNone="Prop_ExpandOrNone",e.Edit="Prop_Edit"}(yp||(yp={})),function(e){e[e.Before=0]="Before",e[e.QueryingDelete=1]="QueryingDelete",e[e.QueryingResolve=2]="QueryingResolve",e[e.PostDelete=3]="PostDelete",e[e.PostResolve=4]="PostResolve"}(_p||(_p={}));const xp=e=>U(e.conversation,(e=>e.props)),wp=(e,t)=>({...e,targetUid:t}),Op=(e,t)=>({...e,queue:e.queue.concat(t)}),Sp=()=>({targetUid:E.none(),conversation:[],queue:[]}),Cp=(e,t)=>n=>{const o=t(n);Xo(n,vp,{uid:e,patch:o})},Ep=(e,t)=>n=>{const o=t(n);Xo(n,vp,{uid:e,patch:o}),Jo(n,bp)},kp=e=>{Jo(e,bp)},Tp=(e,t)=>{la(e.element,"visibility","hidden"),$d.set(e,!1);const n=e.element.dom.clientHeight;return $d.set(e,!0),ha(e.element,"visibility"),e.element.dom.scrollHeight>n+1?t:yp.None},Ap=e=>{$d.off(e),ta(e.element,ed.bodyHasGradient)},Mp=e=>{$d.on(e),na(e.element,ed.bodyHasGradient)},Rp=e=>we(e.element),Np=e=>{na(e.element,ed.bodyHasGradient),$d.set(e,!1),jr(e.element,"aria-expanded")},Fp=e=>{Rp(e).each((e=>{jr(e,"readonly"),ta(e,ed.editingTextarea),Ar(e);const t=e.dom,n=fa(e).length;t.setSelectionRange(n,n)})),e.element.dom.scrollTop=0},Bp=e=>{const t=e=>t=>{j(e,(e=>e(t)))},n=t=>{Rp(t).each((n=>{const o=pa(n,"width");la(n,"width",oc(n)+"px"),ha(n,"height"),Cd.setValue(t,e.props.content),t.getSystem().triggerEvent(ko(),n,{}),da(n,{width:o})}))},o=t=>{return n=t,o=e.memCommands,(e=>{Rp(e).each((e=>{Ir(e,"readonly","true"),na(e,ed.editingTextarea)}))})(n),void o.getOpt(n).each((e=>{Au.remove(n,e)}));var n,o},r={[yp.None]:t([o,n,Np]),[yp.Expanded]:t([o,n,Mp]),[yp.Collapsed]:t([o,n,Ap]),[yp.ExpandOrNone]:t([o,n,t=>{ta(t.element,ed.bodyNotAnimating);const n=Tp(t,yp.Expanded);Cp(e.props.uid,(()=>({mode:n})))(t)}]),[yp.CollapsedOrNone]:t([o,n,t=>{ta(t.element,ed.bodyNotAnimating);const n=Tp(t,yp.Collapsed);n===yp.Collapsed&&(ta(t.element,ed.bodyHasGradient),$d.off(t)),va(t.element),Cp(e.props.uid,(()=>({mode:n})))(t)}]),[yp.Edit]:t([t=>{return n=t,o=e.memCommands,$d.on(n),na(n.element,ed.bodyHasGradient),void((e,t)=>{Fp(e),t.getOpt(e).fold((()=>{Au.append(e,t.asSpec())}),p)})(n,o);var n,o},n])};return $e(r,e.props.mode)},Dp=Ss("tc-focus-outer-comment"),Hp=Ss("tc-start-delete-comment"),Pp=Ss("tc-start-delete-conversation"),Ip=Ss("tc-start-resolve-conversation"),Vp=Ss("tc-commit-delete"),Wp=Ss("tc-commit-resolve"),Lp=Ss("tc-start-edit-comment"),Up=Ss("tc-commit-edit-comment");Ss("tc-cancel-edit-comment"),Ss("tc-long-content"),Ss("tc-short-content");const jp=Ss("tc-toggle-comment"),zp=v([rn("data"),ln("inputAttributes",{}),ln("inputStyles",{}),ln("tag","input"),ln("inputClasses",[]),ja("onSetValue"),ln("styles",{}),ln("eventOrder",{}),Na("inputBehaviours",[Cd,md]),ln("selectOnFocus",!0)]),$p=e=>wr([md.config({onFocus:e.selectOnFocus?e=>{const t=e.element,n=fa(t);t.dom.setSelectionRange(0,n.length)}:p})]),qp=e=>({...$p(e),...Fa(e.inputBehaviours,[Cd.config({store:{mode:"manual",...e.data.map((e=>({initialValue:e}))).getOr({}),getValue:e=>fa(e.element),setValue:(e,t)=>{fa(e.element)!==t&&ba(e.element,t)}},onSetValue:e.onSetValue})])}),Gp=e=>({tag:e.tag,attributes:{type:"text",...e.inputAttributes},styles:e.inputStyles,classes:e.inputClasses}),Kp=Ri({name:"Input",configFields:zp(),factory:(e,t)=>({uid:e.uid,dom:Gp(e),components:[],behaviours:qp(e),eventOrder:e.eventOrder})}),Yp=e=>e.dom.clientHeight,Qp="data-alloy-widget-tabstop",Jp=e=>jg.config({mode:"cyclic",onEscape:e.onEscape,useTabstopAt:e=>"textarea"!==ce(e)||"true"!==Wr(e,"readonly")}),Xp=e=>jg.config({mode:"special",onEnter:t=>(Jo(t,e.enterEvent),E.some(!0)),onShiftEnter:(e,t)=>(t.cut(),E.none()),onSpace:(e,t)=>(t.cut(),E.none())}),Zp=e=>jg.config({mode:"cyclic",selector:`[${Qp}="true"]`,focusInside:bm.OnEnterOrSpaceMode,onEscape:(t,n)=>Dn(t,n)?E.none():(Jo(t,e.escapeEvent),E.some(!0))}),eh=e=>jg.config({mode:"flow",allowVertical:!0,selector:e.selector}),th={"data-gramm_editor":"false",rows:"2"},nh={"white-space":"pre-wrap"},oh=(e,t)=>{const n=e.element.dom;ha(e.element,"height"),va(e.element);const o=n.clientHeight,r=n.scrollHeight;if(r>o){const n=ec(e.element),s=n-o;la(e.element,"height",t(r,n,s)+"px")}},rh=e=>{oh(e,((t,n,o)=>{const r=(s=e.element,ye(s).bind((e=>ye(e).bind((t=>xe(t,1).map((n=>{const o=ec(e)-Yp(s);return.5*(Yp(t)-Yp(n)-o)}))))))).getOr(3*n);var s;if(r<n)return n;{const e=t+o;return e>r?r:e}}))},sh=e=>oh(e,((e,t,n)=>e+n)),ah=e=>{const t=es();return Kp.sketch({tag:"textarea",inputAttributes:{...th,readonly:"true"},inputClasses:td.editTextarea,inputStyles:{...nh,"overflow-y":"hidden",border:"none !important"},data:e,inputBehaviours:wr([kr("textarea-events",[lr((e=>{t.set(oc(e.element)),sh(e)})),rr(ko(),sh)]),ip.config({channels:{...lp(gn),[Tn]:{onReceive:e=>{const n=oc(e.element);t.on((t=>{t!==n&&ha(e.element,"height")})),t.set(n),sh(e)}}}}),Xp({enterEvent:Up}),Td.config({}),cp({})])})},ih=Sn,ch={[ih.LessThanMinute]:[Du.tc_date_less_than_a_minute_ago,Du.tc_date_less_than_a_minute_ago],[ih.Minute]:[Du.tc_date_1_minute_ago,Du.tc_date_x_minutes_ago],[ih.Hour]:[Du.tc_date_1_hour_ago,Du.tc_date_x_hours_ago],[ih.Day]:[Du.tc_date_1_day_ago,Du.tc_date_x_days_ago],[ih.Week]:[Du.tc_date_1_week_ago,Du.tc_date_x_weeks_ago],[ih.Month]:[Du.tc_date_1_month_ago,Du.tc_date_x_months_ago],[ih.Year]:[Du.tc_date_1_year_ago,Du.tc_date_x_years_ago]},lh=(e,t)=>{const n=ch[e.interval],o=1===e.intervalUnits?n[0]:n[1];return t.translate([o,e.intervalUnits])},uh={editCommentEvent:Ss("tc-conversation-edit-comment"),deleteCommentEvent:Ss("tc-conversation-delete-comment"),deleteConversationEvent:Ss("tc-conversation-delete-all"),resolveConversationEvent:Ss("tc-conversation-resolve"),createCommentEvent:Ss("tc-conversation-create")},dh="aria-controls",mh=(e,t)=>fl(t,(t=>ie(t,e.element)),w)||((e,t)=>(e=>os(e,(e=>{if(!ue(e))return!1;const t=Wr(e,"id");return void 0!==t&&t.indexOf(dh)>-1})).bind((e=>{const t=Wr(e,"id"),n=Ee(e);return ss(n,`[${dh}="${t}"]`)})))(t).exists((t=>mh(e,t))))(e,t);var gh=Object.freeze({__proto__:null,getCoupled:(e,t,n,o)=>n.getOrCreate(e,t,o)}),ph=[tn("others",qt(rt.value,Vt()))],hh=Object.freeze({__proto__:null,init:()=>{const e={},t=v({});return Mn({readState:t,getOrCreate:(t,n,o)=>{const r=De(n.others);if(r)return $e(e,o).getOrThunk((()=>{const r=$e(n.others,o).getOrDie("No information found for coupled component: "+o)(t),s=t.getSystem().build(r);return e[o]=s,s}));throw new Error("Cannot find coupled component: "+o+". Known coupled components: "+JSON.stringify(r,null,2))}})}});const vh=Sr({fields:ph,name:"coupling",apis:gh,state:hh}),fh=(e,t,n,o)=>{n.get().each((t=>{ji(e)}));const r=t.getAttachPoint(e);Vi(r,e);const s=e.getSystem().build(o);return Vi(e,s),n.set(s),s},bh=(e,t,n,o)=>{const r=fh(e,t,n,o);return t.onOpen(e,r),r},yh=(e,t,n)=>{n.get().each((o=>{ji(e),Ui(e),t.onClose(e,o),n.clear()}))},_h=(e,t,n)=>n.isOpen(),xh=(e,t,n)=>{const o=t.getAttachPoint(e);la(e.element,"position",_u.getMode(o)),((e,t,n,o)=>{pa(e.element,t).fold((()=>{jr(e.element,n)}),(t=>{Ir(e.element,n,t)})),la(e.element,t,"hidden")})(e,"visibility",t.cloakVisibilityAttr)},wh=(e,t,n)=>{(e=>L(["top","left","right","bottom"],(t=>pa(e,t).isSome())))(e.element)||ha(e.element,"position"),((e,t,n)=>{Lr(e.element,n).fold((()=>ha(e.element,t)),(n=>la(e.element,t,n)))})(e,"visibility",t.cloakVisibilityAttr)};var Oh=Object.freeze({__proto__:null,cloak:xh,decloak:wh,open:bh,openWhileCloaked:(e,t,n,o,r)=>{xh(e,t),bh(e,t,n,o),r(),wh(e,t)},close:yh,isOpen:_h,isPartOf:(e,t,n,o)=>_h(0,0,n)&&n.get().exists((n=>t.isPartOf(e,n,o))),getState:(e,t,n)=>n.get(),setContent:(e,t,n,o)=>n.get().map((()=>fh(e,t,n,o)))}),Sh=Object.freeze({__proto__:null,events:(e,t)=>nr([rr(Uo(),((n,o)=>{yh(n,e,t)}))])}),Ch=[ja("onOpen"),ja("onClose"),en("isPartOf"),en("getAttachPoint"),ln("cloakVisibilityAttr","data-precloak-visibility")],Eh=Object.freeze({__proto__:null,init:()=>{const e=es(),t=v("not-implemented");return Mn({readState:t,isOpen:e.isSet,clear:e.clear,set:e.set,get:e.get})}});const kh=Sr({fields:Ch,name:"sandboxing",active:Sh,apis:Oh,state:Eh}),Th="alloy.item-hover",Ah="alloy.item-focus",Mh="alloy.item-toggled",Rh=e=>{(Rr(e.element).isNone()||md.isFocused(e))&&(md.isFocused(e)||md.focus(e),Xo(e,Th,{item:e}))},Nh=e=>{Xo(e,Ah,{item:e})},Fh=v(Th),Bh=v(Ah),Dh=v(Mh),Hh=e=>e.toggling.map((e=>e.exclusive?"menuitemradio":"menuitemcheckbox")).getOr("menuitem"),Ph=[en("data"),en("components"),en("dom"),ln("hasSubmenu",!1),rn("toggling"),Ba("itemBehaviours",[$d,md,jg,Cd]),ln("ignoreFocus",!1),ln("domModification",{}),Ga("builder",(e=>({dom:e.dom,domModification:{...e.domModification,attributes:{role:Hh(e),...e.domModification.attributes,"aria-haspopup":e.hasSubmenu,...e.hasSubmenu?{"aria-expanded":!1}:{}}},behaviours:Da(e.itemBehaviours,[e.toggling.fold($d.revoke,(e=>$d.config((e=>({aria:{mode:"checked"},...Ue(e,((e,t)=>"exclusive"!==t)),onToggled:(t,n)=>{m(e.onToggled)&&e.onToggled(t,n),((e,t)=>{Xo(e,Mh,{item:e,state:t})})(t,n)}}))(e)))),md.config({ignore:e.ignoreFocus,stopMousedown:e.ignoreFocus,onFocus:e=>{Nh(e)}}),jg.config({mode:"execution"}),Cd.config({store:{mode:"memory",initialValue:e.data}}),kr("item-type-events",[...qd(),rr(So(),Rh),rr(Vo(),md.focus)])]),components:e.components,eventOrder:e.eventOrder}))),ln("eventOrder",{})],Ih=[en("dom"),en("components"),Ga("builder",(e=>({dom:e.dom,components:e.components,events:nr([ir(Vo())])})))],Vh=v("item-widget"),Wh=v([fi({name:"widget",overrides:e=>({behaviours:wr([Cd.config({store:{mode:"manual",getValue:t=>e.data,setValue:p}})])})})]),Lh=[en("uid"),en("data"),en("components"),en("dom"),ln("autofocus",!1),ln("ignoreFocus",!1),Ba("widgetBehaviours",[Cd,md,jg]),ln("domModification",{}),Ei(Wh()),Ga("builder",(e=>{const t=Si(Vh(),e,Wh()),n=Ci(Vh(),e,t.internals()),o=t=>((e,t,n)=>{const o=t.partUids.widget;return e.getSystem().getByUid(o).toOptional()})(t,e).map((e=>(jg.focusIn(e),e))),r=(t,n)=>Om(n.event.target)?E.none():e.autofocus?(n.setSource(t.element),E.none()):E.none();return{dom:e.dom,components:n,domModification:e.domModification,events:nr([mr(((e,t)=>{o(e).each((e=>{t.stop()}))})),rr(So(),Rh),rr(Vo(),((t,n)=>{e.autofocus?o(t):md.focus(t)}))]),behaviours:Da(e.widgetBehaviours,[Cd.config({store:{mode:"memory",initialValue:e.data}}),md.config({ignore:e.ignoreFocus,onFocus:e=>{Nh(e)}}),jg.config({mode:"special",focusIn:e.autofocus?e=>{o(e)}:Er(),onLeft:r,onRight:r,onEscape:(t,n)=>md.isFocused(t)||e.autofocus?e.autofocus?(n.setSource(t.element),E.none()):E.none():(md.focus(t),E.some(!0))})])}}))],Uh=Jt("type",{widget:Lh,item:Ph,separator:Ih}),jh=v([_i({factory:{sketch:e=>{const t=Yt("menu.spec item",Uh,e);return t.builder(t)}},name:"items",unit:"item",defaults:(e,t)=>qe(t,"uid")?t:{...t,uid:Rs("item")},overrides:(e,t)=>({type:t.type,ignoreFocus:e.fakeFocus,domModification:{classes:[e.markers.item]}})})]),zh=v([en("value"),en("items"),en("dom"),en("components"),ln("eventOrder",{}),Na("menuBehaviours",[pm,Cd,id,jg]),un("movement",{mode:"menu",moveOnTab:!0},Jt("mode",{grid:[Ya(),Ga("config",((e,t)=>({mode:"flatgrid",selector:"."+e.markers.item,initSize:{numColumns:t.initSize.numColumns,numRows:t.initSize.numRows},focusManager:e.focusManager})))],matrix:[Ga("config",((e,t)=>({mode:"matrix",selectors:{row:t.rowSelector,cell:"."+e.markers.item},focusManager:e.focusManager}))),en("rowSelector")],menu:[ln("moveOnTab",!0),Ga("config",((e,t)=>({mode:"menu",selector:"."+e.markers.item,moveOnTab:t.moveOnTab,focusManager:e.focusManager})))]})),tn("markers",Va()),ln("fakeFocus",!1),ln("focusManager",vm()),ja("onHighlight")]),$h=v("alloy.menu-focus"),qh=Ni({name:"Menu",configFields:zh(),partFields:jh(),factory:(e,t,n,o)=>({uid:e.uid,dom:e.dom,markers:e.markers,behaviours:Fa(e.menuBehaviours,[pm.config({highlightClass:e.markers.selectedItem,itemClass:e.markers.item,onHighlight:e.onHighlight}),Cd.config({store:{mode:"memory",initialValue:e.value}}),id.config({find:E.some}),jg.config(e.movement.config(e,e.movement))]),events:nr([rr(Bh(),((e,t)=>{const n=t.event;e.getSystem().getByDom(n.target).each((n=>{pm.highlight(e,n),t.stop(),Xo(e,$h(),{menu:e,item:n})}))})),rr(Fh(),((e,t)=>{const n=t.event.item;pm.highlight(e,n)})),rr(Dh(),((e,t)=>{const{item:n,state:o}=t.event;o&&"menuitemradio"===Wr(n.element,"role")&&((e,t)=>{const n=ut(e.element,'[role="menuitemradio"][aria-checked="true"]');j(n,(n=>{ie(n,t.element)||e.getSystem().getByDom(n).each((e=>{$d.off(e)}))}))})(e,n)}))]),components:t,eventOrder:e.eventOrder,domModification:{attributes:{role:"menu"}}})}),Gh=(e,t,n,o)=>$e(n,o).bind((o=>$e(e,o).bind((o=>{const r=Gh(e,t,n,o);return E.some([o].concat(r))})))).getOr([]),Kh=e=>"prepared"===e.type?E.some(e.menu):E.none(),Yh=()=>{const e=fn({}),t=fn({}),n=fn({}),o=es(),r=fn({}),s=e=>a(e).bind(Kh),a=e=>$e(t.get(),e),i=t=>$e(e.get(),t);return{setMenuBuilt:(e,n)=>{t.set({...t.get(),[e]:{type:"prepared",menu:n}})},setContents:(s,a,i,c)=>{o.set(s),e.set(i),t.set(a),r.set(c);const l=((e,t)=>{const n={};Pe(e,((e,t)=>{j(e,(e=>{n[e]=t}))}));const o=t,r=Ve(t,((e,t)=>({k:e,v:t}))),s=Ie(r,((e,t)=>[t].concat(Gh(n,o,r,t))));return Ie(n,(e=>$e(s,e).getOr([e])))})(c,i);n.set(l)},expand:t=>$e(e.get(),t).map((e=>{const o=$e(n.get(),t).getOr([]);return[e].concat(o)})),refresh:e=>$e(n.get(),e),collapse:e=>$e(n.get(),e).bind((e=>e.length>1?E.some(e.slice(1)):E.none())),lookupMenu:a,lookupItem:i,otherMenus:e=>{const t=r.get();return Z(De(t),e)},getPrimary:()=>o.get().bind(s),getMenus:()=>t.get(),clear:()=>{e.set({}),t.set({}),n.set({}),o.clear()},isClear:()=>o.get().isNone(),getTriggeringPath:(t,r)=>{const a=z(i(t).toArray(),(e=>s(e).isSome()));return $e(n.get(),t).bind((t=>{const n=X(a.concat(t));return(e=>{const t=[];for(let n=0;n<e.length;n++){const o=e[n];if(!o.isSome())return E.none();t.push(o.getOrDie())}return E.some(t)})(Q(n,((t,a)=>((t,n,o)=>s(t).bind((r=>(t=>ze(e.get(),((e,n)=>e===t)))(t).bind((e=>n(e).map((e=>({triggeredMenu:r,triggeringItem:e,triggeringPath:o}))))))))(t,r,n.slice(0,a+1)).fold((()=>gr(o.get(),t)?[]:[E.none()]),(e=>[E.some(e)])))))}))}}},Qh=Kh,Jh=v("collapse-item"),Xh=Ri({name:"TieredMenu",configFields:[qa("onExecute"),qa("onEscape"),$a("onOpenMenu"),$a("onOpenSubmenu"),ja("onRepositionMenu"),ja("onCollapseMenu"),ln("highlightImmediately",!0),on("data",[en("primary"),en("menus"),en("expansions")]),ln("fakeFocus",!1),ja("onHighlight"),ja("onHover"),La(),en("dom"),ln("navigateOnHover",!0),ln("stayInDom",!1),Na("tmenuBehaviours",[jg,pm,id,Au]),ln("eventOrder",{})],apis:{collapseMenu:(e,t)=>{e.collapseMenu(t)},highlightPrimary:(e,t)=>{e.highlightPrimary(t)},repositionMenus:(e,t)=>{e.repositionMenus(t)}},factory:(e,t)=>{const n=es(),o=Yh(),r=e=>Cd.getValue(e).value,s=t=>Ie(e.data.menus,((e,t)=>Q(e.items,(e=>"separator"===e.type?[]:[e.data.value])))),a=(e,t)=>{pm.highlight(e,t),pm.getHighlighted(t).orThunk((()=>pm.getFirst(t))).each((t=>{er(e,t.element,Vo())}))},i=(e,t)=>pr(U(t,(t=>e.lookupMenu(t).bind((e=>"prepared"===e.type?E.some(e.menu):E.none()))))),c=(t,n,o)=>{const r=i(n,n.otherMenus(o));j(r,(n=>{sa(n.element,[e.markers.backgroundMenu]),e.stayInDom||Au.remove(t,n)}))},l=(t,o)=>{const s=(t=>n.get().getOrThunk((()=>{const o={},s=ut(t.element,`.${e.markers.item}`),a=z(s,(e=>"true"===Wr(e,"aria-haspopup")));return j(a,(e=>{t.getSystem().getByDom(e).each((e=>{const t=r(e);o[t]=e}))})),n.set(o),o})))(t);Pe(s,((e,t)=>{const n=W(o,t);Ir(e.element,"aria-expanded",n)}))},u=(t,n,o)=>E.from(o[0]).bind((r=>n.lookupMenu(r).bind((r=>{if("notbuilt"===r.type)return E.none();{const s=r.menu,l=i(n,o.slice(1));return j(l,(t=>{ta(t.element,e.markers.backgroundMenu)})),lt(s.element)||Au.append(t,Ra(s)),sa(s.element,[e.markers.backgroundMenu]),a(t,s),c(t,n,o),E.some(s)}}))));let d;!function(e){e[e.HighlightSubmenu=0]="HighlightSubmenu",e[e.HighlightParent=1]="HighlightParent"}(d||(d={}));const m=(t,n,s=d.HighlightSubmenu)=>{if(n.hasConfigured(rp)&&rp.isDisabled(n))return E.some(n);{const a=r(n);return o.expand(a).bind((r=>(l(t,r),E.from(r[0]).bind((a=>o.lookupMenu(a).bind((i=>{const c=((e,t,n)=>{if("notbuilt"===n.type){const r=e.getSystem().build(n.nbMenu());return o.setMenuBuilt(t,r),r}return n.menu})(t,a,i);return lt(c.element)||Au.append(t,Ra(c)),e.onOpenSubmenu(t,n,c,X(r)),s===d.HighlightSubmenu?(pm.highlightFirst(c),u(t,o,r)):(pm.dehighlightAll(c),E.some(n))})))))))}},g=(t,n)=>{const s=r(n);return o.collapse(s).bind((r=>(l(t,r),u(t,o,r).map((o=>(e.onCollapseMenu(t,n,o),o))))))},h=t=>(n,o)=>as(o.getSource(),"."+e.markers.item).bind((e=>n.getSystem().getByDom(e).toOptional().bind((e=>t(n,e).map(O))))),v=nr([rr($h(),((e,t)=>{const n=t.event.item;o.lookupItem(r(n)).each((()=>{const n=t.event.menu;pm.highlight(e,n);const s=r(t.event.item);o.refresh(s).each((t=>c(e,o,t)))}))})),mr(((t,n)=>{const o=n.event.target;t.getSystem().getByDom(o).each((n=>{0===r(n).indexOf("collapse-item")&&g(t,n),m(t,n,d.HighlightSubmenu).fold((()=>{e.onExecute(t,n)}),p)}))})),lr(((t,n)=>{(t=>{const n=((t,n,o)=>Ie(o,((o,r)=>{const s=()=>qh.sketch({...o,value:r,markers:e.markers,fakeFocus:e.fakeFocus,onHighlight:e.onHighlight,focusManager:e.fakeFocus?fm():vm()});return r===n?{type:"prepared",menu:t.getSystem().build(s())}:{type:"notbuilt",nbMenu:s}})))(t,e.data.primary,e.data.menus),r=s();return o.setContents(e.data.primary,n,e.data.expansions,r),o.getPrimary()})(t).each((n=>{Au.append(t,Ra(n)),e.onOpenMenu(t,n),e.highlightImmediately&&a(t,n)}))}))].concat(e.navigateOnHover?[rr(Fh(),((t,n)=>{const s=n.event.item;((e,t)=>{const n=r(t);o.refresh(n).bind((t=>(l(e,t),u(e,o,t))))})(t,s),m(t,s,d.HighlightParent),e.onHover(t,s)}))]:[])),b=e=>pm.getHighlighted(e).bind(pm.getHighlighted),y={collapseMenu:e=>{b(e).each((t=>{g(e,t)}))},highlightPrimary:e=>{o.getPrimary().each((t=>{a(e,t)}))},repositionMenus:t=>{const n=o.getPrimary().bind((e=>b(t).bind((e=>{const t=r(e),n=(s=o.getMenus(),je(s,f));var s;const a=pr(U(n,Qh));return o.getTriggeringPath(t,(e=>((e,t,n)=>re(t,(e=>{if(!e.getSystem().isConnected())return E.none();const t=pm.getCandidates(e);return G(t,(e=>r(e)===n))})))(0,a,e)))})).map((t=>({primary:e,triggeringPath:t})))));n.fold((()=>{(e=>E.from(e.components()[0]).filter((e=>"menu"===Wr(e.element,"role"))))(t).each((n=>{e.onRepositionMenu(t,n,[])}))}),(({primary:n,triggeringPath:o})=>{e.onRepositionMenu(t,n,o)}))}};return{uid:e.uid,dom:e.dom,markers:e.markers,behaviours:Fa(e.tmenuBehaviours,[jg.config({mode:"special",onRight:h(((e,t)=>Om(t.element)?E.none():m(e,t,d.HighlightSubmenu))),onLeft:h(((e,t)=>Om(t.element)?E.none():g(e,t))),onEscape:h(((t,n)=>g(t,n).orThunk((()=>e.onEscape(t,n).map((()=>t)))))),focusIn:(e,t)=>{o.getPrimary().each((t=>{er(e,t.element,Vo())}))}}),pm.config({highlightClass:e.markers.selectedMenu,itemClass:e.markers.menu}),id.config({find:e=>pm.getHighlighted(e)}),Au.config({})]),eventOrder:e.eventOrder,apis:y,events:v}},extraApis:{tieredData:(e,t,n)=>({primary:e,menus:t,expansions:n}),singleData:(e,t)=>({primary:e,menus:Nn(e,t),expansions:{}}),collapseItem:e=>({value:Ss(Jh()),meta:{text:e}})}}),Zh=v("sink"),ev=v(yi({name:Zh(),overrides:v({dom:{tag:"div"},behaviours:wr([_u.config({useFixed:O})]),events:nr([ar(Co()),ar(Oo()),ar(To())])})})),tv=Dt([ln("isExtraPart",w),an("fireEventInstead",[ln("event",qo())])]),nv=e=>{const t=Yt("Dismissal",tv,e);return{[S()]:{schema:Dt([en("target")]),onReceive:(e,n)=>{kh.isOpen(e)&&(kh.isPartOf(e,n.target)||t.isExtraPart(e,n.target)||t.fireEventInstead.fold((()=>kh.close(e)),(t=>Jo(e,t.event))))}}}},ov=Dt([an("fireEventInstead",[ln("event",Go())]),("doReposition",tn("doReposition",jt))]);const rv=e=>{const t=Yt("Reposition",ov,e);return{[C()]:{onReceive:e=>{kh.isOpen(e)&&t.fireEventInstead.fold((()=>t.doReposition(e)),(t=>Jo(e,t.event)))}}}};var sv;!function(e){e[e.HighlightFirst=0]="HighlightFirst",e[e.HighlightNone=1]="HighlightNone"}(sv||(sv={}));const av=(e,t)=>{const n=e.getHotspot(t).getOr(t),o="hotspot",r=e.getAnchorOverrides();return e.layouts.fold((()=>({type:o,hotspot:n,overrides:r})),(e=>({type:o,hotspot:n,overrides:r,layouts:e})))},iv=(e,t,n,o,r,s,a)=>{const i=((e,t,n,o,r,s,a)=>{const i=((e,t,n)=>(0,e.fetch)(n).map(t))(e,t,o),c=uv(o,e);return i.map((e=>e.bind((e=>E.from(Xh.sketch({...s.menu(),uid:Rs(""),data:e,highlightImmediately:a===sv.HighlightFirst,onOpenMenu:(e,t)=>{const o=c().getOrDie();_u.position(o,t,{anchor:n}),kh.decloak(r)},onOpenSubmenu:(e,t,n)=>{const o=c().getOrDie();_u.position(o,n,{anchor:{type:"submenu",item:t}}),kh.decloak(r)},onRepositionMenu:(e,t,o)=>{const r=c().getOrDie();_u.position(r,t,{anchor:n}),j(o,(e=>{_u.position(r,e.triggeredMenu,{anchor:{type:"submenu",item:e.triggeringItem}})}))},onEscape:()=>(md.focus(o),kh.close(r),E.some(!0))}))))))})(e,t,av(e,n),n,o,r,a);return i.map((e=>(e.fold((()=>{kh.isOpen(o)&&kh.close(o)}),(e=>{kh.cloak(o),kh.open(o,e),s(o)})),o)))},cv=(e,t,n,o,r,s,a)=>(kh.close(o),tt(o)),lv=(e,t,n,o,r,s)=>{const a=vh.getCoupled(n,"sandbox");return(kh.isOpen(a)?cv:iv)(e,t,n,a,o,r,s)},uv=(e,t)=>e.getSystem().getByUid(t.uid+"-"+Zh()).map((e=>()=>rt.value(e))).getOrThunk((()=>t.lazySink.fold((()=>()=>rt.error(new Error("No internal sink is specified, nor could an external sink be found"))),(t=>()=>t(e))))),dv=e=>{kh.getState(e).each((e=>{Xh.repositionMenus(e)}))},mv=(e,t,n)=>{const o=(()=>{const e=Ss(dh);return{id:e,link:t=>{Ir(t,dh,e)},unlink:e=>{jr(e,dh)}}})(),r=uv(t,e);return{dom:{tag:"div",classes:e.sandboxClasses,attributes:{id:o.id,role:"listbox"}},behaviours:Da(e.sandboxBehaviours,[Cd.config({store:{mode:"memory",initialValue:t}}),kh.config({onOpen:(r,s)=>{const a=av(e,t);o.link(t.element),e.matchWidth&&((e,t,n)=>{const o=id.getCurrent(t).getOr(t),r=oc(e.element);n?la(o.element,"min-width",r+"px"):((e,t)=>{nc.set(e,t)})(o.element,r)})(a.hotspot,s,e.useMinWidth),e.onOpen(a,r,s),void 0!==n&&void 0!==n.onOpen&&n.onOpen(r,s)},onClose:(e,r)=>{o.unlink(t.element),void 0!==n&&void 0!==n.onClose&&n.onClose(e,r)},isPartOf:(e,n,o)=>mh(n,o)||mh(t,o),getAttachPoint:()=>r().getOrDie()}),id.config({find:e=>kh.getState(e).bind((e=>id.getCurrent(e)))}),ip.config({channels:{...nv({isExtraPart:w}),...rv({doReposition:dv})}})])}},gv=v([en("dom"),en("fetch"),ja("onOpen"),za("onExecute"),ln("getHotspot",E.some),ln("getAnchorOverrides",v({})),_l(),Na("dropdownBehaviours",[$d,vh,jg,md]),en("toggleClass"),ln("eventOrder",{}),rn("lazySink"),ln("matchWidth",!1),ln("useMinWidth",!1),rn("role")].concat([ln("sandboxClasses",[]),Ba("sandboxBehaviours",[id,ip,kh,Cd])])),pv=v([bi({schema:[La()],name:"menu",defaults:e=>({onExecute:e.onExecute})}),ev()]),hv=Ni({name:"Dropdown",configFields:gv(),partFields:pv(),factory:(e,t,n,o)=>{const r=e=>{kh.getState(e).each((e=>{Xh.highlightPrimary(e)}))},s={expand:t=>{$d.isOn(t)||lv(e,f,t,o,p,sv.HighlightNone).get(p)},open:t=>{$d.isOn(t)||lv(e,f,t,o,p,sv.HighlightFirst).get(p)},isOpen:$d.isOn,close:t=>{$d.isOn(t)&&lv(e,f,t,o,p,sv.HighlightFirst).get(p)},repositionMenus:e=>{$d.isOn(e)&&(e=>{const t=vh.getCoupled(e,"sandbox");dv(t)})(e)}},a=(e,t)=>(Zo(e),E.some(!0));return{uid:e.uid,dom:e.dom,components:t,behaviours:Fa(e.dropdownBehaviours,[$d.config({toggleClass:e.toggleClass,aria:{mode:"expanded"}}),vh.config({others:{sandbox:t=>mv(e,t,{onOpen:()=>$d.on(t),onClose:()=>$d.off(t)})}}),jg.config({mode:"special",onSpace:a,onEnter:a,onDown:(e,t)=>{if(hv.isOpen(e)){const t=vh.getCoupled(e,"sandbox");r(t)}else hv.open(e);return E.some(!0)},onEscape:(e,t)=>hv.isOpen(e)?(hv.close(e),E.some(!0)):E.none()}),md.config({})]),events:Gd(E.some((t=>{lv(e,f,t,o,r,sv.HighlightFirst).get(p)}))),eventOrder:{...e.eventOrder,[Io()]:["disabling","toggling","alloy.base.behaviour"]},apis:s,domModification:{attributes:{"aria-haspopup":"true",...e.role.fold((()=>({})),(e=>({role:e}))),..."button"===e.dom.tag?{type:("type",$e(e.dom,"attributes").bind((e=>$e(e,"type")))).getOr("button")}:{}}}}},apis:{open:(e,t)=>e.open(t),expand:(e,t)=>e.expand(t),close:(e,t)=>e.close(t),isOpen:(e,t)=>e.isOpen(t),repositionMenus:(e,t)=>e.repositionMenus(t)}}),vv="alloy.base.behaviour",fv=Ss("tc-kebab-action"),bv=(e,t)=>{const n=U(e,(e=>({type:"item",data:{value:e.eventName},dom:{tag:"div",classes:td.kebabItem},components:[{dom:{tag:"span",classes:td.kebabItemLabel},components:[Ea(t.universe.translate(e.textKey))]}],itemBehaviours:wr([kr("item-events",[mr((t=>{Xo(t,fv,{eventName:e.eventName}),Jo(t,Uo())}))]),...up({disablingConfig:{disableClass:td.kebabDisabledItem.join(" ")}})]),eventOrder:{[Io()]:[rp.name(),vv,$d.name(),"typeaheadevents","item-events"]}})));return hv.sketch({dom:{tag:"button",attributes:{type:"button"},classes:td.kebab},components:[{dom:{tag:"div",classes:td.kebabIcon,innerHtml:'<svg width="24" height="24" data-name="icon-image-options"><g id="icon-image-options" stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z" id="Shape" fill-rule="nonzero"></path></g></svg>'}}],lazySink:e=>t.getSink(e).fold((()=>rt.error("Could not find sink for kebab")),rt.value),dropdownBehaviours:wr([...up({}),Td.config({tabAttr:Qp})]),sandboxBehaviours:wr([kr("kebab-sandbox-events",[rr(fv,((e,t)=>{const n=Cd.getValue(e);Jo(n,t.event.eventName)}))])]),parts:{menu:{dom:{tag:"div"},markers:nd.kebab}},toggleClass:ed.kebabOpen,layouts:{onLtr:()=>[tl],onRtl:()=>[el]},fetch:()=>{const e=Ss("kebab-id");return tt(E.some(Xh.singleData(e,{value:Ss(e),dom:{tag:"div",classes:td.kebabMenu},components:[{dom:{tag:"div",classes:td.kebabMenuGroup},components:[qh.parts.items({})]}],items:n})))}})},yv=e=>{const t=T(e),n=_e(t),o=(e=>{const t=void 0!==e.dom.attributes?e.dom.attributes:[];return q(t,((e,t)=>"class"===t.name?e:{...e,[t.name]:t.value}),{})})(t),r=(e=>Array.prototype.slice.call(e.dom.classList,0))(t),s=0===n.length?{}:{innerHtml:Dr(t)};return{tag:ce(t),classes:r,attributes:o,...s}},_v="overlay-button-events",xv=[Td.config({}),kr(_v,[rr(Oo(),((e,t)=>{t.event.prevent()}))])],wv=(e,t,n)=>{const o=t=>{Jo(t,Dp),Ep(e(),(()=>({stage:_p.Before})))(t)},r=(e,t,n)=>zg.sketch({dom:{tag:"button",classes:e?td.button:td.secondaryButton},components:[Ea(t)],eventOrder:{[Oo()]:[vv,md.name(),_v]},action:n,buttonBehaviours:wr(xv)}),s={setText:(e,s,a)=>{const i=((e,o)=>{const r=U(((e,t)=>{switch(t){case _p.QueryingDelete:return n?[Du.tc_delete_prompts_conversation,1===e?Du.tc_delete_prompts_conversation_detail_sing:{pattern:Du.tc_delete_prompts_conversation_detail_pl,targets:[e]}]:[Du.tc_delete_prompts_comment];case _p.QueryingResolve:return[Du.tc_resolve_prompts_conversation,1===e?Du.tc_resolve_prompts_conversation_detail_sing:{pattern:Du.tc_resolve_prompts_conversation_detail_pl,targets:[e]}];default:return[]}})(e,o),(e=>"string"==typeof e?t.translate(e):t.translate([e.pattern].concat(e.targets)))),s=o===_p.QueryingDelete;return{lines:r,cancelText:t.translate(Du.tc_delete_buttons_cancel),proceedText:t.translate(s?Du.tc_delete_buttons_proceed:Du.tc_resolve_buttons_proceed),proceedEvent:s?Vp:Wp}})(s,a);Au.set(e,U(i.lines,(e=>({dom:{tag:"div"},components:[{dom:yv(`<p>${e}</p>`)}]}))).concat([{dom:{tag:"div",classes:td.cardOverlayButtons},components:[r(!0,i.cancelText,o),r(!1,i.proceedText,(e=>{Jo(e,i.proceedEvent)}))]}]))}};return{dom:{tag:"div",styles:{display:"none"},classes:td.cardOverlayText},components:[],apis:s,behaviours:wr([Au.config({}),kr("card-delete-events",[rr(Do(),(t=>{Rr(t.element).fold((()=>{Ep(e(),(()=>({stage:_p.Before})))(t)}),p)}))]),jg.config({mode:"cyclic",onEscape:e=>(o(e),E.some(!0))})])}},Ov=(e,t,n)=>{n?(ha(t.element,"display"),t.hasConfigured(jg)&&jg.focusIn(t)):la(t.element,"display","none")},Sv="basecamp",Cv="deleting",Ev={textKey:Du.tc_kebab_edit,eventName:Lp},kv={textKey:Du.tc_kebab_delete,eventName:Hp},Tv={textKey:Du.tc_kebab_delete_conversation,eventName:Pp},Av={textKey:Du.tc_kebab_resolve_conversation,eventName:Ip},Mv=(e,t,n,o)=>{let r=e;const s=Y([n.deleteConversation?[Tv]:[],n.resolveConversation?[Av]:[],n.editComment?[Ev]:[],n.deleteComment?[kv]:[]]),a=$i(((e,t)=>{const n=e=>[Ea(`${lh(Cn(e.createdAt),t)}`),{dom:{tag:"span",classes:[]},components:e.modifiedAt===e.createdAt?[]:[Ea(t.translate(Du.tc_date_comment_edited))]}],o={updateWith:(e,t,o)=>{Au.set(e,n(t))}};return{dom:{tag:"div",classes:td.date},components:n(e),behaviours:wr([Au.config({})]),apis:o}})(e,o.universe)),i={updateWith:(e,t,n)=>{r=t,l.getOpt(e).each((e=>{e.getApis().updateWith(e,t,{})})),u.getOpt(e).each((e=>{e.getApis().updateWith(e,t,{})})),((e,t,n)=>{const o=n.stage===_p.QueryingDelete||n.stage===_p.QueryingResolve;d.getOpt(e).each((e=>Ov(0,e,o))),m.getOpt(e).each((e=>{e.getApis().setText(e,t,n.stage),Ov(0,e,o)}))})(e,n.numComments,t),t.stage!==_p.PostDelete&&t.stage!==_p.PostResolve||Pd.getCurrentRoute(e).filter((e=>e.destination===Cv)).fold((()=>{Pd.progressTo(e,Cv)}),p),a.getOpt(e).each((e=>{e.getApis().updateWith(e,t,{})}))}},c={dom:{tag:"div",classes:td.cardHead},components:Y([[{dom:{tag:"div",classes:td.cardHeadMeta},components:[(e=>{const t=((e,t)=>({dom:{tag:"div",classes:td.avatar},components:[{dom:{tag:"img",attributes:{alt:"",role:"presentation",src:rd(e,t)}}}]}))(o.avatarCache,e),n={dom:{tag:"div",classes:td.username},components:[Ea(e.authorName)]};return{dom:{tag:"div",classes:td.user},components:[t,{dom:{tag:"div"},components:[n,a.asSpec()]}]}})(r)]}],s.length>0?[bv(s,o)]:[]])},l=$i((e=>{const t=fn(e),n={updateWith:(e,n,o)=>{switch(t.set(n),n.mode){case yp.None:la(e.element,"display","none");break;case yp.Collapsed:ha(e.element,"display"),we(e.element).each((e=>Hr(e,Du.tc_comment_buttons_showmore)));break;case yp.Expanded:ha(e.element,"display"),we(e.element).each((e=>Hr(e,Du.tc_comment_buttons_showless)));break;case yp.ExpandOrNone:case yp.CollapsedOrNone:break;case yp.Edit:la(e.element,"display","none")}}};return{dom:{tag:"div",classes:td.showMoreLessContainer,styles:{display:"none"}},components:[zg.sketch({dom:{tag:"p",classes:td.showMoreLess},components:[Ea(Du.tc_comment_buttons_showmore)],action:e=>{Ep(t.get().uid,(()=>({mode:t.get().mode===yp.Collapsed?yp.Expanded:yp.Collapsed})))(e)},buttonBehaviours:wr([Td.config({tabAttr:Qp})])})],apis:n}})({uid:e.uid,mode:e.mode})),u=$i(((e,t)=>{const n=fn(e),o=e=>{Jo(e,Dp),Ep(n.get().uid,(e=>({mode:yp.ExpandOrNone})))(e)},r={updateWith:(e,t,o)=>{n.set(t),Bp({props:t,memCommands:s}).each((t=>{na(e.element,ed.bodyNotAnimating),t(e)}))}},s=$i(((e,t)=>({dom:{tag:"div",classes:td.editActions},components:[gp({text:t.translate(Du.tc_edit_buttons_cancel),eventName:E.some(hp),disableWhileSaving:!0}),mp({text:t.translate(Du.tc_edit_buttons_save),eventName:E.some(pp),disableWhileSaving:!0})]}))(n.get(),t));return{dom:{tag:"div",classes:td.cardBody},components:[ah(n.get().content)],behaviours:wr([kr("overflow-events",[lr((e=>{r.updateWith(e,n.get(),{})})),rr(pp,(e=>{Jo(e,Up)})),rr(hp,o),cr(Mo(),((e,t)=>{"max-height"===t.event.raw.propertyName&&we(e.element).each((t=>{e.getSystem().triggerEvent(ko(),t,{})}))}))]),Jp({onEscape:e=>(o(e),E.some(!0))}),$d.config({toggleClass:ed.bodyExpanded,selected:!1,toggleOnExecute:!1,aria:{mode:"expanded"}}),Cd.config({store:{mode:"manual",getValue:e=>we(e.element).map(fa).getOr(""),setValue:(e,t)=>{we(e.element).each((e=>{ba(e,t)}))}}}),Au.config({})]),apis:r}})(r,o.universe)),d=$i({dom:{tag:"div",classes:td.cardOverlay,styles:{display:"none"}}}),m=$i(wv((()=>r.uid),o.universe,t));return{dom:{tag:"div",classes:td.card,styles:{position:"relative"}},components:[c,u.asSpec(),d.asSpec(),m.asSpec(),l.asSpec()],behaviours:wr([md.config({}),Td.config({}),Zp({escapeEvent:Dp}),Pd.config({initialState:Sv,onTransition:e=>{var t;(t=r.uid,e=>{Xo(e,fp,{uid:t})})(e)},routes:{[Sv]:{[Cv]:{transition:{property:"opacity",transitionClass:ed.disappearing}}}}}),Cd.config({store:{mode:"memory",initialValue:r.uid}}),kr("comment-events",[rr(jp,(e=>Ep(r.uid,(()=>({mode:r.mode===yp.Collapsed?yp.Expanded:yp.Collapsed})))(e))),rr(Dp,md.focus),rr(Hp,(e=>{Ep(r.uid,(()=>({stage:_p.QueryingDelete})))(e)})),rr(Pp,(e=>{Ep(r.uid,(()=>({stage:_p.QueryingDelete})))(e)})),rr(Ip,(e=>{Ep(r.uid,(()=>({stage:_p.QueryingResolve})))(e)})),rr(Wp,(e=>{Xo(e,uh.resolveConversationEvent,{uid:r.uid})})),rr(Lp,(e=>Ep(r.uid,(e=>({mode:yp.Edit})))(e))),rr(Up,(e=>{u.getOpt(e).each((t=>{const n=Cd.getValue(t);Xo(e,uh.editCommentEvent,{uid:r.uid,content:n})}))})),rr(Vp,(e=>{Xo(e,t?uh.deleteConversationEvent:uh.deleteCommentEvent,{uid:r.uid})}))])]),apis:i}},Rv=(e,t,n)=>U(e,((e,o)=>{const r=0===o;return Mv(e,r,{editComment:!0,deleteComment:o>0,deleteConversation:r,resolveConversation:r&&n},t)})),Nv=(e,t,n=!1)=>{const o={setComments:(e,o)=>{id.getCurrent(e).each((e=>{Au.set(e,Rv(o,t,n))})),kp(e)},updateWith:(e,o,r)=>{id.getCurrent(e).each((r=>{const s=Au.contents(r);(e=>oe(e).exists((e=>e.stage===_p.QueryingDelete)))(o)||(e=>oe(e).exists((e=>e.stage===_p.QueryingResolve)))(o)?ta(r.element,ed.commentThreadOverlay):na(r.element,ed.commentThreadOverlay),s.length!==o.length?Au.set(r,Rv(o,t,n)):j(s,((e,t)=>{s[t].getApis().updateWith(s[t],o[t],{numComments:o.length})})),kp(e)}))},scrollToEnd:e=>{id.getCurrent(e).each((t=>{var n;(n=Au.contents(t),ne(n,n.length-1)).each((t=>{const n=e.element.dom,o=n.getBoundingClientRect(),r=t.element.dom.getBoundingClientRect();r.top<o.top?n.scrollTop+=r.top-o.top:r.bottom>o.bottom&&(n.scrollTop+=r.bottom-o.bottom)}))}))}};return{dom:{tag:"div",classes:td.outerScroll},components:[{dom:{tag:"div",classes:td.commentList},components:Rv(e,t,n),behaviours:wr([eh({selector:Zu.card}),Au.config({})])}],behaviours:wr([id.config({find:e=>we(e.element).bind((t=>e.getSystem().getByDom(t).toOptional()))})]),apis:o}},Fv=e=>{return{dom:{tag:"div",classes:td.conversationsHead},components:[(t=e.translate(Du.tc_conversations_title),{dom:{tag:"div",classes:td.conversationsTitle},components:[Ea(t)]})]};var t};var Bv;!function(e){e[e.Start=0]="Start",e[e.Reply=1]="Reply"}(Bv||(Bv={}));const Dv=Ss("tc-clear-input"),Hv=Ss("tc-submit-input"),Pv=(e,t)=>{const n=$i((e=>((e,t)=>Kp.sketch({tag:"textarea",inputClasses:td.replyTextarea,inputAttributes:{...th,placeholder:t.translate(Du.tc_reply_placeholders)},inputStyles:nh,inputBehaviours:wr([Xp({enterEvent:e}),Td.config({}),kr("reply-events",[rr(ko(),rh)]),ip.config({channels:{...lp(gn),[Tn]:{onReceive:rh}}}),cp({disableWhileSaving:!0})])}))(Hv,e))(t)),o={focusEditor:e=>{n.getOpt(e).each(md.focus)},updateWith:(e,t,n)=>{L(t,(e=>e.mode===yp.Edit))?la(e.element,"display","none"):ha(e.element,"display")}};return{dom:{tag:"div",classes:td.replySection},behaviours:wr([kr("reply-events",[rr(Dv,(e=>{n.getOpt(e).each((e=>{Cd.setValue(e,"")}))})),rr(Hv,(t=>{n.getOpt(t).map(Cd.getValue).each((n=>{n.length>0&&Xo(t,uh.createCommentEvent,{content:n,mode:e})}))}))])]),components:[n.asSpec(),gp({text:t.translate(Du.tc_reply_buttons_clear),eventName:E.some(Dv),disableWhileSaving:!0}),mp({text:t.translate(Du.tc_reply_buttons_comment),eventName:E.some(Hv),disableWhileSaving:!0})],apis:o}},Iv=()=>{let e=Sp();const t=t=>{e=t(e)};return{clearAll:()=>{e=Sp()},recalibrate:e=>{t((t=>{return n=t,o=e.comments,{targetUid:n.targetUid,conversation:U(o,(e=>({uid:e.uid,props:{...e,stage:_p.Before,mode:gr(n.targetUid,e.uid)?yp.ExpandOrNone:yp.CollapsedOrNone}}))),queue:[]};var n,o}))},enqueuePatch:(e,n)=>{t((t=>((e,t)=>Op(e,[t]))(t,{uid:e,patch:n})))},enqueuePatches:e=>{t((t=>Op(t,e)))},setTargetUid:e=>{t((t=>wp(t,E.some(e))))},clearTargetUid:()=>{t((e=>wp(e,E.none())))},processQueue:()=>(e=>{if(e.queue.length>0){const t=(e=>{const t=U(e.conversation,(t=>G(e.queue,(e=>e.uid===t.uid)).fold((()=>t),(e=>{const n=void 0!==e.patch.content?{mode:yp.ExpandOrNone}:{};return{uid:t.uid,props:{...t.props,...e.patch,...n}}}))));return{targetUid:e.targetUid,conversation:t,queue:[]}})(e);return E.some({world:t,props:xp(t)})}return E.none()})(e).map((({world:t,props:n})=>(e=t,n))),purge:e=>{t((t=>{const n=z(t.conversation,(t=>t.uid!==e));return{...t,conversation:n}}))},getProps:()=>xp(e),adjust:e=>{t((t=>Op(t,U(e,(e=>({uid:e.uid,patch:"to-delete"===e.type?{stage:_p.PostDelete}:{}}))))))}}},Vv=e=>({type:"redraw-sidebar",view:e}),Wv=Ss("tc-escapeInSidebar"),Lv=(e,t,n,o,r,s,a)=>{const i=e=>{v.get().each((t=>{"comments"===t.type&&oe(t.conversation.comments).each((({author:n,authorName:o,content:r,createdAt:s})=>{e(t.conversation.uid,{author:n,authorName:o},r,a(t.conversation.uid),s)}))}))},c=(e,t)=>{v.get().each((n=>{"comments"===n.type&&G(n.conversation.comments,(t=>t.uid===e)).each((({author:e,authorName:n,content:o})=>{t({author:e,authorName:n},o)}))}))},l=Iv(),u=(()=>{const e={};return{lookup:t=>$e(e,t),store:(t,n)=>e[t]=n}})(),d=()=>{l.processQueue().each((e=>{w(e),b.getOpt(p).each((t=>{t.getApis().updateWith(t,e,{})}))}))},m=(e,t)=>{i(((n,o,r,s,a)=>e(n).get((e=>{e.fold((e=>e()),(e=>{e(),t(n,o,r,s,a)}))}))))},g=(e,t)=>{e.get((e=>{e.fold((e=>e()),(e=>{l.setTargetUid(e.targetUid),e.fn(),t(e.targetUid)}))}))},p=Ma({dom:{tag:"div",classes:e,styles:{position:"relative"}},behaviours:wr([Au.config({}),Jp({onEscape:e=>(Jo(e,Wv),E.some(!0))}),kr("sidebar-events",[rr(vp,((e,t)=>{l.enqueuePatch(t.event.uid,t.event.patch)})),rr(fp,((e,t)=>{l.purge(t.event.uid),b.getOpt(p).each((e=>{const t=l.getProps();w(t),e.getApis().updateWith(e,t,{})}))})),rr(bp,(()=>{d()})),rr(Wv,(()=>{t.onEscape()})),rr(uh.deleteConversationEvent,(()=>{m((e=>n.deleteConversation(e)),((e,t,n,o,s)=>{r({type:"delete",timestamp:bn(),conversationUid:e,conversationContext:o,conversationContent:n,conversationAuthor:t,conversationCreatedAt:s})}))})),rr(uh.deleteCommentEvent,((e,t)=>{const o=t.event.uid;m((e=>n.deleteComment(e,o)),((e,t,n,s,a)=>{c(o,((i,c)=>{r({type:"delete-comment",timestamp:bn(),conversationUid:e,commentUid:o,conversationContext:s,conversationContent:n,conversationCreatedAt:a,commentContent:c,commentAuthor:i,conversationAuthor:t})}))}))})),rr(uh.resolveConversationEvent,(()=>{n.optResolveConversation.each((e=>{m((t=>e(t)),((e,t,n,o,s)=>{r({type:"resolve",timestamp:bn(),conversationUid:e,conversationContext:o,conversationContent:n,conversationCreatedAt:s,conversationAuthor:t})}))}))})),rr(uh.editCommentEvent,((e,t)=>{const{uid:o,content:s}=t.event;i(((e,t,a,i,l)=>{g(n.editComment(e,o,s),(()=>{c(o,(n=>{r({type:"edit-comment",timestamp:bn(),conversationUid:e,commentUid:o,conversationContext:i,conversationContent:a,conversationCreatedAt:l,commentContent:s,commentAuthor:n,conversationAuthor:t})}))}))}))})),rr(uh.createCommentEvent,((e,t)=>{const o=t.event.content;t.event.mode===Bv.Reply?i(((e,t,s,a,i)=>{g(n.reply(e,o),(n=>{r({type:"reply",timestamp:bn(),conversationUid:e,commentUid:n,conversationContext:a,conversationContent:s,conversationCreatedAt:i,commentContent:o,conversationAuthor:t})}))})):g(n.createConversation(o),(e=>{r({type:"create",timestamp:bn(),conversationUid:e,conversationContext:a(e),conversationContent:o})}))}))])])}),h=zi(p),v=fn(E.none()),f=e=>{Au.set(p,[y.asSpec(),Fv(o)].concat(e))},b=$i(Nv([],{getSink:e=>y.getOpt(e),universe:o,avatarCache:u},s.useResolveConversation)),y=$i({dom:{tag:"div",styles:{"z-index":"100"}},behaviours:wr([_u.config({})])}),_=$i(Pv(Bv.Start,o)),x=$i(Pv(Bv.Reply,o)),w=e=>{x.getOpt(p).each((t=>{t.getApis().updateWith(t,e,{})}))},O=e=>{"splash"===e.view.type?(l.clearAll(),f([_.asSpec()])):"comments"===e.view.type&&(l.recalibrate(e.view.conversation),f([b.asSpec(),x.asSpec()]),b.getOpt(p).each((e=>{const t=l.getProps();w(t),e.getApis().setComments(e,t),e.getApis().scrollToEnd(e)})))};return{system:h,root:p,element:h.element,update:e=>{b.getOpt(p).bind((e=>v.get().map((t=>({convUi:e,pview:t}))))).fold((()=>O(e)),(({pview:t})=>{const n=((e,t)=>e.type!==t.type?Vv(t):"splash"===t.type?{type:"no-change"}:((e,t)=>{if(e.conversation.uid===t.conversation.uid){const n=U(e.conversation.comments,(e=>e.uid)),o=U(t.conversation.comments,(e=>e.uid));return((e,t,n=H)=>D(n).eq(e,t))(n,o)?{type:"refresh-comments",comments:U(t.conversation.comments,(e=>({uid:e.uid,patch:{...e}})))}:0===Z(o,n).length?{type:"remove-comments",adjustments:U(n,(e=>({type:W(o,e)?"to-remain":"to-delete",uid:e})))}:Vv(t)}return Vv(t)})(e,t))(t,e.view);switch(n.type){case"add-comment":case"redraw-sidebar":O(e);break;case"no-change":break;case"remove-comments":l.adjust(n.adjustments),d();break;case"refresh-comments":l.enqueuePatches(n.comments),d()}})),v.set(E.some(e.view)),Mu(p.element)&&e.grabFocus()&&x.getOpt(p).orThunk((()=>_.getOpt(p))).each((e=>{e.getApis().focusEditor(e)}))},hasFocus:()=>Rr(p.element).isSome(),sendGlobalUiState:e=>{e.readonly&&h.broadcastOn([S()],{target:h.element}),h.broadcastOn([kn],e)},getSink:y.getOpt}},Uv=(e,t)=>{e.execCommand("tc-delete-conversation-at-cursor",null,{conversationUid:t})},jv=(e,t,n,o)=>e.fold((e=>rt.error({message:t,error:e,refresh:o})),(e=>n(e).fold((e=>rt.error({message:e.permError,error:e.reason,refresh:o})),rt.value))),zv=e=>$e(e,"reason").getOr("");tinymce.Resource.add("tinymce.plugins.tinycomments.sidebar",((e,t,n,o,s,a)=>{const i=((e,t,n)=>{const o=e=>()=>{n().showError(e.message,e.error),e.refresh&&e.refresh()};return{createConversation:r=>(n().setSaving(!0),ct.wrap(e.create({content:r,createdAt:bn()}).map((e=>{const r=rt.value,s=p;return n().setSaving(!1),jv(e,Du.tc_create_problem,r,s).fold((e=>rt.error(o(e))),(e=>rt.value({targetUid:e.conversationUid,fn:()=>{n().refreshReadonly()?$e(e,"onError").each((e=>e(new Error("Unable to create a new conversation")))):(t.annotator.annotate(Ke(),{uid:e.conversationUid}),n().refreshSidebar(E.some(e.conversationUid),3),$e(e,"onSuccess").each((t=>t(e.conversationUid))))}})))})))),reply:(t,r)=>(n().setSaving(!0),ct.wrap(e.reply({conversationUid:t,content:r,createdAt:bn()}).map((e=>{const r=rt.value,s=p;return n().setSaving(!1),jv(e,Du.tc_reply_problem,r,s).fold((e=>rt.error(o(e))),(e=>rt.value({targetUid:e.commentUid,fn:()=>{n().refreshSidebar(E.some(t),3)}})))})))),editComment:(t,r,s)=>(n().setSaving(!0),ct.wrap(e.editComment({conversationUid:t,commentUid:r,content:s,modifiedAt:bn()}).map((e=>{const s=p;return n().setSaving(!1),jv(e,Du.tc_edit_problem_comment,(e=>e.canEdit?rt.value(e):rt.error({permError:Du.tc_edit_unauthorised_comment,reason:zv(e)})),s).fold((e=>rt.error(o(e))),(()=>rt.value({targetUid:r,fn:()=>{n().refreshSidebar(E.some(t),4)}})))})))),deleteComment:(t,r)=>ct.wrap(e.deleteComment({conversationUid:t,commentUid:r}).map((e=>jv(e,Du.tc_delete_problem_comment,(e=>e.canDelete?rt.value(e):rt.error({permError:Du.tc_delete_unauthorised_comment,reason:zv(e)})),(()=>{n().refreshSidebar(E.some(t),4)})).fold((e=>rt.error(o(e))),(()=>rt.value((()=>{n().refreshSidebar(E.some(t),4)}))))))),deleteConversation:r=>ct.wrap(e.deleteConversation({conversationUid:r}).map((e=>jv(e,Du.tc_delete_problem_conversation,(e=>e.canDelete?rt.value(e):rt.error({permError:Du.tc_delete_unauthorised_conversation,reason:zv(e)})),(()=>{n().refreshSidebar(E.some(r),4)})).fold((e=>rt.error(o(e))),(()=>rt.value((()=>{Uv(t,r),n().refreshSidebar(E.none(),2)}))))))),optResolveConversation:e.resolveConversation.map((e=>r=>ct.wrap(e({conversationUid:r}).map((e=>jv(e,Du.tc_resolve_problem_conversation,(e=>e.canResolve?rt.value(e):rt.error({permError:Du.tc_resolve_unauthorised_conversation,reason:zv(e)})),(()=>{n().refreshSidebar(E.some(r),4)})).fold((e=>rt.error(o(e))),(()=>rt.value((()=>{Uv(t,r),n().refreshSidebar(E.none(),2)})))))))))}})(t,e,(()=>u)),c={useResolveConversation:t.resolveConversation.isSome()},l=Lv(td.roots,{onEscape:()=>e.focus()},i,a,((e,t)=>n=>{const o=(e=>(t={})=>r(t.after)?En(e,t.after):En(e))(t);t.set(t.get().concat([n])),((e,t)=>{const n={getEventLog:t};e.dispatch("CommentChange",n)})(e,o)})(e,o),c,(t=>((e,t)=>$e(e.annotator.getAll(Ke()),t).map((t=>U(t,(t=>((e,t)=>{const n="SPAN"===t.nodeName;return e.serialize(t,{getInner:n,selection:!0})})(e.serializer,t))).join(" "))).getOr(""))(e,t))),u=vn(t,n,e,l),d=e=>{l.system.broadcastOn([S()],{target:R(e.target)})};e.on("ResizeEditor",(()=>{l.system.broadcastOn([Tn],{})}));const m=Re(R(document),"mousedown",(e=>{l.system.broadcastOn([S()],{target:e.target})}));e.on("mousedown",d),e.on("remove",(()=>{e.off("mousedown",d),m.unbind()})),s({controller:u,attachTo:e=>{Be(e,l.element)}})}))}();